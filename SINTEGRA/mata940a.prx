#INCLUDE "FIVEWIN.CH"
#INCLUDE "MATA940A.CH"
Static __cTrbName
Static __cDest

/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁPrograma  ЁMATA940   Ё Autor ЁNereu Humberto Jr      Ё Data Ё12.12.2002Ё╠╠
╠╠цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o ЁPreparacao do meio-magnetico para o Sintegra - CONV 69/02   Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁRetorno   ЁNenhum                                                      Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁParametrosЁNenhum                                                      Ё╠╠
╠╠Ё          Ё                                                            Ё╠╠
╠╠цддддддддддедддддддддддддддбдддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё   DATA   Ё Programador   ЁManutencao Efetuada                         Ё╠╠
╠╠цддддддддддедддддддддддддддедддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё          Ё               Ё                                            Ё╠╠
╠╠юддддддддддадддддддддддддддадддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
/*/
User Function MATA940a()

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Salva a Integridade dos dados de Entrada                     Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Local aSave:={Alias(),IndexOrd(),Recno()}
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Define variaveis                                             Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Local 	nOpc	:=	0
Local 	oDlg	:=	""
Local 	cTitulo	:=	""
Local 	cText1	:=	""
Local	cText2	:=	""
Local	cText3	:=	""
Local 	aCAP	:=	{STR0001,STR0002,STR0003} //"Confirma"###"Abandona"###"Par┐metros"
Local 	aSays	:=	{}
Local aButtons	:=	{}
Local cCadastro	:=	STR0004 //"LIVROS EM DISQUETE "


Private cPerg	:=	"UMTA94"
Private lEnd	:=	.F.

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Ajusta grupo de perguntas                                    Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
//AjustaSX1()

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Janela Principal                                             Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
cTitulo	:=	STR0005 //"Arquivo Magn┌tico"
cText1	:=	STR0006 //"Este programa gera arquivo pr┌-formatado dos lan┤amentos fiscais para  entrega"
cText2	:=	STR0007 //"Secretarias de Fazenda Estaduais (SINTEGRA versao 2.4 e posteriores)."
cText3	:=	STR0008 //"Convenio ICMS 31/99."
While .T.
	AADD(aSays,OemToAnsi( ctext1 ) )
	AADD(aSays,OemToAnsi( cText2 ) )
	AADD(aSays,OemToAnsi( cText3 ) )
	AADD(aButtons, { 5,.T.,{|| Pergunte(cPerg,.T. ) } } )
	AADD(aButtons, { 1,.T.,{|o| nOpc:= 1,o:oWnd:End()}} )
	AADD(aButtons, { 2,.T.,{|o| o:oWnd:End() }} )
	FormBatch( cCadastro, aSays, aButtons )

	Do Case
	Case nOpc==1
		Processa({||a940AProcessa()},,,@lEnd)
	Case nOpc==3
		Pergunte(cPerg,.t.)
		Loop
	EndCase
	Exit
End
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Restaura area                                                Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
dbSelectArea(aSave[1])
dbSetOrder(aSave[2])
MsGoto(aSave[3])

Return


STATIC FUNCTION A940AProcessa

Local aAreaSint := GetArea()
Local lQuery    := .F.
Local lValido   := .T.
Local lFirst    := .T.
Local lCupom    := .T.	
Local nItem     := 0
Local nX        := 0
Local nI        := 0
Local nAliqICM  := 0
Local nPosAliq  := 0
Local nAliqIte  := 0
Local nBRetido  := 0
Local nRedBase  := 0
Local cSitTrib  := ""
Local cSeek     := ""
Local cCNPJ     := ""
Local cIE       := ""
Local cTranspCGC:= ""
Local cTranspIns:= ""
Local cAliasSD1 := "SD1"
Local cAliasSD2 := "SD2"
Local cAliasSF1 := "SF1"
Local cAliasSF2 := "SF2"
Local cAliasSF3 := "SF3"
Local cAliasSF6 := "SF6"
Local cAliasSFI := "SFI"
Local cTranspEst:=	""
Local cChave    := ""
Local cChaveAux := ""
Local cChaveAux2:= ""
Local cQuery    := ""
Local cNcm      := ""
Local cProd     := ""
Local cArq060M  := ""
Local cArq060A  := ""
Local cArq060D  := ""
Local cArq060I  := ""
Local cArq060R  := ""
Local cArq076   := ""
Local cArq077   := ""
Local cCpVlPisEn:= ""
Local cCpVlPisSa:= ""
Local aArray71  := ""
Local nValPis   := 0
Local nPsVlPisEn:= 0
Local nPsVlPisSa:= 0
Local aArrayF3  := {}
Local aStru050  := {}
Local aStru051  := {}
Local aStru053  := {}
Local aStru054  := {}
Local aStru055  := {}
Local aStru060M := {}
Local aStru060A := {}
Local aStru060D := {}
Local aStru060I := {}
Local aStru060R := {}
Local aStru061  := {}
Local aStru070  := {}
Local aStru071  := {}
Local aStru074  := {}
Local aStru075  := {}
Local aStru076  := {}
Local aStru077  := {}
Local aStru090  := {}
Local aStruSF3  := {}
Local cSintegra := SuperGetMv("MV_SINTEG")
Local cDesCfop	:= GetNewPar("MV_DESCFOP","")	//Desconsidera Cfop's
Local cCodSEFMG := SuperGetMv("MV_CODSEF")
Local aMovimen  :={}
Local cCfoSint  := ""   
Local lMtaTIP71	:=	ExistBlock("MTATIP71")
Local cCodProd := ""
Local aEstMPI  := {}       
Local aEstMPF  := {}       
Local aEstPAI  := {}
Local aEstPAF  := {}
Local aEstISI  := {}
Local aEstISF  := {}
Local aEstANI  := {}
Local aEstANF  := {}
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Define variaveis                                             Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Local cAlias	:=	Alias()
Local aListBox		:= {}
Local aSel			:= {}
Local aMsg			:= {}
Local aValid		:= {}
Local aConteudo		:= {}
Local aSvConteudo 	:= {}
Local cTitulo1		:= ""
Local cTitulo2		:= ""
Local cSuframa      := "" 
Local nValFrete     := 0
Local cAIDF   		:=GetNewPar("MV_DICAIDF","")
Local aAIDF			:= &(cAIDF)
Local lAIDF 		:= IIf(ValType(aAIDF)=="A",IIf(Len(aAIDF)==2,.T.,.F.),.F.)
Local nSFI			:= 0
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Contadores de registros para gravar no registro 90           Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Private nReg50:=0
Private nReg51:=0
Private nReg53:=0
Private nReg54:=0
Private nReg55:=0
Private nReg60:=0
Private nReg61:=0
Private nReg70:=0
Private nReg71:=0
Private nReg74:=0
Private nReg75:=0
Private nReg88:=0
Private nReg90:=1
Private nValMPI  := 0
Private nValMPF  := 0
Private nValPAI  := 0
Private nValPAF  := 0
Private nValISI  := 0                   
Private nValISF  := 0                   
Private nValANI  := 0                   
Private nValANF  := 0                   

Private aReturn 	:=	{STR0009, 1,STR0010, 2, 2, 1, "",1 } //"Zebrado"###"Administra┤└o"
Private Nomeprog	:=	"MATA940"
Private wnrel	 	:=	NomeProg
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Carrega Parametros                                           Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Pergunte(cPerg,.F.)
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё mv_par01 - Data Inicial                                      Ё
//Ё mv_par02 - Data Final                                        Ё
//Ё mv_par03 - Drive Destino                                     Ё
//Ё mv_par04 - Nome do Arquivo .TXT                              Ё
//Ё mv_par05 - Equipamento utilizado                             Ё
//Ё mv_par06 - Meio magnetico utilizado (FITA/DISQUETE)          Ё
//Ё mv_par07 - Densidade de gravacao                             Ё
//Ё mv_par08 - Fator de Bloco de gravacao                        Ё
//Ё mv_par09 - Estado de Orig./Destino                           Ё
//Ё mv_par10 - Listar Estado                                     Ё
//Ё mv_par11 - Nr.do Livro                                       Ё
//Ё mv_par12 - Cupons Fiscais                                    Ё
//Ё mv_par13 - Entradas/Saidas/Ambos                             Ё
//Ё mv_par14 - Finalidade                                        Ё
//Ё mv_par15 - Versao do Validador                               Ё
//Ё mv_par16 - Codigo Municipio   								 Ё
//Ё mv_par17 - Centralizadora     								 Ё
//Ё mv_par18 - Ano AIDF           								 Ё
//Ё mv_par19 - Numero AIDF        								 Ё
//Ё mv_par20 - Gerar GAM57 - MG                                  Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Private	dDtIni		:=	mv_par01
Private	dDtFim		:=	mv_par02
Private	cDisco		:=	Upper(mv_par03)
Private	cArqTxt		:=	Alltrim(mv_par04)
Private	cEquip		:=	mv_par05
Private	nMeioMag	:=	mv_par06
Private	cDensGrv	:=	mv_par07
Private	cFatBloc	:=	mv_par08
Private	cEstDest	:=	mv_par09
Private	lListEst	:=	(mv_par10==1)
Private	cNrLivro	:=	mv_par11
Private	lCupons		:=	(mv_par12==2)
Private	cFinalid 	:=	str(mv_par14,1)
Private	nNumReg		:=	u_A940ANumReg(nMeioMag)
Private cCodMun   	:=  mv_par16
If mv_par20==1
	Private nReg88C:=0
	Private nReg88D:=0
	Private nReg88E:=0
	Private nReg88M:=0
	Private nReg88Q:=0
	lCupons        :=.F.
Endif                 
Private dDtIni2   :=dDtIni
Private nVal88St  := 0

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Cria arquivo temporario para armazenar registros             Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Private  cArq050
Private  cArq050A
Private  cArq051
Private  cArq053
Private  cArq054
Private  cArq055
Private  cArq60M
Private  cArq60A
Private  cArq60R
Private  cArq061
Private  cArq61R
Private  cArq070
Private  cArq071
Private  cArq074
Private  cArq075
Private  cArq088
Private  cArqD10
Private  cArqAD4
Private  cArq08801
Private  cArq08802
If MV_PAR15 == 3
	Private cArq08850
	A940LoadDIC(@aListBox,@aSel,@aMsg,@aValid)
	aConteudo 	:= AFisLoadCFP("DIC.CFP",aListBox)
	aSvConteudo	:= Aclone(aConteudo)
	cTitulo2  	:= STR0073	//"DIC-SE"
	cTitulo1    := STR0074 //" Configuracao dos codigos das Contas contabeis"
	cTexto1		:= STR0075
	cTexto2		:= STR0076
	AFisIns(cTitulo1+" "+cTitulo2,cTexto1,cTexto2,@aListBox,@aConteudo,;
		aSel,aValid,aMsg,"DIC.CFP",cTitulo2,aSvConteudo)	
EndIf
If mv_par20==1
	Private  cArq088C
	Private  cArq088D
	Private  cArq088A
	Private  cArq088E
	Private  cArq088M
	Private  cArq088Q
Endif	
Private lcArq088	:= existBlock("M940TP88")
Private	 nHandle := -1

If Empty(cSintegra)
    cCfoSint := "173/273/174/274/191/291/391/192/292/197/297/397/198/298/591/691/592/692/595/695"
    cCfoSint += "1406/2406/1407/2407/1551/1556/2551/2556/3551/3556/1552/1557/2552/2557/5551/6551/7551"
	cCfoSint += "5552/5557/6552/6557/5553/5556/6553/6556/7553/7556"   
Else
    cCfoSint :=cSintegra
Endif

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁCriacao os arquivos de trabalho                                         Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro 050 - Notas Fiscais Modelo 1/1A (ICMS)                         Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru050,{"A50_CNPJ"	,"C",014,0})
AADD(aStru050,{"A50_IE"		,"C",014,0})
AADD(aStru050,{"A50_EMISS"	,"D",008,0})
AADD(aStru050,{"A50_UF"		,"C",002,0})
AADD(aStru050,{"A50_MODELO"	,"C",002,0})
AADD(aStru050,{"A50_SERIE"	,"C",003,0})
AADD(aStru050,{"A50_NFISC"	,"C",006,0})
AADD(aStru050,{"A50_CFOP"	,"C",004,0})
AADD(aStru050,{"A50CFOPEXT"	,"C",002,0})
AADD(aStru050,{"A50_EMIT"	,"C",001,0})
AADD(aStru050,{"A50_VALTOT"	,"N",013,2})
AADD(aStru050,{"A50_BSICM"	,"N",013,2})
AADD(aStru050,{"A50_VALICM"	,"N",013,2})
AADD(aStru050,{"A50_ISENTO"	,"N",013,2})
AADD(aStru050,{"A50_OUTRAS"	,"N",013,2})
AADD(aStru050,{"A50_ALQICM"	,"N",005,2})
AADD(aStru050,{"A50_SITUAC"	,"C",001,0})
AADD(aStru050,{"A50_DESPES"	,"N",014,2})
AADD(aStru050,{"A50_CODMUN"	,"C",005,0})
AADD(aStru050,{"A50_ANOAID"	,"C",004,0})
AADD(aStru050,{"A50_NUMAID"	,"C",005,0})

cArq050	:=	CriaTrab(aStru050)
dbUseArea(.T.,__LocalDriver,cArq050,"R50")
IndRegua("R50",cArq050,"DTOS(A50_EMISS)") 

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro 051 - Nota Fiscal ( IPI )                                      Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru051,{"A51_CNPJ"	,"C",014,0})
AADD(aStru051,{"A51_IE"		,"C",014,0})
AADD(aStru051,{"A51_EMISS"	,"D",008,0})
AADD(aStru051,{"A51_UF"		,"C",002,0})
AADD(aStru051,{"A51_SERIE"	,"C",003,0})
AADD(aStru051,{"A51_NFISC"	,"C",006,0})
AADD(aStru051,{"A51_CFOP"	,"C",004,0})
AADD(aStru051,{"A51_VALTOT"	,"N",014,2})
AADD(aStru051,{"A51_VALIPI"	,"N",014,2})
AADD(aStru051,{"A51_ISENTA"	,"N",014,2})
AADD(aStru051,{"A51_OUTRAS"	,"N",014,2})
AADD(aStru051,{"A51_SITUAC"	,"C",001,0})
AADD(aStru051,{"A51_BASIPI"	,"N",013,2})

cArq051	:=	CriaTrab(aStru051)
dbUseArea(.T.,__LocalDriver,cArq051,"R51")
IndRegua("R51",cArq051,"Dtos(A51_EMISS)")
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro 053 - Nota Fiscal Subst. Tributaria                            Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru053,{"A53_CNPJ"	,"C",014,0})
AADD(aStru053,{"A53_IE"		,"C",014,0})
AADD(aStru053,{"A53_EMISS"	,"D",008,0})
AADD(aStru053,{"A53_UF"		,"C",002,0})
AADD(aStru053,{"A53_MODELO"	,"C",002,0})
AADD(aStru053,{"A53_SERIE"	,"C",003,0})
AADD(aStru053,{"A53_NFISC"	,"C",006,0})
AADD(aStru053,{"A53_CFOP"	,"C",004,0})
AADD(aStru053,{"A53_EMIT"	,"C",001,0})
AADD(aStru053,{"A53_BRICMS"	,"N",014,2})
AADD(aStru053,{"A53_VALRET"	,"N",014,2})
AADD(aStru053,{"A53_DESPES"	,"N",014,2})
AADD(aStru053,{"A53_SITUAC"	,"C",001,0})
AADD(aStru053,{"A53_ANTECI"	,"C",001,0})

cArq053	:=	CriaTrab(aStru053)
dbUseArea(.T.,__LocalDriver,cArq053,"R53")
IndRegua("R53",cArq053,"DTOS(A53_EMISS)")

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro 054 - Itens do documento fiscal                                Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru054,{"A54_CNPJ"	,"C",014,0})
AADD(aStru054,{"A54_MODELO"	,"C",002,0})
AADD(aStru054,{"A54_SERIE"	,"C",003,0})
AADD(aStru054,{"A54_NFISC"	,"C",006,0})
AADD(aStru054,{"A54_CFOP"	,"C",004,0})
AADD(aStru054,{"A54CFOPEXT"	,"C",002,0})
AADD(aStru054,{"A54_CST"	,"C",003,0})
AADD(aStru054,{"A54_NUMITE"	,"C",003,0})
AADD(aStru054,{"A54_PRODUT"	,"C",014,0})
AADD(aStru054,{"A54_QUANT"	,"N",014,3})
AADD(aStru054,{"A54_VALPRO"	,"N",014,2})
AADD(aStru054,{"A54_VALDES"	,"N",014,2})
AADD(aStru054,{"A54_BSICM"	,"N",014,2})
AADD(aStru054,{"A54_BRICMS"	,"N",014,2})
AADD(aStru054,{"A54_VALIPI"	,"N",014,2})
AADD(aStru054,{"A54_ALQICM"	,"N",005,2})

cArq054	:=	CriaTrab(aStru054)
dbUseArea(.T.,__LocalDriver,cArq054,"R54")
IndRegua("R54",cArq054,"A54_CNPJ+A54_SERIE+A54_NFISC+A54_NUMITE")

//зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁArquivo do Registro tipo 55 - Guia Nacional de Recolhimento de Tributos EstaduaisЁ
//юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru055,{"A55_CNPJ"	,"C",014,0})
AADD(aStru055,{"A55_IE"		,"C",014,0})
AADD(aStru055,{"A55_DATPAG"	,"D",008,0})
AADD(aStru055,{"A55_UFSUBS"	,"C",002,0})
AADD(aStru055,{"A55_UFFAV"	,"C",002,0})
AADD(aStru055,{"A55_BANCO"	,"C",003,0})
AADD(aStru055,{"A55_AGENC"	,"C",004,0})
AADD(aStru055,{"A55_NUMERO"	,"C",020,0})
AADD(aStru055,{"A55_VALOR"	,"N",014,2})
AADD(aStru055,{"A55_VENCTO"	,"D",008,0})
AADD(aStru055,{"A55_MESANO"	,"C",006,0})
AADD(aStru055,{"A55_CONVEN"	,"C",030,0})

cArq055	:=	CriaTrab(aStru055)
dbUseArea(.T.,__LocalDriver,cArq055,"R55")
IndRegua("R55",cArq055,"DTOS(A55_DATPAG)") 


If mv_par15==3

	//зддддддддддддддддддддддддддддд©
	//ЁArquivo do Registro tipo 61R Ё
	//юддддддддддддддддддддддддддддды
	aCampos	:=	{}
	AADD(aCampos,{"R61_EMISS"	,"C"	,006,0})
	AADD(aCampos,{"R61_PRODSV"	,"C"	,014,0})	
	AADD(aCampos,{"R61_QUANT"	,"N"	,013,3})
	AADD(aCampos,{"R61_VALOR"	,"N"	,016,2})
	AADD(aCampos,{"R61_BICMS"	,"N"	,016,2})
	AADD(aCampos,{"R61_ALIQ"	,"N"	,005,2})

	cArq61R	:=	CriaTrab(aCampos)
	dbUseArea(.T.,__LocalDriver,cArq61R,cArq61R,.T.,.F.)
	IndRegua(cArq61R,cArq61R,"R61_EMISS+R61_PRODSV+STR(R61_ALIQ,5,2)",,,STR0071 )  //"Indexando Registro Tipo 61R"

	//зддддддддддддддддддддддддддддд©
	//ЁArq. do Registro tipo AD404-DЁ
	//юддддддддддддддддддддддддддддды
	aCampos	:=	{}
	AADD(aCampos,{"AD4TIPO"  ,"C"	,001,0})
	AADD(aCampos,{"AD4INSC"  ,"C"	,010,0})	
	AADD(aCampos,{"AD4MODELO","C"	,002,0})
	AADD(aCampos,{"AD4SERIE" ,"C"	,003,0})
	AADD(aCampos,{"AD4NUMERO","C"	,006,0})
	AADD(aCampos,{"AD4EMISS" ,"D"	,008,0})
	AADD(aCampos,{"AD4VALOR" ,"N"	,013,2})

	cArqAD4	:=	CriaTrab(aCampos)
	dbUseArea(.T.,__LocalDriver,cArqAD4,cArqAD4,.T.,.F.)
	IndRegua(cArqAD4,cArqAD4,"AD4TIPO+AD4INSC+AD4NUMERO+AD4SERIE+Dtos(AD4EMISS)",,,STR0079 )  //"Indexando Registro Tipo 88 Detalhe 04"

	//зддддддддддддддддддддддддддддд©
	//ЁArq. do Registro tipo AD410-HЁ
	//юддддддддддддддддддддддддддддды
	aCampos	:=	{}
	AADD(aCampos,{"D10CNPJ"  ,"C"	,014,0})
	AADD(aCampos,{"D10MODDES","C"	,002,0})	
	AADD(aCampos,{"D10SERDES","C"	,003,0})
	AADD(aCampos,{"D10SBSRDS","C"	,002,0})
	AADD(aCampos,{"D10NUMDES","C"	,006,0})
	AADD(aCampos,{"D10CFOP"  ,"C"	,004,0})
	AADD(aCampos,{"D10IT_DES","C"	,003,0})
	AADD(aCampos,{"D10INSCIN","C"	,014,0})
	AADD(aCampos,{"D10UFINC" ,"C"	,002,0})
	AADD(aCampos,{"D10MODINC","C"	,002,0})
	AADD(aCampos,{"D10SERINC","C"	,003,0})
	AADD(aCampos,{"D10SBSRIN","C"	,002,0})
	AADD(aCampos,{"D10NUMINC","C"	,006,0})
	AADD(aCampos,{"D10EMIINC","C"	,008,0})
	AADD(aCampos,{"D10QUANT" ,"C"	,005,0})
	AADD(aCampos,{"D10VALOR" ,"N"	,013,2})

	cArqD10	:=	CriaTrab(aCampos)
	dbUseArea(.T.,__LocalDriver,cArqD10,cArqD10,.T.,.F.)
	IndRegua(cArqD10,cArqD10,"D10CNPJ+D10NUMDES+D10SERDES",,,STR0078 )  //"Indexando Registro Tipo 88 Detalhe 10"
EndIf	

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro 060 - ECF(Mestre do equipamento)                               Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru060M,{"M60_EMISS"	,"D",008,0})
AADD(aStru060M,{"M60_NUMFAB","C",020,0})
AADD(aStru060M,{"M60_PDV"	,"C",003,0})
AADD(aStru060M,{"M60_MODELO","C",002,0})
AADD(aStru060M,{"M60_NUMINI","C",006,0})
AADD(aStru060M,{"M60_NUMFIM","C",006,0})
AADD(aStru060M,{"M60_REDUCZ","C",006,0})
AADD(aStru060M,{"M60_CRO"	,"N",003,0})
AADD(aStru060M,{"M60_VENDA"	,"N",016,2})
AADD(aStru060M,{"M60_GERAL"	,"N",016,2})

cArq060M :=	CriaTrab(aStru060M)
dbUseArea(.T.,__LocalDriver,cArq060M,"M60")
IndRegua("M60",cArq060M,"DTOS(M60_EMISS)+M60_PDV")

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro 060A - ECF(Analitico)                                          Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru060A,{"A60_EMISS"	,"D",008,0})
AADD(aStru060A,{"A60_NUMFAB","C",020,0})
AADD(aStru060A,{"A60_SITTRI","C",004,0})
AADD(aStru060A,{"A60_VALOR"	,"N",014,2})
AADD(aStru060A,{"A60_PDV"	,"C",003,0})
cArq060A	:=	CriaTrab(aStru060A)
dbUseArea(.T.,__LocalDriver,cArq060A,"A60")
IndRegua("A60",cArq060A,"DTOS(A60_EMISS)+A60_NUMFAB+A60_SITTRI")

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro 060D - ECF ( Resumo Diario )                                   Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru060D,{"D60_EMISS"	,"D",008,0})
AADD(aStru060D,{"D60_NUMFAB","C",020,0})
AADD(aStru060D,{"D60_CODPRO","C",014,0})
AADD(aStru060D,{"D60_QUANT" ,"N",013,3})
AADD(aStru060D,{"D60_VALOR" ,"N",016,2})
AADD(aStru060D,{"D60_BSICM" ,"N",016,2})
AADD(aStru060D,{"D60_SITTRI","C",004,0})
AADD(aStru060D,{"D60_VLICM" ,"N",013,0})
cArq060D	:=	CriaTrab(aStru060D)
dbUseArea(.T.,__LocalDriver,cArq060D,"D60")
IndRegua("D60",cArq060D,"DTOS(D60_EMISS)+D60_CODPRO")

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro 060I - ECF ( Itens do documento )                              Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru060I,{"I60_EMISS" ,"D",008,0})
AADD(aStru060I,{"I60_NUMFAB","C",020,0})
AADD(aStru060I,{"I60_MODELO","C",002,0})
AADD(aStru060I,{"I60_COO"   ,"C",006,0})
AADD(aStru060I,{"I60_ITEM"  ,"C",003,0})
AADD(aStru060I,{"I60_CODPRO","C",014,0})
AADD(aStru060I,{"I60_QUANT" ,"N",013,3})
AADD(aStru060I,{"I60_VLUNI" ,"N",013,3})
AADD(aStru060I,{"I60_BSICM" ,"N",012,2})
AADD(aStru060I,{"I60_SITTRI","C",004,0})
AADD(aStru060I,{"I60_VLICM" ,"N",012,0})
cArq060I	:=	CriaTrab(aStru060I)
dbUseArea(.T.,__LocalDriver,cArq060I,"I60")
IndRegua("I60",cArq060I,"DTOS(I60_EMISS)+I60_CODPRO")

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro 060R - ECF ( Resumo Mensal )                                   Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru060R,{"R60_MESANO","C",006,0})
AADD(aStru060R,{"R60_CODPRO","C",014,0})
AADD(aStru060R,{"R60_QUANT" ,"N",013,3})
AADD(aStru060R,{"R60_VALOR" ,"N",016,2})
AADD(aStru060R,{"R60_BSICM" ,"N",016,2})
AADD(aStru060R,{"R60_SITTRI","C",004,0})
cArq060R	:=	CriaTrab(aStru060R)
dbUseArea(.T.,__LocalDriver,cArq060R,"R60")
IndRegua("R60",cArq060R,"R60_MESANO+R60_CODPRO+R60_SITTRI")

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁArquivo do Registro tipo 61 - Docs.Fiscais nao emitidos por ECF Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru061,{"A61_EMISS"	,"D",008,0})
AADD(aStru061,{"A61_MODELO"	,"C",002,0})
AADD(aStru061,{"A61_SERIE"	,"C",003,0})
AADD(aStru061,{"A61_SUBSER"	,"C",002,0})
AADD(aStru061,{"A61_NUMINI"	,"C",006,0})
AADD(aStru061,{"A61_NUMFIM"	,"C",006,0})
AADD(aStru061,{"A61_VALTOT"	,"N",014,2})
AADD(aStru061,{"A61_BSICM"	,"N",014,2})
AADD(aStru061,{"A61_VALICM"	,"N",014,2})
AADD(aStru061,{"A61_ISENTA"	,"N",014,2})
AADD(aStru061,{"A61_OUTRAS"	,"N",014,2})
AADD(aStru061,{"A61_ALQICM"	,"N",005,2})
AADD(aStru061,{"A61_CODMUN"	,"C",005,0})
AADD(aStru061,{"A61_ANOAID"	,"C",004,0})
AADD(aStru061,{"A61_NUMAID"	,"C",005,0})
AADD(aStru061,{"A61_OBS"    ,"C",035,0})
AADD(aStru061,{"A61_SITUAC" ,"C",001,0})
cArq061	:=	CriaTrab(aStru061)
dbUseArea(.T.,__LocalDriver,cArq061,"R61")
IndRegua("R61",cArq061,"DTOS(A61_EMISS)")

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro 070 - Documento de Conhecimento de Transporte                  Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru070,{"A70_CNPJ"	,"C",014,0})
AADD(aStru070,{"A70_IE"		,"C",014,0})
AADD(aStru070,{"A70_EMISS"	,"D",008,0})
AADD(aStru070,{"A70_UF"		,"C",002,0})
AADD(aStru070,{"A70_MODELO"	,"C",002,0})
AADD(aStru070,{"A70_SERIE"	,"C",001,0})
AADD(aStru070,{"A70_SUBSER"	,"C",002,0})
AADD(aStru070,{"A70_NFISC"	,"C",006,0})
AADD(aStru070,{"A70_CFOP"	,"C",004,0})
AADD(aStru070,{"A70CFOPEXT"	,"C",002,0})
AADD(aStru070,{"A70_VALTOT"	,"N",015,2})
AADD(aStru070,{"A70_BSICM"	,"N",015,2})
AADD(aStru070,{"A70_VALICM"	,"N",015,2})
AADD(aStru070,{"A70_ISENTA"	,"N",015,2})
AADD(aStru070,{"A70_OUTRAS"	,"N",015,2})
AADD(aStru070,{"A70_CIfFOB"	,"C",001,0})
AADD(aStru070,{"A70_SITUAC"	,"C",001,0})
AADD(aStru070,{"A70_CODMUN"	,"C",005,0})
AADD(aStru070,{"A70_ANOAID"	,"C",004,0})
AADD(aStru070,{"A70_NUMAID"	,"C",005,0})

cArq070	:=	CriaTrab(aStru070)
dbUseArea(.T.,__LocalDriver,cArq070,"R70")
IndRegua("R70",cArq070,"DTOS(A70_EMISS)")

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro 071 - Complemento do Conhecimento de Transporte                Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru071,{"A71_CGCTOM"	,"C",014,0})
AADD(aStru071,{"A71_IETOM"	,"C",014,0})
AADD(aStru071,{"A71_DTCONH"	,"D",008,0})
AADD(aStru071,{"A71_UFTOM"	,"C",002,0})
AADD(aStru071,{"A71_MODCON"	,"C",002,0})
AADD(aStru071,{"A71_SERCON"	,"C",001,0})
AADD(aStru071,{"A71_SUBCON"	,"C",002,0})
AADD(aStru071,{"A71_NUMCON"	,"C",006,0})
AADD(aStru071,{"A71_UFREM"	,"C",002,0})
AADD(aStru071,{"A71_CGCREM"	,"C",014,0})
AADD(aStru071,{"A71_IEREM"	,"C",014,0})
AADD(aStru071,{"A71_DTNOTA"	,"D",008,0})
AADD(aStru071,{"A71_MODNOT"	,"C",002,0})
AADD(aStru071,{"A71_SERNOT"	,"C",003,0})
AADD(aStru071,{"A71_NUMNOT"	,"C",006,0})
AADD(aStru071,{"A71_VALNOT"	,"N",014,2})
AADD(aStru071,{"A71_SUBNOT"	,"C",002,0})

cArq071	:=	CriaTrab(aStru071)
dbUseArea(.T.,__LocalDriver,cArq071,"R71")
IndRegua("R71",cArq071,"DTOS(A71_DTCONH)")


If mv_par21==2
   //здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
   //ЁRegistro 074 - Registro de Inventario                                   Ё
   //юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	
   AADD(aStru074,{"A74_DTINVE"	,"D",008,0})
   AADD(aStru074,{"A74_PRODUT"	,"C",014,0})
   AADD(aStru074,{"A74_QUANT"	,"N",013,3})
   AADD(aStru074,{"A74_CUSTO"	,"N",013,2})
   AADD(aStru074,{"A74_SITUAC"	,"C",001,0})
   AADD(aStru074,{"A74_CNPJ"	,"C",014,0})
   AADD(aStru074,{"A74_IE"  	,"C",014,0})
   AADD(aStru074,{"A74_UF"  	,"C",002,0})
 
   cArq074  :=	CriaTrab(aStru074)
   dbUseArea(.T.,__LocalDriver,cArq074,"R74")
   IndRegua("R74",cArq074,"DTOS(A74_DTINVE)")
Endif

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro 075 - Relacao de Produtos e Servicos                           Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru075,{"A75_DTAINI"	,"D",008,0})
AADD(aStru075,{"A75_DTAFIM"	,"D",008,0})
AADD(aStru075,{"A75_PROD"	,"C",014,0})
AADD(aStru075,{"A75_CODNCM"	,"C",008,0})
AADD(aStru075,{"A75_DESCR"	,"C",053,0})
AADD(aStru075,{"A75_UM"		,"C",006,0})
AADD(aStru075,{"A75_SITTRI"	,"C",003,0})
AADD(aStru075,{"A75_ALQIPI"	,"N",005,2})
AADD(aStru075,{"A75_ALQICM"	,"N",005,2})
AADD(aStru075,{"A75_REDBSE"	,"N",006,2})
AADD(aStru075,{"A75_BRICMS"	,"N",014,2})
AADD(aStru075,{"A75_EAN"   ,"C"	,014,0})
AADD(aStru075,{"A75_CODFIS"	,"C",007,0})
cArq075	  :=	CriaTrab(aStru075)
dbUseArea(.T.,__LocalDriver,cArq075,"R75")
IndRegua("R75",cArq075,"DTOS(A75_DTAINI)+DTOS(A75_DTAFIM)+A75_PROD+A75_CODNCM+A75_UM")

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro 076 - Nota Fiscal Servico de Comunicacao/Telecomunicacao (mod.21/mod.22) Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru076,{"A76_CNPJ"	,"C",014,0})
AADD(aStru076,{"A76_IE"		,"C",014,0})
AADD(aStru076,{"A76_MODELO"	,"C",002,0})
AADD(aStru076,{"A76_SERIE"	,"C",002,0})
AADD(aStru076,{"A76_SUBSER"	,"C",002,0})
AADD(aStru076,{"A76_NFISC"	,"C",006,0})
AADD(aStru076,{"A76_CFOP"	,"C",004,0})
AADD(aStru076,{"A76_TIPREC"	,"C",001,0})
AADD(aStru076,{"A76_EMISS"	,"D",008,0})
AADD(aStru076,{"A76_UF"		,"C",002,0})
AADD(aStru076,{"A76_VALTOT"	,"N",013,2})
AADD(aStru076,{"A76_BRICMS"	,"N",013,2})
AADD(aStru076,{"A76_VALICM"	,"N",012,2})
AADD(aStru076,{"A76_ISENTA"	,"N",012,2})
AADD(aStru076,{"A76_OUTRAS"	,"N",012,2})
AADD(aStru076,{"A76_ALQICM"	,"N",005,2})
AADD(aStru076,{"A76_SITUAC"	,"C",001,0})
AADD(aStru050,{"A76_CODMUN"	,"C",005,0})
AADD(aStru050,{"A76_ANOAID"	,"C",004,0})
AADD(aStru050,{"A76_NUMAID"	,"C",005,0})
AADD(aStru050,{"A76CFOPEXT"	,"C",002,0})

cArq076	:=	CriaTrab(aStru076)
dbUseArea(.T.,__LocalDriver,cArq076,"R76")
IndRegua("R76",cArq076,"DTOS(A76_EMISS)")

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro 077 - Servicos de Comunicacao de Telecomunicacao                         Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru077,{"A77_CNPJ"	,"C",014,0})
AADD(aStru077,{"A77_MODELO"	,"C",002,0})
AADD(aStru077,{"A77_SERIE"	,"C",002,0})
AADD(aStru077,{"A77_SUBSER"	,"C",002,0})
AADD(aStru077,{"A77_NFISC"	,"C",006,0})
AADD(aStru077,{"A77_CFOP"	,"C",004,0})
AADD(aStru077,{"A77_TIPREC"	,"C",001,0})
AADD(aStru077,{"A77_NUMITE"	,"C",003,0})
AADD(aStru077,{"A77_PRODUT"	,"C",011,0})
AADD(aStru077,{"A77_QUANT"	,"N",013,3})
AADD(aStru077,{"A77_VALPRO"	,"N",012,2})
AADD(aStru077,{"A77_VALDES"	,"N",012,2})
AADD(aStru077,{"A77_BSICM"	,"N",012,2})
AADD(aStru077,{"A77_ALQICM"	,"N",005,2})
AADD(aStru077,{"A77_CNPJMF"	,"C",014,0})
AADD(aStru077,{"A77_CODTER"	,"C",010,0})

cArq077	:=	CriaTrab(aStru077)
dbUseArea(.T.,__LocalDriver,cArq077,"R77")
IndRegua("R77",cArq077,"A77_PRODUT")

If mv_par20==1
	//здддддддддддддддддддддддддддд©
	//ЁArquivo do Registro tipo 88CЁ
	//юдддддддддддддддддддддддддддды
	aCampos	:=	{}
	AADD(aCampos,{"A88CCNPJ"	,"C"	,014,0})
	AADD(aCampos,{"A88CMODELO"	,"C"	,002,0})
	AADD(aCampos,{"A88CSERIE"	,"C"	,003,0})
	AADD(aCampos,{"A88CSUBSER"	,"C"	,002,0})
	AADD(aCampos,{"A88CNFISC"	,"C"	,006,0})
	AADD(aCampos,{"A88CCFOP"	,"C"	,004,0})
	AADD(aCampos,{"A88CNUMITE"	,"C"	,003,0})
	AADD(aCampos,{"A88CPRODUT"	,"C"	,014,0})
	AADD(aCampos,{"A88CQUANT"	,"N"	,013,3})
	AADD(aCampos,{"A88CBASEST"	,"N"	,012,2})
	AADD(aCampos,{"A88CVALBSR"	,"N"	,012,2})
	AADD(aCampos,{"A88CVALBSC"	,"N"	,012,2})
	AADD(aCampos,{"A88CCLIFOR"	,"C"	,006,0})
	AADD(aCampos,{"A88CLOJA"	,"C"	,002,0})

	cArq088C	:=	CriaTrab(aCampos)

	dbUseArea(.T.,__LocalDriver,cArq088C,cArq088C,.T.,.F.)
	IndRegua(cArq088C,cArq088C,"A88CCNPJ+A88CSERIE+A88CSUBSER+A88CNFISC+A88CNUMITE",,,"Indexando Registro Tipo 88C" ) //

	//здддддддддддддддддддддддддддд©
	//ЁArquivo do Registro tipo 88DЁ
	//юдддддддддддддддддддддддддддды
	aCampos	:=	{}
	AADD(aCampos,{"A88DCNPJ"	,"C"	,014,0})
	AADD(aCampos,{"A88DIE"		,"C"	,014,0})
	AADD(aCampos,{"A88DUF"		,"C"	,002,0})
	AADD(aCampos,{"A88DMODELO"	,"C"	,002,0})
	AADD(aCampos,{"A88DSERIE"	,"C"	,003,0})
	AADD(aCampos,{"A88DSUBSER"	,"C"	,002,0})
	AADD(aCampos,{"A88DNFISC"	,"C"	,006,0})
	AADD(aCampos,{"A88DCFOP"	,"C"	,004,0})
	AADD(aCampos,{"A88DEMISS"	,"D"	,008,0})
	AADD(aCampos,{"A88DENTSAI"	,"D"	,008,0})
	AADD(aCampos,{"A88DALQICM"	,"N"	,005,2})

	cArq088D :=	CriaTrab(aCampos)
	cArq088A := Left(cArq088D,6)+"A"
	dbUseArea(.T.,__LocalDriver,cArq088D,cArq088D,.T.,.F.)
	IndRegua(cArq088D,cArq088D,"dtos(A88DEMISS)",,,"Indexando Registro tipo 88D")
	IndRegua(cArq088D,cArq088A,"A88DSERIE+A88DNFISC+STR(A88DALQICM,5,2)+A88DCFOP+A88DCNPJ",,,"Indexando Registro tipo 88D")
	DbSelectArea(cArq088D)
	DbClearIndex()
	DbSetIndex(cArq088D+OrdBagExt())
	DbSetIndex(cArq088A+OrdBagExt())
	dbSetOrder(2)
	dbSelectArea(cAlias)

	//здддддддддддддддддддддддддддд©
	//ЁArquivo do Registro tipo 88EЁ
	//юдддддддддддддддддддддддддддды
	aCampos	:=	{}
	AADD(aCampos,{"A88ECNPJ"	,"C"	,014,0})
	AADD(aCampos,{"A88EIE"		,"C"	,014,0})
	AADD(aCampos,{"A88ECOD"		,"C"	,014,0})
	AADD(aCampos,{"A88ECODSEF"	,"C"	,014,0})
	cArq088E	:=	CriaTrab(aCampos)
	dbUseArea(.T.,__LocalDriver,cArq088E,cArq088E,.T.,.F.)
	IndRegua(cArq088E,cArq088E,"A88ECOD",,,"Indexando Registro Tipo 88E" )
	DbSelectArea(cArq088E)
	DbClearIndex()
	DbSetIndex(cArq088E+OrdBagExt())
	dbSelectArea(cAlias)

	//здддддддддддддддддддддддддддд©
	//ЁArquivo do Registro tipo 88MЁ
	//юдддддддддддддддддддддддддддды
	aCampos	:=	{}
	AADD(aCampos,{"A88MCNPJ"	,"C"	,014,0})
	AADD(aCampos,{"A88MMENS"	,"C"	,034,0})
	cArq088M	:=	CriaTrab(aCampos)
	dbUseArea(.T.,__LocalDriver,cArq088M,cArq088M,.T.,.F.)
	IndRegua(cArq088M,cArq088M,"A88MCNPJ",,,"Indexando Registro Tipo 88M" ) //
	DbSelectArea(cArq088M)
	DbClearIndex()
	DbSetIndex(cArq088M+OrdBagExt())
	dbSelectArea(cAlias)

	//здддддддддддддддддддддддддддд©
	//ЁArquivo do Registro tipo 88QЁ
	//юдддддддддддддддддддддддддддды
	aCampos	:=	{}
	AADD(aCampos,{"A88QDATA"	,"D"	,008,0})
	AADD(aCampos,{"A88QPROD"	,"C"	,014,0})
	AADD(aCampos,{"A88QQUANT"	,"N"	,013,3})
	AADD(aCampos,{"A88QTOT"		,"N"	,013,3})
	AADD(aCampos,{"A88QPOSSE"	,"C"	,001,0})
	cArq088Q	:=	CriaTrab(aCampos)
	dbUseArea(.T.,__LocalDriver,cArq088Q,cArq088Q,.T.,.F.)
	IndRegua(cArq088Q,cArq088Q,"A88QPROD+DTOS(A88QDATA)",,,"Indexando Registro Tipo 88Q" ) //
	DbSelectArea(cArq088Q)
	DbClearIndex()
	DbSetIndex(cArq088Q+OrdBagExt())
	dbSelectArea(cAlias)
Endif

If mv_par15 == 3 //DIC
	//здддддддддддддддддддддддддддддддддддддд©
	//ЁArquivo do Registro Tipo 88 Detalhe 50Ё
	//юдддддддддддддддддддддддддддддддддддддды
	aCampos	:=	{}
	AADD(aCampos,{"A8850CNPJ"		,"C",014,0})
	AADD(aCampos,{"A8850EMISS"		,"D",008,0})
	AADD(aCampos,{"A8850UF"			,"C",002,0})
	AADD(aCampos,{"A8850MODEL"	    ,"C",002,0})
	AADD(aCampos,{"A8850SERIE"		,"C",003,0})
	AADD(aCampos,{"A8850NFISC"		,"C",006,0})
	AADD(aCampos,{"A8850SUFRA"		,"C",014,0})
	AADD(aCampos,{"A8850OBS"	    ,"C",035,0})
	AADD(aCampos,{"A8850CONTA"	    ,"C",015,0})
	cArq08850	:=	CriaTrab(aCampos)
	dbUseArea(.T.,__LocalDriver,cArq08850,cArq08850,.T.,.F.)
	IndRegua(cArq08850,cArq08850,"A8850CNPJ+A8850SERIE+A8850NFISC",,,"Indexando Registro Tipo 88 Detalhe 50" ) 
    DbSelectArea(cArq08850)
	DbClearIndex()   
    DbSetIndex(cArq08850+OrdBagExt())
	DbSelectArea(cArq08850)
EndIf

IF lcArq088	
	cArq088 := execBlock("M940TP88")
EndIf	


//зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁArquivo do Registro tipo 90 - Totalizador do Arquivo                             Ё
//юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
AADD(aStru090,{"A90_REGS"	,"C",126,0})

cArq090	:=	CriaTrab(aStru090)
dbUseArea(.T.,__LocalDriver,cArq090,"R90")
IndRegua("R90",cArq090,"LEFT(A90_REGS,10)") 

If mv_par21==1
   FsEstInv({"R74",""},1,.T.,.F.,,.T.)
   If mv_par21 == 1 .and. MV_PAR15 == 3 .and. Month(dDtFim) == 1
      dbSelectArea("SB1")
      dbSetOrder(1)
      DbGoTop()

      While !eof() 
            cCodProd:= B1_COD
            aEstMPI := IIF(B1_TIPO == "MP" .AND. B1_ORIGEM $ "00/01/10/20/50/51/60/70",FsPrdInv(cCodProd,.F.,StoD(strzero(YEAR(dDtFim)-2,4)+"1231")),"")
            aEstPAI := IIF(B1_TIPO == "PA" .AND. B1_ORIGEM $ "00/01/10/20/50/51/60/70",FsPrdInv(cCodProd,.F.,StoD(strzero(YEAR(dDtFim)-2,4)+"1231")),"")
            aEstISI := IIF(B1_ORIGEM $ "04",FsPrdInv(cCodProd,.F.,StoD(strzero(YEAR(dDtFim)-2,4)+"1231")),"")
            aEstANI := IIF(B1_ORIGEM $ "06",FsPrdInv(cCodProd,.F.,StoD(strzero(YEAR(dDtFim)-2,4)+"1231")),"")            
            aEstMPF := IIF(B1_TIPO == "MP" .AND. B1_ORIGEM $ "00/01/10/20/50/51/60/70",FsPrdInv(cCodProd,.F.,StoD(strzero(YEAR(dDtFim)-1,4)+"1231")),"")
            aEstPAF := IIF(B1_TIPO == "PA" .AND. B1_ORIGEM $ "00/01/10/20/50/51/60/70",FsPrdInv(cCodProd,.F.,StoD(strzero(YEAR(dDtFim)-1,4)+"1231")),"")
            aEstISF := IIF(B1_ORIGEM $ "04",FsPrdInv(cCodProd,.F.,StoD(strzero(YEAR(dDtFim)-1,4)+"1231")),"")
            aEstANF := IIF(B1_ORIGEM $ "06",FsPrdInv(cCodProd,.F.,StoD(strzero(YEAR(dDtFim)-1,4)+"1231")),"")            
            IIF(valtype(aEstMPI)=="A",nValMPI+=aEstMPI[1][2],.T.)
            IIF(valtype(aEstMPF)=="A",nValMPF+=aEstMPF[1][2],.T.)
            IIF(valtype(aEstPAI)=="A",nValPAI+=aEstPAI[1][2],.T.)
            IIF(valtype(aEstPAF)=="A",nValPAF+=aEstPAF[1][2],.T.)
            IIF(valtype(aEstISI)=="A",nValISI+=aEstISI[1][2],.T.)
            IIF(valtype(aEstISF)=="A",nValISF+=aEstISF[1][2],.T.)
            IIF(valtype(aEstANI)=="A",nValANI+=aEstANI[1][2],.T.)
            IIF(valtype(aEstANF)=="A",nValANF+=aEstANF[1][2],.T.)
            DbSkip()
      EndDo
   EndIf   
Endif   

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁProcessamento dos documentos Fiscais                                    Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
dbSelectArea("SF3")
dbSetOrder(1)
ProcRegua(LastRec())
#IFDEF TOP
    If TcSrvType()<>"AS/400"
	    lQuery := .T.
		cAliasSF3 := "SF3_SINTEGRA"
		aStruSF3  := SF3->(dbStruct())
		cQuery := "SELECT * "
		cQuery += "FROM "+RetSqlName("SF3")+" "
		cQuery += "WHERE F3_FILIAL='"+xFilial("SF3")+"' AND "
		cQuery += "F3_ENTRADA>='"+Dtos(dDtIni)+"' AND "
		cQuery += "F3_ENTRADA<='"+Dtos(dDtFim)+"' AND "	
		If cNrLivro <> "*"
			cQuery += "F3_NRLIVRO ='"+ cNrLivro +"' AND "
		EndIf	
		If !Empty(cDesCfop)
			cQuery += "F3_CFO NOT IN('"+RetPar(cDesCfop)+"') AND "
		Endif
		If !Empty(cEstDest)
			If lListEst
				cQuery += "F3_ESTADO ='"+ cEstDest+"' AND "
			Else
				cQuery += "F3_ESTADO <>'"+ cEstDest+"' AND "
			EndIf
		EndIf			
		If mv_par13 == 1 	//Entrada
			cQuery	+=	"(F3_CFO LIKE '1%' OR F3_CFO LIKE '2%' OR F3_CFO LIKE '3%') AND "
		Elseif mv_par13 == 2 				//Saida
			cQuery	+=	"(F3_CFO LIKE '5%' OR F3_CFO LIKE '6%' OR F3_CFO LIKE '7%') AND "
		Endif            	
		cQuery += "F3_TIPO NOT IN('S') AND "
		If mv_par14 == 4
			cQuery += "F3_TIPO = 'D' AND "
			cQuery += "F3_CFO < '5' AND "
		Endif
		cQuery += "D_E_L_E_T_ = ' ' "
		cQuery += "ORDER BY "+SqlOrder(SF3->(IndexKey()))
	
		cQuery := ChangeQuery(cQuery)
		dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasSF3)
	
		For nX := 1 To len(aStruSF3)
			If aStruSF3[nX][2] <> "C" .And. FieldPos(aStruSF3[nX][1])<>0
				TcSetField(cAliasSF3,aStruSF3[nX][1],aStruSF3[nX][2],aStruSF3[nX][3],aStruSF3[nX][4])
			EndIf
		Next nX
		dbSelectArea(cAliasSF3)	
	Else
#ENDIF
	    cIndex    := CriaTrab(NIL,.F.)
	    cCondicao := 'F3_FILIAL=="'+xFilial("SF3")+'".And.'
	   	cCondicao += 'DTOS(F3_ENTRADA)>="'+DTOS(dDtIni)+'".And.DTOS(F3_ENTRADA)<="'+DTOS(dDtFim)+'" '
	    If cNrLivro <> "*"
		    cCondicao += '.And.F3_NRLIVRO ="'+ cNrLivro +'" '
	   	EndIf	
		If !Empty(cDesCfop)
			cCondicao += '.And. !(Alltrim(F3_CFO) $ "'+cDesCfop+'") '
		Endif
	    If !Empty(cEstDest)
		    If lListEst
			    cCondicao += '.And. F3_ESTADO ="'+ cEstDest+'" '
	  		Else
			    cCondicao += '.And. F3_ESTADO <> "'+ cEstDest+'" '
		    EndIf
	    EndIf			
	   	If mv_par13 == 1 	//Entrada
			cCondicao += '.And. Left(F3_CFO,1)$"1,2,3"'
		Elseif mv_par13 == 2 				//Saida
			cCondicao += '.And. Left(F3_CFO,1)$"5,6,7"'
		Endif            	
	    cCondicao += '.And. F3_TIPO <> "S" '
	    If mv_par14 == 4
	 	    cCondicao += '.And. F3_TIPO = "D" '
		    cCondicao += '.And. Substr(F3_CFO,1,1) < "5" '
	    Endif
	    IndRegua(cAliasSF3,cIndex,SF3->(IndexKey()),,cCondicao)
	    nIndex := RetIndex("SF3")
	    dbSelectArea("SF3")
		#IFNDEF TOP 
			dbSetIndex(cIndex+OrdBagExt())
		#ENDIF
	    dbSetOrder(nIndex+1)
	    dbSelectArea(cAliasSF3)
	    ProcRegua(LastRec())
	    dbGoTop()
#IFDEF TOP
	Endif    
#ENDIF

While (cAliasSF3)->(!Eof()) 

	IncProc(STR0004) //"Preparando Base de Dados 1/2"
    
	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Verifica o cliente/fornecedor                                          Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	If (SubStr((cAliasSF3)->F3_CFO,1,1)>="5" .And. (cAliasSF3)->F3_TIPO$"BD") .Or.;
	   (SubStr((cAliasSF3)->F3_CFO,1,1)<"5" .And. !(cAliasSF3)->F3_TIPO$"BD")
		
		dbSelectArea("SA2")
		dbSetOrder(1)
		MsSeek(xFilial("SA2")+(cAliasSF3)->F3_CLIEFOR+(cAliasSF3)->F3_LOJA)				
		cCNPJ := A940CNPJ(SA2->A2_CGC,SA2->A2_TIPO)
		cIE   := A940IE(SA2->A2_INSCR)
		cTranspCGC	:=	SA2->A2_CGC
		cTranspIns	:=	aRETDIG(SA2->A2_INSCR,.t.,(cAliasSF3)->F3_ESTADO)
		cTranspEst	:=	SA2->A2_EST
		cSuframa    := "00000000000000"
	    cCodMun 	:= SA2->A2_COD_MUN
	Else
		dbSelectArea("SA1")
		dbSetOrder(1)				
		MsSeek(xFilial("SA1")+(cAliasSF3)->F3_CLIEFOR+(cAliasSF3)->F3_LOJA)
		cCNPJ := A940CNPJ(SA1->A1_CGC,SA1->A1_TIPO)			
		cIE   := A940IE(SA1->A1_INSCR)
		cTranspCGC	:=	SA1->A1_CGC
		cTranspIns	:=	aRETDIG(SA1->A1_INSCR,.t.,(cAliasSF3)->F3_ESTADO)
		cTranspEst	:=	SA1->A1_EST 
		cSuframa    := (strzero(val(SA1->A1_SUFRAMA)))
		cCodMun 	:= SA1->A1_COD_MUN
	EndIf

	If mv_par20==1
	   nPos:=Ascan(aMovimen,{|x|x[1]==ALLTRIM(STR(MONTH((cAliasSF3)->F3_ENTRADA)))+ALLTRIM(STR(YEAR((cAliasSF3)->F3_ENTRADA)))})
	   If nPos==0
		  AADD(aMovimen,{ALLTRIM(STR(MONTH((cAliasSF3)->F3_ENTRADA)))+ALLTRIM(STR(YEAR((cAliasSF3)->F3_ENTRADA))),"OK"})
	   Endif
	Endif

	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Gravacao do registro 51                                                Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	If (Empty((cAliasSF3)->F3_ESPECIE) .Or. AModNot((cAliasSF3)->F3_ESPECIE)=="01") .And.;
			((cAliasSF3)->F3_VALIPI+(cAliasSF3)->F3_ISENIPI+(cAliasSF3)->F3_OUTRIPI)>0 .And. (cAliasSF3)->F3_TIPO <> "L"

		RecLock("R51",.T.)
		R51->A51_CNPJ	:=	cCNPJ
		R51->A51_IE		:=	cIE
		R51->A51_EMISS	:=	(cAliasSF3)->F3_ENTRADA
		R51->A51_UF		:=	(cAliasSF3)->F3_ESTADO
		R51->A51_SERIE	:=	(cAliasSF3)->F3_SERIE
		R51->A51_NFISC	:=	(cAliasSF3)->F3_NFISCAL
		R51->A51_CFOP	:=	(cAliasSF3)->F3_CFO
		R51->A51_VALTOT	:=	(cAliasSF3)->F3_VALCONT
		R51->A51_VALIPI	:=	(cAliasSF3)->F3_VALIPI
		R51->A51_ISENTA	:=	(cAliasSF3)->F3_ISENIPI
		R51->A51_OUTRAS	:=	(cAliasSF3)->F3_OUTRIPI
		R51->A51_SITUAC	:= IIf(("CANCELAD"$(cAliasSF3)->F3_OBSERV .Or.!empty((cAliasSF3)->F3_DTCANC)),"S","N")
		R51->A51_BASIPI := If((cAliasSF3)->F3_BASEIPI>0,(cAliasSF3)->F3_BASEIPI,(cAliasSF3)->F3_VALCONT)

		MsUnlock()
	EndIf
	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Gravacao do registro 53                                                Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	If 	((cAliasSF3)->F3_BASERET+(cAliasSF3)->F3_ICMSRET) > 0 .And.;
		(cAliasSF3)->F3_TIPO <> "L"

		RecLock("R53",.T.)
		R53->A53_CNPJ  	:=	cCNPJ
		R53->A53_IE		:=  cIE
		R53->A53_EMISS	:=	(cAliasSF3)->F3_ENTRADA
		R53->A53_UF		:=	(cAliasSF3)->F3_ESTADO
		R53->A53_MODELO	:=	AModNot((cAliasSF3)->F3_ESPECIE)
		R53->A53_SERIE	:=	(cAliasSF3)->F3_SERIE
		R53->A53_NFISC	:=	(cAliasSF3)->F3_NFISCAL
		R53->A53_CFOP	:=	(cAliasSF3)->F3_CFO
		R53->A53_EMIT   :=	IIf((cAliasSF3)->F3_FORMUL=="S".Or.SubStr((cAliasSF3)->F3_CFO,1,1)>="5","P","T")
		R53->A53_BRICMS	:=	(cAliasSF3)->F3_BASERET
		R53->A53_VALRET	:=	(cAliasSF3)->F3_ICMSRET
		R53->A53_DESPES	:=	(cAliasSF3)->F3_DESPESA
		R53->A53_SITUAC	:=	IIf(("CANCELAD"$(cAliasSF3)->F3_OBSERV .Or.!empty((cAliasSF3)->F3_DTCANC)),"S","N")
	    If Subs((cAliasSF3)->F3_CFO,1,1)$"5"
		   nVal88St  +=(cAliasSF3)->F3_ICMSRET
        Endif
		MsUnlock()
	EndIf	
    
	dbSelectArea(cAliasSF3)
	cChave := (cAliasSF3)->F3_NFISCAL+(cAliasSF3)->F3_SERIE+(cAliasSF3)->F3_CLIEFOR+(cAliasSF3)->F3_LOJA
	Aadd(aArrayF3,{;
	(cAliasSF3)->F3_NFISCAL,;
	(cAliasSF3)->F3_SERIE,;
	(cAliasSF3)->F3_CLIEFOR,;
	(cAliasSF3)->F3_LOJA,;
	(cAliasSF3)->F3_CFO,;
	(cAliasSF3)->F3_TIPO,;
	(cAliasSF3)->F3_ESPECIE,;
	(cAliasSF3)->F3_ALIQICM,;
	(cAliasSF3)->F3_PDV,;
	(cAliasSF3)->F3_ENTRADA,;
	(cAliasSF3)->F3_ICMSRET,;
	(cAliasSF3)->F3_ISENICM,;
	(cAliasSF3)->F3_DTCANC,;
	(cAliasSF3)->F3_CODISS,;
	(cAliasSF3)->F3_OUTRICM,;
	(cAliasSF3)->F3_VALICM,;
	(cAliasSF3)->F3_VALCONT,;
	(cAliasSF3)->F3_EMISSAO,;
	(cAliasSF3)->F3_BASEICM,;
	(cAliasSF3)->F3_OBSERV,;
	(cAliasSF3)->F3_FORMUL,;
	(cAliasSF3)->F3_ESTADO,;
	(cAliasSF3)->F3_DESPESA,;
	(cAliasSF3)->F3_FORMULA,;
	cCodMun,;
	(cAliasSF3)->F3_CONTA,;
	cSuframa,;
	nValFrete,;
 	If(SF3->(Fieldpos("F3_CFOEXT"))>0,(cAliasSF3)->F3_CFOEXT,space(02)),;
 	"",;	//30 - Ano da AIDF - DIC-SE
 	"",;						//31 - Numero da AIDF - DIC-SE
 	(cAliasSF3)->F3_BASERET})	//32 - F3_BASERET

	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Implementacao DIC-SE                                                   Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	If lAIDF
		If SF3->(FieldPos(aAIDF[1])) > 0	//Ano da AIDF - DIC-SE
			aArrayF3[Len(aArrayF3)][30] := &(aAIDF[1])
		Endif
		If SF3->(FieldPos(aAIDF[2])) > 0 	//Numero da AIDF - DIC-SE
			aArrayF3[Len(aArrayF3)][31] := &(aAIDF[2])
		Endif
	Endif
	
	dbSkip()
	
	If cChave <> (cAliasSF3)->F3_NFISCAL+(cAliasSF3)->F3_SERIE+(cAliasSF3)->F3_CLIEFOR+(cAliasSF3)->F3_LOJA
		//здддддддддддддддддддддддддддддддддддддддддд©
		//ЁMonta Registro Tipo 54 e Registro Tipo 75 Ё
		//юдддддддддддддддддддддддддддддддддддддддддды
		If (Empty(aArrayF3[1][7]).Or. AModNot(aArrayF3[1][7])$"01/02/04") .And. aArrayF3[1][6] <> "L"

			If Substr(aArrayF3[1][5],1,1)<"5" .And. (Empty(aArrayF3[1][7]) .Or. AModNot(aArrayF3[1][7])=="01")
			    SF1->( dbSetOrder(1) )
				SF1->( MsSeek(xFilial("SF1")+aArrayF3[1][1]+aArrayF3[1][2]+aArrayF3[1][3]+aArrayF3[1][4]))

				//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
				//Ё Registro adicional para Frete,Seguro e Outras Despesas       Ё
				//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
				If SF1->(!Eof()) 
					For nI := 1 to 4
						If nI == 4
							aRelImp	   := MaFisRelImp("MT100",{ "SF1" })
							nPsVlPisEn := 0
							nValPis    := 0
							If !Empty( nScanPis := aScan(aRelImp,{|x| x[1]=="SF1" .And. x[3]=="NF_VALPS2"} ) )
								cCpVlPisEn := aRelImp[nScanPis,2]
								nPsVlPisEn := SF1->(FieldPos(cCpVlPisEn))
							EndIf 	
							If !Empty( nPsVlPisEn ) 
								nValPis := SF1->( FieldGet( nPsVlPisEn ) )
							EndIf
						Endif
						If (nI == 1 .And. SF1->F1_FRETE > 0) .Or.;
						   (nI == 2 .And. SF1->F1_SEGURO > 0) .Or.;
						   (nI == 3 .And. SF1->F1_DESPESA > 0) .Or.;
						   (nI == 4 .And. nValPis > 0)
							dbSelectArea("R54")
							If !MsSeek(cCNPJ+aArrayF3[1][2]+aArrayF3[1][1]+IIf(nI==1,"991",If(nI==2,"992",If(nI==3,"999","993"))))
								RecLock("R54",.T.)
								R54->A54_CNPJ    := cCNPJ
								R54->A54_MODELO  := AModNot(aArrayF3[1][7])
								R54->A54_SERIE   := aArrayF3[1][2]
								R54->A54_NFISC   := aArrayF3[1][1]
								R54->A54_CFOP    := aArrayF3[1][5]
							    R54->A54CFOPEXT :=	aArrayF3[1][29]
								R54->A54_CST     := "000"
								R54->A54_NUMITE  := IIf(nI==1,"991",If(nI==2,"992",If(nI==3,"999","993"))) //Numero do Item (991-Frete;992 -Seguro;999-Outras despesas acessorias;993-PIS/COFINS)
								R54->A54_QUANT   := 1
								R54->A54_VALPRO  := IIf(nI==1,SF1->F1_FRETE,If(nI==2,SF1->F1_SEGURO,If(nI==3,SF1->F1_DESPESA,nValPis)))
								R54->A54_VALDES  := R54->A54_VALPRO
                                R54->A54_ALQICM  := IIf(nI==4,aArrayF3[1][8],0)
								MsUnlock()  

								If mv_par20==1					
									RecLock(cArq088C,.T.)
									(cArq088C)->A88CNFISC	:=	aArrayF3[1][1]
									(cArq088C)->A88CSERIE	:=	aArrayF3[1][2]
									(cArq088C)->A88CCNPJ	:=	cCNPJ
									(cArq088C)->A88CMODELO	:=	AModNot(aArrayF3[1][7])
									(cArq088C)->A88CCFOP	:=	aArrayF3[1][5]
									(cArq088C)->A88CNUMITE	:= IIf(nI==1,"991",If(nI==2,"992",If(nI==3,"999","993"))) //Numero do Item (991-Frete;992 -Seguro;999-Outras despesas acessorias;993-PIS/COFINS)
									(cArq088C)->A88CQUANT	:= 	1
									(cArq088C)->A88CBASEST	:=0.00
									(cArq088C)->A88CVALBSR	:=0.00
									(cArq088C)->A88CVALBSC	:=0.00
									MsUnlock()
								Endif
								
							EndIf
					    Endif
					Next	   
				EndIf

				SD1->( dbSetOrder(1))

				#IFDEF TOP
				    If TcSrvType()<>"AS/400"
					    cAliasSD1 := "a940ASD1"
						aStru  := SD1->(dbStruct())
						cQuery := "SELECT * "
						cQuery += "FROM "+RetSqlName("SD1")+" "
						cQuery += "WHERE D1_FILIAL='"+xFilial("SD1")+"' AND "
						cQuery += "D1_DOC='"+aArrayF3[1][1]+"' AND "
						cQuery += "D1_SERIE='"+aArrayF3[1][2]+"' AND "
						cQuery += "D1_FORNECE='"+aArrayF3[1][3]+"' AND "
						cQuery += "D1_LOJA='"+aArrayF3[1][4]+"' AND "
						cQuery += "D1_CF NOT IN('000','999') AND "
						cQuery += "D_E_L_E_T_ = ' ' "
						cQuery += "ORDER BY "+SqlOrder(SD1->(IndexKey()))
		
						cQuery := ChangeQuery(cQuery)
						dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasSD1,.T.,.T.)
		
						For nX := 1 To len(aStru)
							If aStru[nX][2] <> "C" .And. FieldPos(aStru[nX][1])<>0
								TcSetField(cAliasSD1,aStru[nX][1],aStru[nX][2],aStru[nX][3],aStru[nX][4])
							EndIf
						Next nX
						dbSelectArea(cAliasSD1)
					Else
				#ENDIF
						(cAliasSD1)->( MsSeek(xFilial("SD1")+aArrayF3[1][1]+aArrayF3[1][2]+aArrayF3[1][3]+aArrayF3[1][4]))
				#IFDEF TOP
					EndIf
				#ENDIf

				nItem	:= 1
			   	 	
			    While (cAliasSD1)->(!Eof()).And. (cAliasSD1)->D1_FILIAL +(cAliasSD1)->D1_DOC + (cAliasSD1)->D1_SERIE+(cAliasSD1)->D1_FORNECE+(cAliasSD1)->D1_LOJA==;
				    xFilial("SD1")+aArrayF3[1][1]+aArrayF3[1][2]+aArrayF3[1][3]+aArrayF3[1][4]

					SF4->(MsSeek(xFilial("SF4")+(cAliasSD1)->D1_TES))
					If SF4->F4_LFICM <> "N" .And. (cAliasSD1)->D1_TOTAL > 0

						SB1->(MsSeek(xFilial("SB1")+(cAliasSD1)->D1_COD))
						nPosAliq := 0
						nAliqIte := 0
						cSitTrib := ""
						//зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
						//ЁProcesso utilizado para atribuir os valores de Base de Icms eЁ
						//ЁAliquota de Icms ao Registro 54 conforme Registro 50.        Ё
						//юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды					 
						A940LoadPro("E",@cNcm,@cProd,(cAliasSD1)->D1_TEC)
			        	If ! ALLTRIM((cAliasSD1)->D1_CF) $ cCfoSint
						    //здддддддддддддддддддддд©
							//ЁMonta Registro Tipo 75Ё
							//юдддддддддддддддддддддды
							nAliqICM	:= SuperGETMV("MV_ICMPAD")
							nBRetido	:=(cAliasSD1)->D1_BRICMS/(cAliasSD1)->D1_QUANT
							//здддддддддддддддддддд©
							//ЁSituacao Tributaria Ё
							//юдддддддддддддддддддды
							If Empty((cAliasSD1)->D1_CLASFIS)
							  	If !Empty(SF4->F4_SITTRIB)
								    cSitTrib 	:= 	aFISFill(Num2Chr(Val(Substr(SB1->B1_ORIGEM,1,1)+SF4->F4_SITTRIB),3,0),3)
						   		Else
							        If len(alltrim(SB1->B1_ORIGEM)) ==2
										cSitTrib 	:=  SB1->B1_ORIGEM+"0"
									Else	
									    cSitTrib 	:= 	aFISFill(Num2Chr(Val(Substr(SB1->B1_ORIGEM,1,1)+Substr(SB1->B1_CLASFIS,1,1)+"0"),3,0),3)
							        EndIf
								EndIf	
							Else
								cSitTrib 	:= 	aFISFill(Num2Chr(Val((cAliasSD1)->D1_CLASFIS),3,0),3)
							EndIf
							//зддддддддддддддддддддддддддддддддддддддддддд©
							//Ё% de Reducao do ICMS nas Operacoes InternasЁ
							//юддддддддддддддддддддддддддддддддддддддддддды
							nRedBase :=0
							If SF4->F4_BASEICM >=100
								nRedBase :=0
						    ElseIf SF4->F4_BASEICM > 0
							    nRedBase := (100-SF4->F4_BASEICM)
						    Else
							    nRedBase := SF4->F4_BASEICM
						    EndIf		
							
							If Empty((cAliasSD1)->D1_TEC)
	 				    		If len(alltrim(SB1->B1_COD))>14
		                            cSeek	:=(dtos(dDtIni)+dtos(dDtFim)+PADR(cProd,14)+PADR(cNcm,8)+SB1->B1_UM+space(4))
							    Else						
	               		            cSeek	:=(dtos(dDtIni)+dtos(dDtFim)+Substr(SB1->B1_COD,1,14)+PADR(cNcm,8)+SB1->B1_UM+space(4))
					    		EndIf						
							Else
	       		                cSeek	:=(dtos(dDtIni)+dtos(dDtFim)+PADR(cProd,14)+Substr((cAliasSD1)->D1_TEC,1,8)+(cAliasSD1)->D1_UM+space(4))
							Endif
							//
							//Utilizo informacoes do SWN
							If !Empty((cAliasSD1)->D1_TEC)								
								ImporSWN (cAliasSd1, cCNPJ, cSitTrib, dDTIni, dDTFim, nAliqICM, nBRetido, nRedBase, aArrayF3, cAliasSF3, @nItem)
								//
							Else
								RecLock("R54",.T.)
								R54->A54_CNPJ	:=	cCNPJ
								R54->A54_MODELO	:=	AModNot(aArrayF3[1][7])
								R54->A54_SERIE 	:=	(cAliasSD1)->D1_SERIE
								R54->A54_NFISC 	:=	(cAliasSD1)->D1_DOC
								R54->A54_CFOP	:=	(cAliasSD1)->D1_CF
						    R54->A54CFOPEXT :=	SF4->F4_CFEXT
								R54->A54_CST   	:=	cSitTrib
								R54->A54_NUMITE	:=	StrZero(nItem,3)
								R54->A54_PRODUT	:=	cProd
								R54->A54_QUANT 	:=	(cAliasSD1)->D1_QUANT
								R54->A54_VALPRO	:=	(cAliasSD1)->D1_TOTAL
								R54->A54_VALDES	:=	(cAliasSD1)->D1_VALDESC
	
								If (cAliasSD1)->D1_ICMSRET > 0	 //IMPOSTO RETIDO - SUBSTITUTO TRIBUTARIO
									R54->A54_BSICM 	:= 0
								Else
									R54->A54_BSICM 	:= (cAliasSD1)->D1_BASEICM
								Endif
															
								R54->A54_BRICMS	:=	(cAliasSD1)->D1_BRICMS
								R54->A54_VALIPI	:=	(cAliasSD1)->D1_VALIPI
								nAliqIte  := (cAliasSD1)->D1_PICM
								If !SF4->F4_ISS $ "N "
									nAliqIte  := 0
								ElseIf SF4->F4_LFICM $ "IO" .And. nRedBase > 0 .And. SF4->F4_CONSUMO == "S"
									nAliqIte  := 0
								ElseIf 	SF4->F4_LFICM $ "IO" .And. nRedBase == 0
									nAliqIte  := 0
								Endif
								nPosAliq := Ascan(aArrayF3,{|x| x[8]==nAliqIte})
								R54->A54_ALQICM	:=	IIf(nPosAliq > 0,aArrayF3[nPosAliq][8],0)
								MsUnlock()
	
								If mv_par20==1
									If SubStr(ALLTRIM((cAliasSD1)->D1_CF),2,1)=="7"
										RecLock(cArq088C,.T.)
										(cArq088C)->A88CNFISC	:=	(cAliasSD1)->D1_DOC
										(cArq088C)->A88CSERIE	:=	(cAliasSD1)->D1_SERIE
										(cArq088C)->A88CCNPJ	:=	cCNPJ
										(cArq088C)->A88CMODELO	:=	AModNot(aArrayF3[1][7])
										(cArq088C)->A88CCFOP	:=	(cAliasSD1)->D1_CF
										(cArq088C)->A88CNUMITE	:=	StrZero(nItem,3)
										(cArq088C)->A88CPRODUT	:=	cProd
										(cArq088C)->A88CQUANT	:=	Iif(SF1->F1_TIPO$"C#P#I" .and. (cAliasSD1)->D1_QUANT == 0 ,1,(cAliasSD1)->D1_QUANT)
										(cArq088C)->A88CBASEST	:=	(cAliasSD1)->D1_BRICMS
										(cArq088C)->A88CVALBSR	:=	(cAliasSD1)->D1_ICMSRET
										(cArq088C)->A88CVALBSC	:=	0.00
										MsUnlock()
									Endif	
								Endif   							
								
								If R75->(!dbSeek(cSeek))
						    		RecLock("R75",.T.)
									R75->A75_DTAINI	:=	dDTIni
									R75->A75_DTAFIM	:=	dDTFim
									A940LoadPro("E",@cNcm,@cProd,(cAliasSD1)->D1_TEC)
									R75->A75_PROD	:=cProd
									R75->A75_CODNCM	:=cNcm
									If !Empty((cAliasSD1)->D1_TEC)
									 	R75->A75_DESCR	:=	(cAliasSD1)->D1_COD
										R75->A75_UM    	:=	(cAliasSD1)->D1_UM
										R75->A75_ALQIPI	:=	(cAliasSD1)->D1_IPI
									Else
										R75->A75_DESCR	:=	SB1->B1_DESC
										R75->A75_UM    	:=	SB1->B1_UM
									    R75->A75_ALQIPI	:=	SB1->B1_IPI
									EndIf
									R75->A75_ALQICM	:=	nAliqICM
									R75->A75_BRICMS	:=	nBRetido  	//Base do Retido
									R75->A75_SITTRI	:=	cSitTrib
									R75->A75_REDBSE	:= nRedBase		//Reducao da Base do ICMS
									If MV_PAR15 == 3
										R75->A75_EAN      := SB1->B1_CODBAR
										R75->A75_CODFIS   := &(SuperGetMv("MV_DIC_T06",,"'0850000'"))
									Endif	
									MsUnlock()							 
							    Endif
						    Endif
						    nItem ++
						Endif   
				    Endif
				    (cAliasSD1)->(dbSkip())
				EndDo
        		If lQuery
				    dbSelectArea(cAliasSD1)
					dbCloseArea()
			    Endif
			Else
	    		SF2->( dbSetOrder(1) )
				SF2->( MsSeek(xFilial("SF2")+aArrayF3[1][1]+aArrayF3[1][2]+aArrayF3[1][3]+aArrayF3[1][4]))
				//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
				//Ё Registro adicional para Frete,Seguro e Outras Despesas       Ё
				//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
				If SF2->(!Eof()) .And. (Empty(aArrayF3[1][7]) .Or. AModNot(aArrayF3[1][7])=="01")
				    For nI := 1 to 4
						If nI == 4
							aRelImp2   := MaFisRelImp("MT100",{ "SF2" })
							nPsVlPisSa := 0
							nValPis    := 0
							If !Empty( nScanPis := aScan(aRelImp2,{|x| x[1]=="SF2" .And. x[3]=="NF_VALPS2"} ) )
								cCpVlPisSa := aRelImp2[nScanPis,2]
								nPsVlPisSa := SF2->(FieldPos(cCpVlPisSa))
							EndIf 	
							If !Empty( nPsVlPisSa ) 
								nValPis := SF2->( FieldGet( nPsVlPisSa ) )
							EndIf
						Endif
			    		If (nI == 1 .And. SF2->F2_FRETE > 0) .Or.;
			    		   (nI == 2 .And. SF2->F2_SEGURO > 0) .Or.;
						   (nI == 3 .And. SF2->F2_DESPESA > 0) .Or.;
						   (nI == 4 .And. nValPis > 0)
						
							dbSelectArea("R54")
							If !MsSeek(cCNPJ+aArrayF3[1][2]+aArrayF3[1][1]+IIf(nI==1,"991",If(nI==2,"992",If(nI==3,"999","993"))))
								RecLock("R54",.T.)
								R54->A54_CNPJ	:=	cCNPJ
								R54->A54_MODELO :=	AModNot(aArrayF3[1][7])	
								R54->A54_SERIE  :=	aArrayF3[1][2]
								R54->A54_NFISC  :=	aArrayF3[1][1]
								R54->A54_CFOP	:=	aArrayF3[1][5]
							    R54->A54CFOPEXT :=	aArrayF3[1][29]
								R54->A54_CST    := "000"
								R54->A54_NUMITE := 	IIf(nI==1,"991",If(nI==2,"992",If(nI==3,"999","993")))//Numero do Item (991-Frete;999-Outras despesas acessorias;993-PIS/COFINS)
								R54->A54_QUANT  :=	1
								R54->A54_VALPRO := IIf(nI==1,SF2->F2_FRETE,If(nI==2,SF2->F2_SEGURO,If(nI==3,SF2->F2_DESPESA,nValPis)))
								R54->A54_VALDES := R54->A54_VALPRO
								R54->A54_ALQICM	:= IIf(nI==4,aArrayF3[1][8],0)
								MsUnlock()
							Endif	  

							If mv_par20==1					
								RecLock(cArq088C,.T.)
								(cArq088C)->A88CNFISC	:=	aArrayF3[1][1]
								(cArq088C)->A88CSERIE	:=	aArrayF3[1][2]
								(cArq088C)->A88CCNPJ	:=	cCNPJ
								(cArq088C)->A88CMODELO	:=	AModNot(aArrayF3[1][7])
								(cArq088C)->A88CCFOP	:=	aArrayF3[1][5]
								(cArq088C)->A88CNUMITE	:= IIf(nI==1,"991",If(nI==2,"992",If(nI==3,"999","993"))) //Numero do Item (991-Frete;992 -Seguro;999-Outras despesas acessorias;993-PIS/COFINS)
								(cArq088C)->A88CQUANT	:= 	1
								(cArq088C)->A88CBASEST	:=0.00
								(cArq088C)->A88CVALBSR	:=0.00
								(cArq088C)->A88CVALBSC	:=0.00
								MsUnlock()
							Endif														
					    Endif
					Next
				EndIf

				SD2->( dbSetOrder(3) )

				#IFDEF TOP
  					If TcSrvType()<>"AS/400"
						 cAliasSD2 := "a940ASD2"
						 aStru  := SD2->(dbStruct())
						 cQuery := "SELECT * "
						 cQuery += "FROM "+RetSqlName("SD2")+" "
						 cQuery += "WHERE D2_FILIAL='"+xFilial("SD2")+"' AND "
						 cQuery += "D2_DOC='"+aArrayF3[1][1]+"' AND "
						 cQuery += "D2_SERIE='"+aArrayF3[1][2]+"' AND "
						 cQuery += "D2_CLIENTE='"+aArrayF3[1][3]+"' AND "
						 cQuery += "D2_LOJA='"+aArrayF3[1][4]+"' AND "
						 cQuery += "D2_CF NOT IN('000','999') AND "
						 cQuery += "D_E_L_E_T_ = ' ' "
						 cQuery += "ORDER BY "+SqlOrder(SD2->(IndexKey()))
	            	
						 cQuery := ChangeQuery(cQuery)
						 dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasSD2,.T.,.T.)
	
						 For nX := 1 To len(aStru)
							 If aStru[nX][2] <> "C" .And. FieldPos(aStru[nX][1])<>0
								 TcSetField(cAliasSD2,aStru[nX][1],aStru[nX][2],aStru[nX][3],aStru[nX][4])
							 EndIf
						 Next nX
						 dbSelectArea(cAliasSD2)
					Else
  				#ENDIF
						(cAliasSD2)->( MsSeek(xFilial("SD2")+aArrayF3[1][1]+aArrayF3[1][2]+aArrayF3[1][3]+aArrayF3[1][4]))
				#IFDEF TOP
					EndIf
				#ENDIF
			   
				nItem	:= 1

			    While (cAliasSD2)->(!Eof()).And. (cAliasSD2)->D2_FILIAL+(cAliasSD2)->D2_DOC+(cAliasSD2)->D2_SERIE+(cAliasSD2)->D2_CLIENTE+(cAliasSD2)->D2_LOJA== ;
					xFilial("SD2")+aArrayF3[1][1]+aArrayF3[1][2]+aArrayF3[1][3]+aArrayF3[1][4]

					SF4->(MsSeek(xFilial("SF4")+(cAliasSD2)->D2_TES))

					If SF4->F4_LFICM <> "N" .And. (cAliasSD2)->D2_TOTAL > 0 

						SB1->(MsSeek(xFilial("SB1")+(cAliasSD2)->D2_COD))
						nPosAliq := 0
						nAliqIte := 0
						cSitTrib := ""
					    //зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
						//ЁProcesso utilizado para atribuir os valores de Base de Icms eЁ
						//ЁAliquota de Icms ao Registro 54 conforme Registro 50.        Ё
						//юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды					 
						A940LoadPro("S",@cNcm,@cProd)
			        	If ! ALLTRIM((cAliasSD2)->D2_CF) $ cCfoSint
							//здддддддддддддддддддддд©
							//ЁMonta Registro Tipo 75Ё
							//юдддддддддддддддддддддды
							nAliqICM := SuperGETMV("MV_ICMPAD")
							//здддддддддддддддддддд©
							//ЁSituacao Tributaria Ё
							//юдддддддддддддддддддды
							If Empty((cAliasSD2)->D2_CLASFIS)
							    If !Empty(SF4->F4_SITTRIB)
								    cSitTrib 	:= 	aFISFill(Num2Chr(Val(Substr(SB1->B1_ORIGEM,1,1)+SF4->F4_SITTRIB),3,0),3)
								Else
								    If len(alltrim(SB1->B1_ORIGEM)) ==2
									    cSitTrib	:= SB1->B1_ORIGEM+"0"
								    Else	
								        cSitTrib	:=	aFISFill(Num2Chr(Val(Substr(SB1->B1_ORIGEM,1,1)+Substr(SB1->B1_CLASFIS,1,1)+"0"),3,0),3)
								    EndIf
								EndIf	
							Else
							    cSitTrib	:=	aFISFill(Num2Chr(Val((cAliasSD2)->D2_CLASFIS),3,0),3)
						    EndIf
							//зддддддддддддддддддддддддддддддддддддддддддд©
							//Ё% de Reducao do ICMS nas Operacoes InternasЁ
							//юддддддддддддддддддддддддддддддддддддддддддды
							nRedBase := 0
				    		If SF4->F4_BASEICM >=100
								nRedBase :=0
							ElseIf SF4->F4_BASEICM > 0
							    nRedBase :=	(100-SF4->F4_BASEICM)
							Else
							    nRedBase :=	SF4->F4_BASEICM
						    Endif

						    cSeek	:= (dtos(dDtIni)+dtos(dDtFim)+PADR(cProd,14)+PADR(cNcm,8)+SB1->B1_UM+space(4))
							
							If Empty(aArrayF3[1][7]) .Or. AModNot(aArrayF3[1][7])=="01"
								RecLock("R54",.T.)
								R54->A54_CNPJ	:=	cCNPJ
								R54->A54_MODELO	:=	AModNot(aArrayF3[1][7])
								R54->A54_SERIE	:=	(cAliasSD2)->D2_SERIE
								R54->A54_NFISC	:=	(cAliasSD2)->D2_DOC
								R54->A54_CFOP	:=	(cAliasSD2)->D2_CF
							    R54->A54CFOPEXT :=	SF4->F4_CFEXT
								R54->A54_CST   	:=  cSitTrib
								R54->A54_NUMITE	:=	StrZero(nItem,3)
								R54->A54_PRODUT	:=	cProd
								R54->A54_QUANT	:=	(cAliasSD2)->D2_QUANT
								R54->A54_VALPRO	:=	(cAliasSD2)->D2_TOTAL+(cAliasSD2)->D2_DESCON
								R54->A54_VALDES	:=	(cAliasSD2)->D2_DESCON
								R54->A54_BSICM	:=  (cAliasSD2)->D2_BASEICM
								R54->A54_BRICMS	:=  (cAliasSD2)->D2_BRICMS
								R54->A54_VALIPI	:=  (cAliasSD2)->D2_VALIPI
								nAliqIte  := (cAliasSD2)->D2_PICM
								If !SF4->F4_ISS $ "N "
									nAliqIte  := 0
								ElseIf SF4->F4_LFICM $ "IO" .And. nRedBase > 0 .And. SF4->F4_CONSUMO == "S"
									nAliqIte  := 0
								ElseIf 	SF4->F4_LFICM $ "IO" .And. nRedBase == 0
									nAliqIte  := 0
								Endif
								nPosAliq := Ascan(aArrayF3,{|x| x[8]==nAliqIte})
								R54->A54_ALQICM	:=	IIf(nPosAliq > 0,aArrayF3[nPosAliq][8],0)
								MsUnlock()
			               	
								If mv_par20==1
									If SubStr(ALLTRIM((cAliasSD2)->D2_CF),2,1)=="7"
										RecLock(cArq088C,.T.)
										(cArq088C)->A88CNFISC	:=	(cAliasSD2)->D2_DOC
										(cArq088C)->A88CSERIE	:=	(cAliasSD2)->D2_SERIE
										(cArq088C)->A88CCNPJ	:=	cCNPJ
										(cArq088C)->A88CMODELO	:=	AModNot(aArrayF3[1][7])
										(cArq088C)->A88CCFOP	:=	(cAliasSD2)->D2_CF
										(cArq088C)->A88CNUMITE	:=	StrZero(nItem,3)
										(cArq088C)->A88CPRODUT	:=	cProd
										(cArq088C)->A88CQUANT	:=	Iif(SF2->F2_TIPO$"C#P#I" .and. (cAliasSD2)->D2_QUANT == 0 ,1,(cAliasSD2)->D2_QUANT)
										(cArq088C)->A88CBASEST	:=	(cAliasSD2)->D2_BRICMS
										(cArq088C)->A88CVALBSR	:=	(cAliasSD2)->D2_ICMSRET
										(cArq088C)->A88CVALBSC	:=	0.00
										MsUnlock()
									Endif	
								Endif   							
							Endif

							If !(R75->(dbSeek(cSeek)))
								RecLock("R75",.T.)
								R75->A75_DTAINI	:=	dDTIni
								R75->A75_DTAFIM	:=	dDTFim
								A940LoadPro("S",@cNcm,@cProd)
								R75->A75_PROD  	:=  cProd
		       					R75->A75_CODNCM	:=  cNcm
								R75->A75_DESCR	:=	SB1->B1_DESC
								R75->A75_UM    	:=	SB1->B1_UM
								R75->A75_ALQIPI	:=	SB1->B1_IPI
								R75->A75_ALQICM	:=	nAliqICM
								R75->A75_BRICMS	:=	(cAliasSD2)->D2_BRICMS
								R75->A75_SITTRI	:=	cSitTrib
								R75->A75_REDBSE	:= nRedBase		//Reducao da Base do ICMS
								If MV_PAR15 == 3
									R75->A75_EAN      := SB1->B1_CODBAR
									R75->A75_CODFIS   := &(SuperGetMv("MV_DIC_T06",,"'0850000'"))
								Endif	
								MsUnlock()
							Endif	

							If MV_PAR15 == 3 .and. R75->(dbSeek(cSeek))
								If AModNot(aArrayF3[1][7])$"02/04"	//"NFCF#NFP"
									//зддддддддддддддддддддддд©
									//ЁMonta Registro Tipo 61RЁ
									//юддддддддддддддддддддддды
									cEmiss := ""
									cAliq  := ""
									cEmiss := Substr(DTOS((cAliasSD2)->D2_EMISSAO),5,2)+Substr(DTOS((cAliasSD2)->D2_EMISSAO),1,4)
									If (cArq61R)->(MsSeek(cEmiss+PADR(cProd,14)+str(nAliqICM,5,2)))
										RecLock(cArq61R,.F.)
										(cArq61R)->R61_QUANT	+=	(cAliasSD2)->D2_QUANT
										(cArq61R)->R61_VALOR	+=	(cAliasSD2)->D2_TOTAL+(cAliasSD2)->D2_DESCON
										(cArq61R)->R61_BICMS	+=	(cAliasSD2)->D2_BASEICM
										MsUnlock()
									Else
										RecLock(cArq61R,.T.)
										(cArq61R)->R61_EMISS 	:=	cEmiss
										(cArq61R)->R61_PRODSV	:=	cProd
										(cArq61R)->R61_QUANT	:=	(cAliasSD2)->D2_QUANT
										(cArq61R)->R61_VALOR	:=	(cAliasSD2)->D2_TOTAL+(cAliasSD2)->D2_DESCON
										(cArq61R)->R61_BICMS	:=	(cAliasSD2)->D2_BASEICM
										(cArq61R)->R61_ALIQ		:=	nAliqICM
										MsUnlock()
									Endif	
								EndIf     		
							EndIf

							If AModNot(aArrayF3[1][7]) $ "21,22" .And. aArrayF3[1][6] <> "L" //Notas Fiscais de Comunicacao/Telecomunicacao
						   		RecLock("R77",.T.)
								R77->A77_CNPJ  	:=	cCNPJ
								R77->A77_MODELO	:=	AModNot(aArrayF3[1][7])
								R77->A77_SERIE	:=	Substr((cAliasSD2)->D2_SERIE,1,1)
								R77->A77_SUBSER	:=  Substr((cAliasSD2)->D2_SERIE,2,2)
								R77->A77_NFISC	:=	(cAliasSD2)->D2_DOC  
								R77->A77_CFOP	:=	(cAliasSD2)->D2_CF   
								R77->A77_TIPREC	:= "1"
								R77->A77_NUMITE	:= StrZero(nItem,3)
								R77->A77_PRODUT	:= Left(cProd,11)
								R77->A77_QUANT	:= Iif(SF2->F2_TIPO$"C#P#I" .and. (cAliasSD2)->D2_QUANT == 0 ,1,(cAliasSD2)->D2_QUANT)
								R77->A77_VALPRO	:= (cAliasSD2)->D2_TOTAL+(cAliasSD2)->D2_DESCON
								R77->A77_VALDES	:= (cAliasSD2)->D2_DESCON
								R77->A77_BSICM	:= (cAliasSD2)->D2_BASEICM
								R77->A77_ALQICM	:= (cAliasSD2)->D2_BRICMS
								R77->A77_CNPJMF	:= SM0->M0_CGC
								R77->A77_CODTER	:= (cAliasSD2)->D2_CLIENTE
								MsUnlock()
		            		Endif
							nItem ++
						Endif
	 		    	Endif
	 		    	(cAliasSD2)->(dbSkip())
		 	    EndDo
			    If lQuery
	    		    dbSelectArea(cAliasSD2)
				    dbCloseArea()
		        EndIf 
		    EndIf	
		Endif
        //здддддддддддддддддддддд©
	    //ЁMonta Registro Tipo 61Ё
	    //юдддддддддддддддддддддды
	    If Val(Subs(AllTrim(aArrayF3[1][5]),1,1))>=5
        	If AModNot(aArrayF3[1][7]) $ "02,04,07,13,14,15,16,18,21" .And. aArrayF3[1][6] <> "L" // NF Produtor; NF venda a consumidor
				If R61->(!MsSeek(dTos(aArrayF3[1][18])+aArrayF3[1][2]+strzero(aArrayF3[1][8],5,2)))
				    RecLock("R61",.T.)
					R61->A61_EMISS	:= 	aArrayF3[1][18]
					R61->A61_MODELO :=	AModNot(aArrayF3[1][7])
					R61->A61_SERIE	:=	aArrayF3[1][2]
					R61->A61_NUMINI	:=	aArrayF3[1][1]
					R61->A61_OBS    :=  aArrayF3[1][20]
					R61->A61_SITUAC := IIf(("CANCELAD"$aArrayF3[1][20] .Or.!empty(aArrayF3[1][13])),"S","N")
				Else
				    RecLock("R61",.F.)
				EndIf		
				R61->A61_NUMFIM	:=	aArrayF3[1][1]
				R61->A61_VALTOT	+=	aArrayF3[1][17]
				R61->A61_BSICM	+=	aArrayF3[1][19]
				R61->A61_VALICM	+=	aArrayF3[1][16]
				R61->A61_ISENTA	+= 	aArrayF3[1][12]
				R61->A61_OUTRAS	+= 	aArrayF3[1][15]
				R61->A61_ALQICM := 	aArrayF3[1][8]
				R61->A61_ANOAID := IIf(lAIDF,aArrayF3[1][30],MV_PAR18)
				R61->A61_NUMAID := IIf(lAIDF,aArrayF3[1][31],MV_PAR19)
				R61->A61_CODMUN := aArrayF3[1][25]
				MsUnlock()
			EndIf
		Endif  
		//здддддддддддддддддддддд©
		//ЁMonta Registro Tipo 70Ё
		//юдддддддддддддддддддддды
		If (AModNot(aArrayF3[1][7])$"07#08#09#10#11") .And. aArrayF3[1][6] <> "L"
			RecLock("R70",.T.)
    		R70->A70_CNPJ	:= 	cTranspCGC
		    R70->A70_IE		:=	cTranspIns
			R70->A70_EMISS	:=	aArrayF3[1][10]
			R70->A70_UF		:=	cTranspEst
			R70->A70_MODELO	:=	AModNot(aArrayF3[1][7])
			R70->A70_SERIE	:=	Substr(aArrayF3[1][2],1,1)
			R70->A70_SUBSER	:=  Substr(aArrayF3[1][2],2,2)
			R70->A70_NFISC	:=	aArrayF3[1][1]
			R70->A70_CFOP	:=	aArrayF3[1][5]
		    R70->A70CFOPEXT :=	aArrayF3[1][29]			
			R70->A70_VALTOT	:=	aArrayF3[1][17]
			R70->A70_BSICM	:=	aArrayF3[1][19]
			R70->A70_VALICM	:=	aArrayF3[1][16]
			R70->A70_ISENTA	:=	aArrayF3[1][12]
			R70->A70_OUTRAS	:=	aArrayF3[1][15]
			R70->A70_CIfFOB	:=	IIf(mv_par15==3,"2","1") 
			R70->A70_SITUAC	:=	IIf(("CANCELAD"$aArrayF3[1][20] .Or.!empty(aArrayF3[1][13])),"S","N")
			R70->A70_CODMUN := aArrayF3[1][25]
			R70->A70_ANOAID := IIf(lAIDF,aArrayF3[1][30],MV_PAR18)
			R70->A70_NUMAID := IIf(lAIDF,aArrayF3[1][31],MV_PAR19)

			MsUnlock()
		EndIf
	    //здддддддддддддддддддддддддддддддддддддддддддддддддд©
	    //ЁMonta Registro Tipo 71 atraves de ponto de entradaЁ
	    //юдддддддддддддддддддддддддддддддддддддддддддддддддды
	    //здддддддддддддддддддддддддддддддддддддддд©
	    //ЁSomente gera registro tipo 71 para      Ё
	    //Ёemitentes de conhecimento de transporte.Ё
	    //ЁPortanto somente Notas Fiscais de Saida.Ё
	    //ЁDevera gerar registros no arquivo       Ё
	    //ЁR71 em funcao do registro lido no       Ё
	    //Ёarquivo SF3.                            Ё
  	    //юдддддддддддддддддддддддддддддддддддддддды
	    If Substr(aArrayF3[1][5],1,1) >= "5" .And. aArrayF3[1][6] <> "L"
		    If lMtaTIP71
		        aArray71 := aClone(aArrayF3)
		        Execblock("MTATIP71",.F.,.F.,{,aArray71})
		    EndIf
	    EndIf
		//здддддддддддддддддддддд©
		//ЁMonta Registro Tipo 76Ё
		//юдддддддддддддддддддддды
   		If AModNot(aArrayF3[1][7]) $ "21,22" .And. aArrayF3[1][6] <> "L" .And. Substr(aArrayF3[1][5],1,1) >= "5" //Notas Fiscais de Comunicacao/Telecomunicacao
   			RecLock("R76",.T.)
			R76->A76_CNPJ  	:=	cCNPJ
			R76->A76_IE		:=  cIE
			R76->A76_MODELO	:=	AModNot(aArrayF3[1][7])
			R76->A76_SERIE	:=	Substr(aArrayF3[1][2],1,1)
			R76->A76_SUBSER	:=  Substr(aArrayF3[1][2],2,2)
			R76->A76_NFISC	:=	aArrayF3[1][1]
			R76->A76_CFOP	:=	aArrayF3[1][5]
			R76->A76_TIPREC	:= "1"
			R76->A76_EMISS	:=	aArrayF3[1][10]
			R76->A76_UF		:=	cTranspEst
			R76->A76_VALTOT	:=	aArrayF3[1][17]
			R76->A76_BRICMS	:=	aArrayF3[1][19]
			R76->A76_VALICM	:=	aArrayF3[1][16]
			R76->A76_ISENTA	:=	aArrayF3[1][12]
			R76->A76_OUTRAS	:=	aArrayF3[1][15]
			R76->A76_ALQICM	:=	aArrayF3[1][8]
			R76->A76_SITUAC	:=	IIf(("CANCELAD"$aArrayF3[1][20] .Or.!empty(aArrayF3[1][13])),"S","N")
	 	    R76->A76_CODMUN := aArrayF3[1][25]
			R76->A76_ANOAID := IIf(lAIDF,aArrayF3[1][30],MV_PAR18)
			R76->A76_NUMAID := IIf(lAIDF,aArrayF3[1][31],MV_PAR19)
			R76->A76CFOPEXT	:=  aArrayF3[1][29]
			MsUnlock()
   		Endif
		//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//Ё Gravacao do registro 50                                                Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
		For nI := 1 To Len(aArrayF3)
			If (Empty(aArrayF3[nI][7]) .Or.;
		    	AModNot(aArrayF3[nI][7])$"01,06,21,22") .And.;
		    	aArrayF3[nI][6] <> "L"
			    If (cChaveAux == aArrayF3[nI][24]) .Or. nI==1 .Or. cChaveAux2<>Subs(aArrayF3[nI][05],1,4)+AllTrim(Str(aArrayF3[nI][8]))
				      RecLock("R50",.T.)
				      R50->A50_CNPJ   := cCNPJ
				      R50->A50_IE     :=	cIE
				      R50->A50_EMISS  :=	aArrayF3[nI][10]
				      R50->A50_UF     :=	aArrayF3[nI][22]
					  R50->A50_MODELO :=  AModNot(aArrayF3[nI][7])
				 	  R50->A50_SERIE  :=	aArrayF3[nI][2]
					  R50->A50_NFISC  :=	aArrayF3[nI][1]
					  R50->A50_CFOP   :=	aArrayF3[nI][5]
					  R50->A50CFOPEXT :=	aArrayF3[nI][29]
				 	  R50->A50_EMIT   :=	IIf(aArrayF3[nI][21]=="S".Or.SubStr(aArrayF3[nI][5],1,1)>="5","P","T")
					  R50->A50_ALQICM :=	aArrayF3[nI][8]
					  R50->A50_SITUAC :=	IIf(("CANCELAD"$aArrayF3[nI][20] .Or.!Empty(aArrayF3[nI][13])),"S","N")
				 	  R50->A50_CODMUN := aArrayF3[nI][25]
				 	  If R50->A50_EMIT=="P"
					  	 R50->A50_ANOAID := IIf(lAIDF,aArrayF3[nI][30],MV_PAR18)
				 	  	 R50->A50_NUMAID := IIf(lAIDF,aArrayF3[nI][31],MV_PAR19)
				 	  Endif	 
					  MsUnlock()
				Endif	
				RecLock("R50",.F.)
				R50->A50_VALTOT +=	If(aArrayF3[nI][17]==0,aArrayF3[nI][16],aArrayF3[nI][17])
				
				If aArrayF3[nI][11] > 0		//F3_ICMSRET - SUBSTITUTO TRIBUTARIO
					If Left(Alltrim(aArrayF3[nI][5]),1) >= "5"
						R50->A50_BSICM  += aArrayF3[nI][19]	//F3_BASEICM
					Endif
				Else
					R50->A50_BSICM  +=	aArrayF3[nI][19]
				Endif
				
				R50->A50_VALICM +=	aArrayF3[nI][16]
				R50->A50_ISENTO +=	aArrayF3[nI][12]
				R50->A50_OUTRAS +=	aArrayF3[nI][15]
				R50->A50_DESPES += aArrayF3[nI][23]
				MsUnlock()
			EndIf                       
			
			If mv_par15 == 3 .and. aArrayF3[nI][11]>0
			   If (aModNot(aArrayF3[nI][7])$"06/22" .And. Subs(aArrayF3[nI][05],1,1)$"123") .Or. (!aModNot(aArrayF3[nI][7])$"06/22")
				  If !(cArq08850)->(MsSeek(cCNPJ+aArrayF3[nI][2]+aArrayF3[nI][1]))							
					 RecLock(cArq08850,.T.)
					 (cArq08850)->A8850CNPJ  := cCNPJ
					 (cArq08850)->A8850EMISS := aArrayF3[nI][10]
					 (cArq08850)->A8850UF    :=	aArrayF3[nI][22]
					 (cArq08850)->A8850MODEL := aModNot(aArrayF3[nI][7])
					 (cArq08850)->A8850SERIE := aArrayF3[nI][2]
					 (cArq08850)->A8850NFISC := aArrayF3[nI][1]
					 (cArq08850)->A8850SUFRA := aArrayF3[nI][27]
					 (cArq08850)->A8850OBS   := aArrayF3[nI][20]
					 (cArq08850)->A8850CONTA := aArrayF3[nI][26]
				  EndIf
				  MsUnlock()
			   EndIf			
			Endif
			If mv_par20==1
				RecLock(cArq088D,.T.)
				(cArq088D)->A88DCNPJ	:=	cCNPJ
				(cArq088D)->A88DIE		:=	cIE
				(cArq088D)->A88DUF		:=	aArrayF3[nI][22]
				(cArq088D)->A88DMODELO	:=	AModNot(aArrayF3[nI][7])
				(cArq088D)->A88DSERIE	:=	aArrayF3[nI][2]
				(cArq088D)->A88DNFISC	:=	aArrayF3[nI][1]
				(cArq088D)->A88DCFOP  	:=	aArrayF3[nI][5]
				(cArq088D)->A88DEMISS	:=	aArrayF3[nI][18]
				(cArq088D)->A88DENTSAI	:=	aArrayF3[nI][10]
				(cArq088D)->A88DALQICM	:=	aArrayF3[nI][8]
				MsUnlock()
			Endif	
			
			cChaveAux := aArrayF3[nI][24]
			cChaveAux2:= Subs(aArrayF3[nI][05],1,4)+AllTrim(Str(aArrayF3[nI][8]))
		Next
		aArrayF3  := {}
		cChaveAux := ""
		cChaveAux2:= ""
	Endif
	dbSelectArea(cAliasSF3)
EndDo		

//зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁVerifica se a UF do parametro e a mesma da empresa corrente  Ё
//юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды		
If !Empty(cEstDest) .And. SM0->M0_ESTENT <> cEstDest
    lCupom := .F.	//Se o estado for diferente do parametro nao pode ser gerado os registros tipo 60
Endif
//здддддддддддддддддддддд©
//ЁMonta Registro Tipo 60Ё
//юдддддддддддддддддддддды		
If Select("SFI")!=0 .And. lCupons
	dbSelectArea(cAliasSFI)              
	dbSetOrder(1)
	#IFDEF TOP
	    If TcSrvType()<>"AS/400"
		    cAliasSFI:= "A940aSFI"
		  	lQuery   := .T.
			aStruSFI := SFI->(dbStruct())		
			cQuery := "SELECT * "
			cQuery += "FROM "
			cQuery += RetSqlName("SFI") + " SFI ,"
			cQuery += "WHERE "
			cQuery += "SFI.FI_FILIAL = '"+xFilial("SFI")+"' AND "
			cQuery += "SFI.FI_DTMOVTO>='"+Dtos(dDtIni)+"' AND "
			cQuery += "SFI.FI_DTMOVTO<='"+Dtos(dDtFim)+"' AND "
			cQuery += "SFI.D_E_L_E_T_ = ' ' "
			cQuery += "ORDER BY "+SqlOrder(SFI->(IndexKey()))
			
			cQuery := ChangeQuery(cQuery)
		    	
			dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasSFI)
			
			For nSFI := 1 To Len(aStruSFI)
				If aStruSFI[nSFI][2] <> "C" .and.  FieldPos(aStruSFI[nSFI][1]) > 0
					TcSetField(cAliasSFI,aStruSFI[nSFI][1],aStruSFI[nSFI][2],aStruSFI[nSFI][3],aStruSFI[nSFI][4])
				EndIf
			Next nSFI
		Else
	#ENDIF
			dbSelectArea(cAliasSFI)
			cIndex := CriaTrab(,.F.)
			cKey := IndexKey()	
			cFilter := 'FI_FILIAL == "'+xFilial("SFI")+'" .And. (Dtos(FI_DTMOVTO) >= "'+Dtos(dDtIni)+'" .And. Dtos(FI_DTMOVTO) <= "'+Dtos(dDtFim)+'")'
			IndRegua(cAliasSFI,cIndex,cKey,,cFilter,"Selecionando Registros...")
			dbGotop()
	#IFDEF TOP
		Endif
	#ENDIF	
	dbSelectArea(cAliasSFI)		

	While (cAliasSFI)->(!Eof())	
		If !M60->(MsSeek(DTOS((cAliasSFI)->FI_DTMOVTO)+StrZero(Val((cAliasSFI)->FI_PDV),3)))
			RecLock("M60",.T.)
			M60->M60_EMISS  := (cAliasSFI)->FI_DTMOVTO
			M60->M60_NUMFAB := (cAliasSFI)->FI_SERPDV
			M60->M60_PDV    := STRZERO(VAL((cAliasSFI)->FI_PDV),3)
			M60->M60_MODELO := "2D" 
			M60->M60_NUMINI := (cAliasSFI)->FI_NUMINI
			M60->M60_NUMFIM := (cAliasSFI)->FI_NUMFIM														
			M60->M60_REDUCZ := (cAliasSFI)->FI_NUMREDZ
			M60->M60_CRO   	:= Val(PADR(SFI->FI_CRO,3))
			M60->M60_VENDA 	:= IIF(MV_PAR15<>3,(cAliasSFI)->FI_GTINI,(cAliasSFI)->FI_VALCON+(cAliasSFI)->FI_DESC+(cAliasSFI)->FI_CANCEL)
		    M60->M60_GERAL	:= (cAliasSFI)->FI_GTFINAL
			MsUnlock()
			//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
			//Ё Totaliza cupons fiscais pela Situacao Tributaria             Ё
			//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
			If (cAliasSFI)->FI_SUBTRIB > 0
				RecLock("A60",.T.)
				A60->A60_EMISS	:=	(cAliasSFI)->FI_DTMOVTO
				A60->A60_NUMFAB	:=	(cAliasSFI)->FI_SERPDV
				A60->A60_SITTRI	:=	"F"
				A60->A60_VALOR	:=	(cAliasSFI)->FI_SUBTRIB
				A60->A60_PDV	:=	STRZERO(VAL((cAliasSFI)->FI_PDV),3)
				MsUnlock()
			EndIf
			If (cAliasSFI)->FI_ISENTO >0
			  	RecLock("A60",.T.)
				A60->A60_EMISS	:=	(cAliasSFI)->FI_DTMOVTO
				A60->A60_NUMFAB	:=	(cAliasSFI)->FI_SERPDV
				A60->A60_SITTRI	:=	"I"
				A60->A60_VALOR	:=	(cAliasSFI)->FI_ISENTO
				A60->A60_PDV	:=	STRZERO(VAL((cAliasSFI)->FI_PDV),3)
				MsUnlock()
			EndIf
			If (cAliasSFI)->FI_CANCEL >0
				RecLock("A60",.T.)
				A60->A60_EMISS	:=	(cAliasSFI)->FI_DTMOVTO
				A60->A60_NUMFAB	:=	(cAliasSFI)->FI_SERPDV
				A60->A60_SITTRI	:=	"CANC"
				A60->A60_VALOR	:=	(cAliasSFI)->FI_CANCEL
				A60->A60_PDV	:=	STRZERO(VAL((cAliasSFI)->FI_PDV),3)
				MsUnlock()
			EndIf         
			If (cAliasSFI)->FI_NTRIB >0
				RecLock("A60",.T.)
				A60->A60_EMISS	:=	(cAliasSFI)->FI_DTMOVTO
				A60->A60_NUMFAB	:=	(cAliasSFI)->FI_SERPDV
				A60->A60_SITTRI	:=	"N"
				A60->A60_VALOR	:=	(cAliasSFI)->FI_NTRIB
				A60->A60_PDV	:=	STRZERO(VAL((cAliasSFI)->FI_PDV),3)
				MsUnlock()
			EndIf    
			If (cAliasSFI)->FI_DESC >0
				RecLock("A60",.T.)
				A60->A60_EMISS	:=	(cAliasSFI)->FI_DTMOVTO
				A60->A60_NUMFAB	:=	(cAliasSFI)->FI_SERPDV
				A60->A60_SITTRI	:=	"DESC"
				A60->A60_VALOR	:=	(cAliasSFI)->FI_DESC
				A60->A60_PDV	:=	STRZERO(VAL((cAliasSFI)->FI_PDV),3)
				MsUnlock()
			EndIf
			aStruSFI := (cAliasSFI)->(dbStruct())
			For nX := 1 To Len(aStruSFI)
				If "FI_BAS"$(cAliasSFI)->(FieldName(nX))
					If (cAliasSFI)->(FieldGet(nX))>0
						RecLock("A60",.T.)
						A60->A60_EMISS	:=	(cAliasSFI)->FI_DTMOVTO
						A60->A60_NUMFAB	:=	(cAliasSFI)->FI_SERPDV
			    		A60->A60_SITTRI	:=	aFISFill(Num2Chr(Val(SubStr((cAliasSFI)->(FieldName(nX)),7)),4),4)
						A60->A60_VALOR	:=	(cAliasSFI)->(FieldGet(nX))
						A60->A60_PDV	:=	STRZERO(VAL((cAliasSFI)->FI_PDV),3)
						MsUnlock()
					EndIf
				EndIf
			Next nX	
		Endif
		(cAliasSFI)->(dbSkip())
	EndDo
    If lQuery
	    dbSelectArea(cAliasSFI)
		dbCloseArea()
	Else
       	dbSelectArea("SFI")
		RetIndex("SFI")
		dbClearFilter()
		Ferase(cIndex+OrdBagExt())
	Endif	
Endif
//зддддддддддддддддддддддддддддддддддд©
//ЁMonta Registros Tipo 60R           Ё
//юддддддддддддддддддддддддддддддддддды
If Select("SFI")!=0 .And. lCupons .And. mv_par15 == 3
	dbSelectArea("SF2")	
	dbSetOrder(1)
	
	dbSelectArea("SD2")
	ProcRegua(LastRec())
	#IFDEF TOP
	     If TcSrvType()<>"AS/400"
		     cAliasSD2 := "a940ASD2"
			 aStru  := SD2->(dbStruct())
			 cQuery := "SELECT * "
			 cQuery += "FROM "+RetSqlName("SD2")+" "
			 cQuery += "WHERE D2_FILIAL='"+xFilial("SD2")+"' AND "
			 cQuery += "D2_EMISSAO>='"+Dtos(dDtIni)+"' AND "
	         cQuery += "D2_EMISSAO<='"+Dtos(dDtFim)+"' AND "	
			 cQuery	+= "(D2_CF LIKE '5%' OR D2_CF LIKE '6%' OR D2_CF LIKE '7%') AND "
			 cQuery += "D2_PDV <> ' ' AND "
			 cQuery += "D_E_L_E_T_ = ' ' "
			 cQuery += "ORDER BY D2_FILIAL, D2_PDV, D2_EMISSAO"
	           	
			 cQuery := ChangeQuery(cQuery)
			 dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasSD2,.T.,.T.)
	
			 For nX := 1 To Len(aStru)
				 If aStru[nX][2] <> "C" .And. FieldPos(aStru[nX][1])<>0
					 TcSetField(cAliasSD2,aStru[nX][1],aStru[nX][2],aStru[nX][3],aStru[nX][4])
				 EndIf
			 Next nX
			 dbSelectArea(cAliasSD2)
		 Else
	#ENDIF	
		     cIndex2 := CriaTrab(NIL,.F.)
			 cKey	 := 'D2_FILIAL+D2_PDV+DTOS(D2_EMISSAO)'
			 cFilter := 'D2_FILIAL == "'+xFilial("SD2")+'" .And. (Dtos(D2_EMISSAO) >= "'+Dtos(dDtIni)+'" .And. Dtos(D2_EMISSAO) <= "'+Dtos(dDtFim)+'")'
			 cFilter += '.And. Substr(D2_CF,1,1)$"5,6,7" .And. !Empty(D2_PDV)'
			 IndRegua(cAliasSD2,cIndex2,cKey,,cFilter,)
			 nIndex := RetIndex("SD2")
			 #IFNDEF TOP
			 	dbSetIndex(cIndex2+OrdBagExt())
			 #ENDIF			 
			 dbSelectArea("SD2")
			 dbSetOrder(nIndex+1)
	
			 dbSelectArea(cAliasSD2)
			 dbGotop()			 
	#IFDEF TOP
		 EndIf
	#ENDIF

    nItem := 1
    nAliqICM := SuperGETMV("MV_ICMPAD")
    While (cAliasSD2)->(!Eof()) 

    	IncProc(STR0006) //Preparando Base de Dados 2/3
       					
       	SF4->(MsSeek(xFilial("SF4")+(cAliasSD2)->D2_TES))
       	SB1->(MsSeek(xFilial("SB1")+(cAliasSD2)->D2_COD))
       	
		If SF2->(MsSeek(xFilial("SF2")+(cAliasSD2)->D2_DOC+(cAliasSD2)->D2_SERIE+(cAliasSD2)->D2_CLIENTE+(cAliasSD2)->D2_LOJA))
		    If SF2->F2_ECF <> "S"
		    	(cAliasSD2)->(dbSkip()) 
		    	Loop
		    Endif	
		Endif

		A940LoadPro("S",@cNcm,@cProd)
	        
   		cSitTrib := ""
		If (cAliasSD2)->D2_ICMSRET > 0
			cSitTrib := "F"
		Elseif (cAliasSD2)->D2_VALISS+(cAliasSD2)->D2_BASEISS > 0
			cSitTrib := "ISS"
		Elseif SF4->F4_BASEICM > 0 .And. SF4->F4_CONSUMO == "S" 
		    If SF4->F4_LFICM == "I"
				cSitTrib := "I"
			ElseIf SF4->F4_LFICM == "O"
				cSitTrib := "N"
			Endif	
		Elseif SF4->F4_BASEICM == 0
		    If SF4->F4_LFICM == "I"
				cSitTrib := "I"
			ElseIf SF4->F4_LFICM == "O"
				cSitTrib := "N"
			ElseIf SF4->F4_LFICM == "T"
				cSitTrib := aFISFill(Num2Chr((cAliasSD2)->D2_PICM,4),4)
			Endif		
		ElseIf SF4->F4_BASEICM > 0 .And. SF4->F4_CONSUMO == "N"
			cSitTrib := aFISFill(Num2Chr((cAliasSD2)->D2_PICM,4),4)
		EndIf	
		//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//Ё Define tipo de cupom fiscal                                  Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
		If Substr((cAliasSD2)->D2_SERIE,1,2)=="CP"
			cEspDoc:="2C"
		Else
		   	cEspDoc:="2D"
		EndIf
	    //зддддддддддддддддддддддд©
		//ЁMonta Registro Tipo 60RЁ
		//юддддддддддддддддддддддды
		cEmiss := ""
		cEmiss := Substr(DTOS((cAliasSD2)->D2_EMISSAO),5,2)+Substr(DTOS((cAliasSD2)->D2_EMISSAO),1,4)
		If R60->(MsSeek(cEmiss+cProd+cSitTrib))
		    RecLock("R60",.F.)
			R60->R60_QUANT	+=	(cAliasSD2)->D2_QUANT
			R60->R60_VALOR	+=	(cAliasSD2)->D2_PRCVEN
			R60->R60_BSICM	+=	(cAliasSD2)->D2_BASEICM
			MsUnlock()
		Else
			RecLock("R60",.T.)
			R60->R60_MESANO	:=	cEmiss
			R60->R60_CODPRO	:=	cProd
			R60->R60_QUANT	:=	(cAliasSD2)->D2_QUANT	
			R60->R60_VALOR	:=	(cAliasSD2)->D2_PRCVEN
			R60->R60_BSICM	:=	(cAliasSD2)->D2_BASEICM
			R60->R60_SITTRI	:=	cSitTrib
			MsUnlock()
		Endif
		//зддддддддддддддддддддддддддддддддддддддддддд©
		//Ё% de Reducao do ICMS nas Operacoes InternasЁ
		//юддддддддддддддддддддддддддддддддддддддддддды
		nRedBase := 0
    	If SF4->F4_BASEICM >=100
			nRedBase :=0
		ElseIf SF4->F4_BASEICM > 0
		    nRedBase :=	(100-SF4->F4_BASEICM)
		Else
		    nRedBase :=	SF4->F4_BASEICM
	    Endif
   		//здддддддддддддддддддд©
		//ЁSituacao Tributaria Ё
		//юдддддддддддддддддддды
		cSitTrib := ""
		If Empty((cAliasSD2)->D2_CLASFIS)
		    If SF4->(Fieldpos("F4_SITTRIB"))>0
			    cSitTrib := aFISFill(Num2Chr(Val(Substr(SB1->B1_ORIGEM,1,1)+SF4->F4_SITTRIB),3,0),3)
			Else
			    If Len(alltrim(SB1->B1_ORIGEM)) ==2
				    cSitTrib := SB1->B1_ORIGEM+"0"
			    Else	
			        cSitTrib :=	aFISFill(Num2Chr(Val(Substr(SB1->B1_ORIGEM,1,1)+Substr(SB1->B1_CLASFIS,1,1)+"0"),3,0),3)
			    EndIf
			EndIf	
		Else
		    cSitTrib :=	aFISFill(Num2Chr(Val((cAliasSD2)->D2_CLASFIS),3,0),3)
	    EndIf
		cSeek := (dtos(dDtIni)+dtos(dDtFim)+PADR(cProd,14)+PADR(cNcm,8)+SB1->B1_UM+space(4))
		If !(R75->(dbSeek(cSeek)))
			RecLock("R75",.T.)
			R75->A75_DTAINI	:= dDTIni
			R75->A75_DTAFIM	:= dDTFim
			R75->A75_PROD  	:= cProd
   			R75->A75_CODNCM	:= cNcm
			R75->A75_DESCR	:= SB1->B1_DESC
			R75->A75_UM    	:= SB1->B1_UM
			R75->A75_ALQIPI	:= SB1->B1_IPI
			R75->A75_ALQICM	:= nAliqICM
			R75->A75_BRICMS	:= (cAliasSD2)->D2_BRICMS
			R75->A75_SITTRI	:= cSitTrib
			R75->A75_REDBSE	:= nRedBase		
			If MV_PAR15 == 3
			   R75->A75_EAN      := SB1->B1_CODBAR
			   R75->A75_CODFIS   := &(SuperGetMv("MV_DIC_T06",,"'0850000'"))
			Endif
			MsUnlock()
		Endif	
	   	(cAliasSD2)->(dbSkip())
	EndDo
	If lQuery
    	dbSelectArea(cAliasSD2)
		dbCloseArea()
    Else
       	dbSelectArea("SD2")
		RetIndex("SD2")
		dbClearFilter()
		Ferase(cIndex2+OrdBagExt())
    EndIf 
EndIf
//здддддддддддддддддддддддддддддддддддддддддддддд©
//ЁGrava Registro 75 de acordo com o registro 74 Ё
//юдддддддддддддддддддддддддддддддддддддддддддддды
If mv_par21 == 1 .And. MV_PAR15 == 3
	cNcm  := ""
	cProd := ""
	cSitTrib := ""
	dbSelectArea("R74")
	dbGoTop()
	While R74->(!Eof())
		SB1->(MsSeek(xFilial("SB1")+R74->CODIGO))
		A940LoadPro("I",@cNcm,@cProd)
   		
   		If Len(Alltrim(SB1->B1_COD))>14
            cSeek :=(dtos(dDtIni)+dtos(dDtFim)+PADR(cProd,14)+PADR(cNcm,8)+SB1->B1_UM+space(4))
            RecLock("R74",.F.)
            R74->CODIGO := cProd
            MsUnlock()
	    Else						
            cSeek :=(dtos(dDtIni)+dtos(dDtFim)+Substr(SB1->B1_COD,1,14)+PADR(cNcm,8)+SB1->B1_UM+space(4))
   		EndIf						
   		
        If Len(Alltrim(SB1->B1_ORIGEM)) ==2
			cSitTrib := SB1->B1_ORIGEM+"0"
		Else	
		    cSitTrib :=	aFISFill(Num2Chr(Val(Substr(SB1->B1_ORIGEM,1,1)+Substr(SB1->B1_CLASFIS,1,1)+"0"),3,0),3)
        EndIf
        If R75->(!dbSeek(cSeek))
			RecLock("R75",.T.)
			R75->A75_DTAINI	:= dDTIni
			R75->A75_DTAFIM	:= dDTFim
			R75->A75_PROD  	:= cProd
	       	R75->A75_CODNCM	:= cNcm
			R75->A75_DESCR	:= SB1->B1_DESC
			R75->A75_UM    	:= SB1->B1_UM
			R75->A75_ALQIPI	:= SB1->B1_IPI
			R75->A75_ALQICM	:= 0
			R75->A75_BRICMS	:= 0
			R75->A75_SITTRI	:= cSitTrib
			R75->A75_REDBSE	:= 0	
			If MV_PAR15 == 3
				R75->A75_EAN      := SB1->B1_CODBAR
				R75->A75_CODFIS   := &(SuperGetMv("MV_DIC_T06",,"'0850000'"))
			Endif	
			MsUnlock()        
        Endif
        R74->(dbSkip())
    EndDo    
Endif
//здддддддддддддддддддддд©
//ЁMonta Registro Tipo 55Ё
//юдддддддддддддддддддддды
If mv_par14 <> 4
	dbSelectArea("SF6")
	dbSetOrder(2)
	#IFDEF TOP
	    cAliasSF6 := "a940ASF6"
		aStru  := SF6->(dbStruct())
		cQuery := "SELECT * "
		cQuery += "FROM "+RetSqlName("SF6")+" "
		cQuery += "WHERE F6_FILIAL='"+xFilial("SF6")+"' AND "
		cQuery += "F6_DTARREC>='"+Dtos(dDtIni)+"' AND "
		cQuery += "F6_DTARREC<='"+Dtos(dDtFim)+"' AND "	
		If !Empty(cEstDest)
			If lListEst
				cQuery += "F6_EST ='"+ cEstDest+"' AND "
			Else
				cQuery += "F6_EST <>'"+ cEstDest+"' AND "
			EndIf
		EndIf			
		cQuery += "D_E_L_E_T_ = ' ' "
		cQuery += "ORDER BY "+SqlOrder(SF6->(IndexKey()))
	
		cQuery := ChangeQuery(cQuery)
		dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasSF6,.T.,.T.)
	
		For nX := 1 To len(aStru)
			If aStru[nX][2] <> "C" .And. FieldPos(aStru[nX][1])<>0
				TcSetField(cAliasSF6,aStru[nX][1],aStru[nX][2],aStru[nX][3],aStru[nX][4])
			EndIf
		Next nX
		dbSelectArea(cAliasSF6)
	#ELSE 
	    (cAliasSF6)->( MsSeek(xFilial("SF6")))
	#ENDIf
	
	ProcRegua(LastRec())
	While (cAliasSF6)->(!Eof()) .And. xFilial("SF6")== (cAliasSF6)->F6_FILIAL
		IncProc(STR0005) //"Selecionando Registros..."
		#IFNDEF TOP
			If (cAliasSF6)->F6_DTARREC < dDtIni .Or. Iif(lListEst,((cAliasSF6)->F6_EST <> cEstDest .And. !Empty(cEstDest)),((cAliasSF6)->F6_EST==cEstDest .And. !Empty(cEstDest)))
				(cAliasSF6)->(dbSkip())
				Loop
			EndIf
			If (cAliasSF6)->F6_DTARREC > dDtFim
				(cAliasSF6)->(dbSkip())
				Loop
			EndIf
	    #ENDIf

    	If !(cAliasSF6)->F6_TIPOIMP$"1# "
			(cAliasSF6)->(dbSkip())
			Loop    	
		EndIf

		RecLock("R55",.T.)	
		R55->A55_CNPJ	:=	SM0->M0_CGC
        If AllTrim((cAliasSF6)->F6_INSC)<>AllTrim(SM0->M0_INSC)
		   R55->A55_IE		:=	ARETDIG((cAliasSF6)->F6_INSC,.t.,(cAliasSF6)->F6_EST)
		Else
		   R55->A55_IE		:=	ARETDIG("",.t.,(cAliasSF6)->F6_EST)
		Endif   
		R55->A55_DATPAG	:=	(cAliasSF6)->F6_DTARREC
		R55->A55_UFSUBS	:=	GETMV("MV_ESTADO")
		R55->A55_UFFAV	:=	(cAliasSF6)->F6_EST
		R55->A55_BANCO	:=	(cAliasSF6)->F6_BANCO
		R55->A55_AGENC	:=	Strzero(val((cAliasSF6)->F6_AGENCIA),4)
		R55->A55_NUMERO	:=	Strzero(val((cAliasSF6)->F6_NUMERO),20)
		R55->A55_VALOR	:=	(cAliasSF6)->F6_VALOR
		R55->A55_VENCTO	:=	(cAliasSF6)->F6_DTVENC
		R55->A55_CONVEN	:=	(cAliasSF6)->F6_NUMCONV
	
		SX3->(DbSetOrder(2))
		If !Empty(SF6->F6_ANOREF) .And. SX3->(MsSeek("F6_ANOREF")) .And. X3USO(SX3->X3_USADO)
			R55->A55_MESANO	:= StrZero((cAliasSF6)->F6_MESREF,2)+StrZero((cAliasSF6)->F6_ANOREF,4)
		Else
			R55->A55_MESANO	:= StrZero((cAliasSF6)->F6_MESREF,2)+StrZero(Year(dDatabase),4)
		EndIf
		SX3->(DbSetOrder(1))
		MsUnlock()
	
		(cAliasSF6)->( dbSkip())
		IncProc(STR0036) //"Preparando Base de Dados - 3/3"
	EndDo                      
    dbSelectArea(cAliasSF6)
	dbCloseArea()
Endif

If mv_par20==1
	//зддддддддддддддддддддддд©
	//ЁMonta Registro Tipo 88EЁ
	//юддддддддддддддддддддддды
	SB1->(DbGoTop())
	While !SB1->(Eof())
        SB5->(dbSetOrder(1))
		SB5->(MsSeek(xFilial("SB1")+SB1->B1_COD))
		IF Empty(&cCodSEFMG)
		   SB1->(DbSkip())
	       Loop
	    EndIf
		If len(Alltrim(SB1->B1_COD))>14
			cProd :=STRTRAN(ALLTRIM(SB1->B1_POSIPI),".","")
		Else
			cProd :=SB1->B1_COD
		EndIf
		If !((cArq088E)->(dbSeek(cProd)))
			RecLock(cArq088E,.T.)
			(cArq088E)->A88ECNPJ		:=SM0->M0_CGC
			(cArq088E)->A88EIE			:=ARETDIG(SM0->M0_INSC,.T.,SM0->M0_ESTENT)
			(cArq088E)->A88ECOD			:=cProd
			(cArq088E)->A88ECODSEF		:=&cCodSEFMG
			MsUnlock()
		Endif

        If SB2->(dbSeek(xFilial("SB2")+SB1->B1_COD))
	       aSaldoIni:= CalcEst(cProd,SB2->B2_LOCAL,dDtIni)
	       aSaldoFim:= CalcEst(cProd,SB2->B2_LOCAL,dDtFim)

		   RecLock(cArq088Q,.T.)
		   (cArq088Q)->A88QDATA		:=dDtIni
		   (cArq088Q)->A88QPROD		:=cProd
		   (cArq088Q)->A88QQUANT	:=aSaldoIni[1]
		   (cArq088Q)->A88QTOT		:=aSaldoIni[2]
		   (cArq088Q)->A88QPOSSE	:="01"
		   MsUnlock()

		   RecLock(cArq088Q,.T.)
		   (cArq088Q)->A88QDATA		:=dDtFim
		   (cArq088Q)->A88QPROD		:=cProd
		   (cArq088Q)->A88QQUANT	:=aSaldoFim[1]
		   (cArq088Q)->A88QTOT		:=aSaldoFim[2]
		   (cArq088Q)->A88QPOSSE	:="01"
		   MsUnlock()
        Endif
        
		SB1->(dbSkip())
	Enddo

	//зддддддддддддддддддддддд©
	//ЁMonta Registro Tipo 88MЁ
	//юддддддддддддддддддддддды
	While dDtIni2<=dDtFim
		nPos:=Ascan(aMovimen,{|x|x[1]==ALLTRIM(STR(MONTH(dDtIni2)))+ALLTRIM(STR(YEAR(dDtIni2)))})
		If nPos==0
			AADD(aMovimen,{ALLTRIM(STR(MONTH(dDtIni2)))+ALLTRIM(STR(YEAR(dDtIni2))),""})
		Endif
		dDtIni2 +=1
	Enddo

	For nX :=1 TO Len(aMovimen)
		If aMovimen[nX][2]<>"OK"
			RecLock(cArq088M,.T.)
			(cArq088M)->A88MCNPJ		:=SM0->M0_CGC
			(cArq088M)->A88MMENS		:="Sem Movimento de Entradas/Saidas"
			MsUnlock()
		Endif
	Next
Endif

U_a940AGeraTxt()
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Fecha arquivo texto                                          Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
If nHandle >= 0
	FClose(nHandle)
Endif

IF __cDest != Nil
	__CopyFIle(__cTrbName,__cDest)
	FERASE(__cTrbName)
Endif

//зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Gera Listagem                                               Ё
//юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
a940ARelat()
//здддддддддддддддддддддддддддддддддддддддддд©
//Ё Apaga arquivos temporarios               Ё
//юдддддддддддддддддддддддддддддддддддддддддды
U_a940ADelArq({ {cArq050,"R50"},{cArq051,"R51"},{cArq053,"R53"},{cArq054,"R54"},{cArq055,"R55"},;
         {cArq060M,"M60"},{cArq060A,"A60"},{cArq060D,"D60"},{cArq060I,"I60"},{cArq060R,"R60"},;
         {cArq061,"R61"},{cArq070,"R70"},{cArq071,"R71"},IIF(mv_par21==2,{cArq074,"R74"},{"",""}),{cArq075,"R75"},{cArq076,"R76"},{cArq077,"R77"},{cArq090,"R90"} })

If mv_par21==1
	FsEstInv({"R74",""},2,,,,.T.)
Endif	

If lQuery
	dbSelectArea(cAliasSF3)
	dbCloseArea()
Else
  	dbSelectArea("SF3")
	RetIndex("SF3")
	dbClearFilter()
	Ferase(cIndex+OrdBagExt())
EndIf

If !lFirst
	dbSelectArea("SD2")
	RetIndex("SD2")
	dbClearFilter()
	Ferase(cIndex2+OrdBagExt())
Endif

RestArea(aAreaSint)
Return

/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁPrograma  ЁA940CNPJ  Ё Autor ЁNereu Humberto Jr      Ё Data Ё12.12.2002Ё╠╠
╠╠цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o ЁValida CNPJ                                                 Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁRetorno   ЁExpC1: CNPJ valido                                          Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁParametrosЁExpC1: CNPJ                                                 Ё╠╠
╠╠Ё          ЁExpC2: Tipo do Cliente/Fornecedor                           Ё╠╠
╠╠цддддддддддедддддддддддддддбдддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё   DATA   Ё Programador   ЁManutencao Efetuada                         Ё╠╠
╠╠цддддддддддедддддддддддддддедддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё          Ё               Ё                                            Ё╠╠
╠╠юддддддддддадддддддддддддддадддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
/*/
Static Function A940CNPJ(cCGC,cTipo)

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Zera o campo de CGC para pessoas nao obrigadas a inscricao.  Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
If ( cTipo=="X")
	cCGC:=""
EndIf

Return(PadR(cCGC,14))
/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁPrograma  ЁA940IE    Ё Autor ЁNereu Humberto Jr      Ё Data Ё12.12.2002Ё╠╠
╠╠цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o ЁValida Inscricao Estadual                                   Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁRetorno   ЁExpC1: IE valida                                            Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁParametrosЁExpC1: IE                                                   Ё╠╠
╠╠Ё          Ё                                                            Ё╠╠
╠╠цддддддддддедддддддддддддддбдддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё   DATA   Ё Programador   ЁManutencao Efetuada                         Ё╠╠
╠╠цддддддддддедддддддддддддддедддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё          Ё               Ё                                            Ё╠╠
╠╠юддддддддддадддддддддддддддадддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
/*/
Static Function A940IE(cInsc)

Local cRet	:=	""
Local nI	:=	1

For nI:=1 To Len(cInsc)
	If Isdigit(Subs(cInsc,nI,1)) .Or. IsAlpha(Subs(cInsc,nI,1))
		cRet+=Subs(cInsc,nI,1)
	Endif
Next
If Empty(cRet)
	cRet:="ISENTO"
Endif
Return(cRet)

/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁPrograma  ЁA94LoadProЁ Autor ЁNereu Humberto Jr      Ё Data Ё26.12.2002Ё╠╠
╠╠цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o ЁDefine codigo do Produto e do NCM                           Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁRetorno   ЁExpC1: .T.                                                  Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁParametrosЁExpC1: cTipo "E" - SD1 /  "S" - SD2                         Ё╠╠
╠╠Ё          ЁExpC2: cNcm                                                 Ё╠╠
╠╠Ё          ЁExpC3: cProd                                                Ё╠╠
╠╠Ё          ЁExpC4: cTec - SD1->D1_TEC                                   Ё╠╠
╠╠цддддддддддедддддддддддддддбдддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё   DATA   Ё Programador   ЁManutencao Efetuada                         Ё╠╠
╠╠цддддддддддедддддддддддддддедддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё          Ё               Ё                                            Ё╠╠
╠╠юддддддддддадддддддддддддддадддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
/*/
Static Function A940LoadPro(cTipo,cNcm,cProd,cTec)

If Len(alltrim(SB1->B1_COD))>14
	cNcm  :=STRTRAN(ALLTRIM(SB1->B1_POSIPI),".","")
	cProd :=STRTRAN(ALLTRIM(SB1->B1_POSIPI),".","")
Else
	cNcm  :=STRTRAN(ALLTRIM(SB1->B1_POSIPI),".","")
	cProd :=SUBS(SB1->B1_COD,1,14)
EndIf
If cTipo == "E" .And. cTec <> NIL
	If!Empty(cTec)
		cNcm  :=STRTRAN(ALLTRIM(cTec),".","")
		cProd :=STRTRAN(ALLTRIM(cTec),".","")
	Endif	
EndIf

If Existblock("A940PRD")
    cProd := Execblock("A940PRD",.F.,.F.,{cTipo,cNcm,cProd,cTec}) 
EndIf

Return(.T.)

/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбдддддддддддддбддддддбдддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁFun┤┘o    ЁA940Fill     ЁAutor Ё Andreia dos Santos  Ё Data Ё 07/01/00 Ё╠╠
╠╠цддддддддддедддддддддддддаддддддадддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o ЁEncaixa conteudo em espaco especificado                     Ё╠╠
╠╠юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function a940Fill(cConteudo,nTam)
	
cConteudo	:=	If(cConteudo==NIL,"",cConteudo)
If Len(cConteudo)>nTam
	cRetorno	:=	Substr(cConteudo,1,nTam)
Else
	cRetorno	:=	cConteudo+Space(nTam-Len(cConteudo))
Endif
	
Return (cRetorno)

/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбддддддддддддддбддддддбддддддддддддддддддддддбддддбдддддддддд©╠╠
╠╠ЁFun┤┘o    Ё R940ANumReg  ЁAutor ЁAndreia dos Santos    ЁDataЁ 09/04/01 Ё╠╠
╠╠цддддддддддеддддддддддддддаддддддаддддддддддддддддддддддаддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o Ё 	    	    			                                  Ё╠╠
╠╠юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
User Function A940ANumReg(nSize)

Return({1000000000,10800}[Max(nSize,1)])

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммямммммммммммммкмммммммяммммммммммммммммммммкммммммямммммммммммм╩╠╠
╠╠╨FunctionЁA940AGeraTXT ╨Autor  ЁAndreia dos Santos  ╨ Data Ё 05/04/01   ╨╠╠
╠╠лммммммммьмммммммммммммймммммммоммммммммммммммммммммйммммммомммммммммммм╧╠╠
╠╠╨Desc.   ЁGera Arquivo texto para SINTEGRA                              ╨╠╠
╠╠лммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso     ЁMATA940A                                                      ╨╠╠
╠╠хммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
User Function a940AGeraTxt()

Local cCGC	:=	SM0->M0_CGC
Local cInsc	:=	ARETDIG(SM0->M0_INSC,.T.,SM0->M0_ESTENT)
Local cFaxAux:=	SM0->M0_FAX
Local nVirgula	:= Rat(",",SM0->M0_ENDENT)
Local nNumero 	:= val(AllTrim(SubStr(SM0->M0_ENDENT,nVirgula+1)))
Local cEnderec	:= PadR(IIf(nNumero!=0,SubStr(SM0->M0_ENDENT,1,nVirgula-1),SM0->M0_ENDENT),34)
Local cTelEAux	:= SM0->M0_TEL
Local cContato	:=	GetMV("MV_RESPFIS")
Local cTel		:=	""
Local cFax		:=	""
Local nY		:=	1
Private nDisco	:=1
Private nRegN0	:=0


// Retira caracteres do campo cTeleAux
For nY:=1 To Len(cTeleAux)
	If IsDigit(Subs(cTeleAux,nY,1))
		cTel	+= Subs(cTeleAux,nY,1)
	Endif
Next

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁQuando nao ha virgula no endereco procura-se o caracter brancoЁ
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
If ( nVirgula == 0 )
	nVirgula 	:= Rat(" ",AllTrim(SM0->M0_ENDENT))
	nNumero		:= Val(AllTrim(SubStr(SM0->M0_ENDENT,nVirgula+1)))
	cEnderec	:= PadR(IIf(nNumero!=0,SubStr(SM0->M0_ENDENT,1,nVirgula-1),SM0->M0_ENDENT),34)
EndIf

//зддддддддддддддддддддддддддддддд©
//ЁRetira caracteres do campo cFaxЁ
//юддддддддддддддддддддддддддддддды
For nY:=1 To Len(cFaxAux)
	If IsDigit(Subs(cFaxAux,nY,1))
		cFax += Subs(cFaxAux,nY,1)
	Endif
Next

If Empty(cCGC)
	cCGC	:=	Replic("0",14)
Endif


//здддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro TIPO 10 Mestre de Estabelecimento  Ё
//юдддддддддддддддддддддддддддддддддддддддддддды
A940AAvlDrv(@nHandle,1,1)

a940AReg10(cCGC,cInsc, cFax)
//здддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro TIPO 11 - Dados Complementares do Informante Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддды
//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁLayOut diferencia para DIC                          Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
If MV_PAR15 <> 3
	a940AReg11(cEnderec,nNumero,cContato,cTEL)
EndIf
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro TIPO 50 - Notas Fiscais modelos 1, 1A, 3, 6 e 22 Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
a940AReg50()
//здддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro TIPO 51 Total da NF quanto ao IPI  Ё
//юдддддддддддддддддддддддддддддддддддддддддддды
a940AReg51()
//здддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro TIPO 53 Substituicao Tributaria    Ё
//юдддддддддддддддддддддддддддддддддддддддддддды
a940AReg53()
//зддддддддддддддддддддддддд©
//ЁRegistro TIPO 54 Produto Ё
//юддддддддддддддддддддддддды
a940AReg54()
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro TIPO 55 Guia Nacional de Recolhimento de Tributos Estaduais  Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
a940AReg55()
//зддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro TIPO 60 Cupom Fiscal, Cupom Fiscal PDV  Ё
//юддддддддддддддддддддддддддддддддддддддддддддддддды
a940AReg60()
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro TIPO 61 Model 14, 15, 16, 13, 02, 21, 04 e 07  Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддды
a940AReg61()
//здддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro TIPO 70 NF de Servico de Transporte  Ё
//юдддддддддддддддддддддддддддддддддддддддддддддды
a940AReg70()
//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro TIPO 71 Informacoes da Carga Transportada  Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
a940aReg71()
If mv_par21 == 1 .and. MV_PAR15 == 3
	//здддддддддддддддддддддддддддддддддддддддддддддд©
	//ЁRegistro TIPO 74 Resumo do Inventario Produto Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддды
	a940aReg74()
Endif	
//здддддддддддддддддддддддддддддддддддддддддддддд©
//ЁRegistro TIPO 75 Codigo de Produto ou Servico Ё
//юдддддддддддддддддддддддддддддддддддддддддддддды
a940aReg75()
If mv_par20==1
	//зддддддддддддддддддд©
	//ЁRegistro TIPO 88C  Ё
	//юддддддддддддддддддды
	a940ARg88C()
	//зддддддддддддддддддд©
	//ЁRegistro TIPO 88D  Ё
	//юддддддддддддддддддды
	a940ARg88D()
	//зддддддддддддддддддд©
	//ЁRegistro TIPO 88E  Ё
	//юддддддддддддддддддды
	a940ARg88E()
	//зддддддддддддддддддд©
	//ЁRegistro TIPO 88M  Ё
	//юддддддддддддддддддды
	a940ARg88M()
	//зддддддддддддддддддд©
	//ЁRegistro TIPO 88Q  Ё
	//юддддддддддддддддддды
	a940ARg88Q()
Endif

If mv_par15 == 3
	//зддддддддддддддддддд©
	//ЁRegistro Tipo 88/50Ё
	//юддддддддддддддддддды
	A940ARG8850()
EndIf
//зддддддддддддддддддддддддд©
//ЁRegistro TIPO 88         Ё
//юддддддддддддддддддддддддды
a940aReg88()
//зддддддддддддддддддддддддд©
//ЁRegistro TIPO 90 Mestre  Ё
//юддддддддддддддддддддддддды
a940aReg90()
return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    Ёa940AReg10╨Autor  ЁAndreia dos Santos  ╨ Data Ё  05/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     ЁGrava  registro tipo 11 em arquivo texto                    ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
STATIC FUNCTION a940AReg10(cCGC,cInsc,cFax)

Local cRegistro	:=	"10"
Local cCod		:=	"3"	
//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁLayOut diferencia para DIC                          Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
If mv_par15 <> 3
	cRegistro	+=	AFISFILL(Num2Chr(Val(cCGC),14,0),14)	// CGC da Empresa
	cRegistro	+=	aFISFILL(cInsc,14)							// Inscricao Estadual
	cRegistro	+=	aFISFILL(SM0->M0_NOMECOM,35)				// Nome Comercial
	cRegistro	+=	aFISFILL(SM0->M0_CIDENT,30)				// Municipio
	cRegistro	+=	aFISFILL(SM0->M0_ESTENT,02)				// Estado
	cRegistro	+=	aFISFILL(Num2Chr(Val(cFax),10,0),10)		// Fax
	cRegistro	+=	aFISFILL(DTOS(dDtIni),08)					// Data Inicial
	cRegistro	+=	aFISFILL(DTOS(dDtFim),08)					// Data Final
    If YEAR(dDtFim)<2003
	   cRegistro	+=	aFISFILL("1",01)          					// Codigo da identificacao do Convenio
	Else
	   cRegistro	+=	aFISFILL("3",01)          					// Codigo da identificacao do Convenio
	Endif   
	//зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Codigo da Identificacao da Natureza das Operacoes Informadas 							Ё
	//Ё 1-Interestaduais somente com Substituicao Tributaria         							Ё
	//Ё 2-Interestaduais com ou Sem Substituicao Tributaria( Estado Origem/Destino preenchido)  Ё
	//Ё 3-Totalidade das operacoes do informante (Estado Origem/Destino vazio )                 Ё
	//юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	cCod	:=	(IIf(!Empty(cEstDest),"2",cCod))
	cRegistro	+=	aFISFILL(Str(mv_par23,1),01)		//Codigo da Identificacao da Natureza das Operacoes Informadas
	cRegistro	+=	aFISFILL(alltrim(cFinalid),1)		//Codigo da finalidade do arquivo magnetico	
Else
	cRegistro	+=	aFISFILL(StrZero(Val(SM0->M0_INSC),10),10)				// Inscricao Estadual
	cRegistro	+=	AFISFILL(Num2Chr(Val(cCGC),14,0),14)	// CGC da Empresa
	cRegistro	+=	aFISFILL(Substr(DTOS(dDtIni),1,4),04)
	cRegistro	+=	aFISFILL(Substr(DTOS(dDtIni),5,2),02)	
	cRegistro	+=	aFISFILL(Strzero(Val(mv_par16),5),05)
	cRegistro	+=	Iif(!empty(mv_par17),aFISFILL(StrZero(Val(ALLTRIM(mv_par17)),10),10),aFISFILL(Repl("0",10),10))
	cRegistro	+=	"N"
	cRegistro	+=	"A"
    If YEAR(dDtFim)<2003
	   cRegistro	+=	aFISFILL("1",01)          					// Codigo da identificacao do Convenio
	Else
	   cRegistro	+=	aFISFILL("3",01)          					// Codigo da identificacao do Convenio
	Endif   
	cRegistro	+=	Space(134)
EndIf
A940AGRAVA(cRegistro)
Return
/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбдддддддддддддбддддддбдддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁFun┤┘o    ЁA940AReg11   ЁAutor Ё Andreia dos Santos  Ё Data Ё 05/04/01 Ё╠╠
╠╠цддддддддддедддддддддддддаддддддадддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o ЁGrava registro tipo 11                                      Ё╠╠
╠╠юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function A940AReg11(cEnderec,nNumero,cContato,cTEL)

Local cRegistro	:=	"11"
Local aArray	:=	{}
Local lMta940Efs:=	(existblock("A940EFS"))	

If lMta940Efs
	aArray	:=	ExecBlock("A940EFS",.F.,.F.)
Endif

If Empty(aArray) .Or. !(ValType(aArray) == "A") .or.(ValType(aArray) == "A" .and. Len(aArray) # 7)
	aArray := { 	cEnderec	,;				//	[1] Endereco
		nNumero		,;				//	[2] Numero
		SM0->M0_COMPENT	,;				//	[3] complemento
		PadR(SM0->M0_BAIRENT,15),;	//	[4] Bairro
		Val(SM0->M0_CEPENT)	 ,;	//	[5] CEP
		cContato				 ,;	//	[6] Contato
		PadR(cTEL,12) }			//	[7] Telefone
Else
	aArray[1]	:=	IIf( !(Valtype(aArray[1])=="C"),cEnderec,aArray[1])
	aArray[2]	:=	IIf( !(Valtype(aArray[2])=="N"),nNumero,aArray[2])
	aArray[3]	:=	IIf( !(Valtype(aArray[3])=="C"),SM0->M0_COMPENT,aArray[3])
	aArray[4]	:=	IIf( !(Valtype(aArray[4])=="C"),PadR(SM0->M0_BAIRENT),aArray[4])
	aArray[5]	:=	IIf( !(Valtype(aArray[5])=="N"),Val(SM0->M0_CEPENT),aArray[5])
	aArray[6]	:=	IIf( !(Valtype(aArray[6])=="C"),cContato,aArray[6])
	aArray[7]	:=	IIf( !(Valtype(aArray[7])=="N"),PadR(cTEL,12),aArray[7])
EndIf

cRegistro	+=	a940Fill(aArray[1],34)						// Logradouro
cRegistro	+=	a940Fill(Num2Chr(aArray[2],5,0),05)	// Numero
cRegistro	+=	a940Fill(IIf(aArray[2]==0 .And. !lMta940Efs ,"S/N",aArray[3]),22)						// Complemento
cRegistro	+=	a940Fill(aArray[4],15)						// Bairro
cRegistro	+=	a940Fill(Num2Chr(aArray[5],8,0),08)	// CEP
cRegistro	+=	a940Fill(aArray[6],28)					  	// Contato
cRegistro	+=	a940Fill(Num2Chr(Val(aArray[7]),12,0),12)	// Telefone

A940AGRAVA(cRegistro)

Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    ЁA940AREG50╨Autor  ЁAndreia dos Santos  ╨ Data Ё  05/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 50                                     ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
STATIC FUNCTION A940AREG50()

Local cRegistro	:=	""
ProcRegua( R50->(LastRec()))
R50->(dbSetOrder(1))
R50->(dbGoTop())

While R50->(!EOF())

    If YEAR(dDtFim)<2003
	   	cRegistro	:="50"	
	   	cRegistro	+=	AFISFILL(Num2Chr(Val(R50->A50_CNPJ),14,0),14)			//02. CGC
		cRegistro	+=	AFISFILL(R50->A50_IE,14)									//03. Inscricao Estadual
		cRegistro	+=	AFISFILL(DTOS(R50->A50_EMISS),08)						//04. Data de emissao/Recebimento
		cRegistro	+=	AFISFILL(R50->A50_UF,02)    								//05. Unidade da federacao do Remetente/Destinatario
		cRegistro	+=	AFISFILL(R50->A50_MODELO,02)		  		 				//06.Codigo do Modelo da Nota fiscal
		cRegistro	+=	AFISFILL(FisGetSer(R50->A50_SERIE),03)					//07. Serie da Nota Fiscal
		cRegistro	+=	AFISFILL(SPACE(02),02)    								//08. SubSerie
		cRegistro	+=	AFISFILL(Num2Chr(Val(R50->A50_NFISC),6,0),6) 			//09.Numero da Nota Fiscal
		cRegistro	+=	AFISFILL(Num2Chr(Val(substr(R50->A50_CFOP,1,3)),3,0),3) //10.CFOP
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_VALTOT,13),13)					//12.Valor Total da Nota Fiscal
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_BSICM,13),13)					//13.Base de Calculo do ICMS
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_VALICM,13),13)					//14.Valor do ICMS
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_ISENTO,13),13)					//15.ICMS Isento
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_OUTRAS,13),13)					//16.ICMS outras
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_ALQICM,4),4)					//17.Aliquota do ICMS
		cRegistro	+=	AFISFILL(R50->A50_SITUAC,1)								//18.Situacao quanto ao cancelamento
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 == 3
			cRegistro += AFISFILL(Strzero(Val(R50->A50_CODMUN),5),5)
			cRegistro += AFISFILL(Strzero(Val(R50->A50_ANOAID),4),4)
			cRegistro += AFISFILL(Strzero(Val(R50->A50_NUMAID),5),5)
			cRegistro += AFISFILL(StrZero(Val(R50->A50CFOPEXT),2)) //21.CFOP Extendido
			cRegistro += AFISFILL(DTOS(R50->A50_EMISS),08)
			cRegistro += Space(34)
		EndIf
	Else 
	   	cRegistro	:="50"	
	   	cRegistro	+=	AFISFILL(Num2Chr(Val(R50->A50_CNPJ),14,0),14)	//02. CGC
		cRegistro	+=	AFISFILL(R50->A50_IE,14)							//03. Inscricao Estadual
		cRegistro	+=	AFISFILL(DTOS(R50->A50_EMISS),08)				//04. Data de emissao/Recebimento
		cRegistro	+=	AFISFILL(R50->A50_UF,02)    						//05. Unidade da federacao do Remetente/Destinatario
		cRegistro	+=	AFISFILL(R50->A50_MODELO,02)		  		 		//06.Codigo do Modelo da Nota fiscal
		cRegistro	+=	AFISFILL(FisGetSer(R50->A50_SERIE),03)			//07. Serie da Nota Fiscal
		cRegistro	+=	AFISFILL(Num2Chr(Val(R50->A50_NFISC),6,0),6) 	//09.Numero da Nota Fiscal
		cRegistro	+=	AFISFILL(Num2Chr(Val(substr(R50->A50_CFOP,1,4)),4,0),4) //10.CFOP
		cRegistro	+=	AFISFILL(R50->A50_EMIT,1) //11.Emitente
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_VALTOT,13),13)		//12.Valor Total da Nota Fiscal
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_BSICM,13),13)		//13.Base de Calculo do ICMS
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_VALICM,13),13)		//14.Valor do ICMS
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_ISENTO,13),13)		//15.ICMS Isento
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_OUTRAS,13),13)		//16.ICMS outras
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_ALQICM,4),4)		//17.Aliquota do ICMS
		cRegistro	+=	AFISFILL(R50->A50_SITUAC,1)					//18.Situacao quanto ao cancelamento
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 == 3
			cRegistro += AFISFILL(Strzero(Val(R50->A50_CODMUN),5),5)
			cRegistro += AFISFILL(Strzero(Val(R50->A50_ANOAID),4),4)
			cRegistro += AFISFILL(Strzero(Val(R50->A50_NUMAID),5),5)
			cRegistro += AFISFILL(StrZero(Val(R50->A50CFOPEXT),2),2)
			cRegistro += AFISFILL(DTOS(R50->A50_EMISS),08)
			cRegistro += Space(34)
		EndIf	
	Endif	
	A940aGrava(cRegistro)
	R50->(dbSkip())	
	IncProc(STR0023) //"Gravando Registro Tipo 50"
End

Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨FUNCAO    ЁA940AREG51╨Autor  ЁAndreia dos Santos  ╨ Data Ё  05/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 51                                     ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function A940AReg51()

Local cRegistro	:=""
Local cCNPJ	:= ""

ProcRegua( R51->(LastRec()))

R51->(dbGoTop())
While R51->(!eof())

    If YEAR(dDtFim)<2003
		cCNPJ		:= IIf(!empty(R51->A51_CNPJ),R51->A51_CNPJ,Replic("0",14))
		cRegistro	:=	"51"
		cRegistro	+=	aFISFill(Num2Chr(Val(cCNPJ),14,0),14)				//02.CGC
		cRegistro	+=	aFISFill(R51->A51_IE,14)						//03.Inscricao Estadual
		cRegistro	+=	aFISFill(DTOS(R51->A51_EMISS),8)			//04.Data de emissao/Recebimento
		cRegistro	+=	aFISFill(R51->A51_UF,2)						//05.UF
	
		If MV_PAR15 <> 3
			cRegistro	+=	AFISFILL(FisGetSer(R51->A51_SERIE),02) 					//06.Serie	
			cRegistro	+=	aFISFill(SPACE(02),2)					//07.Sub-serie
		Else
			cRegistro	+=	AFISFILL(FisGetSer(R51->A51_SERIE),03) 					//06.Serie	
		EndIf	
		cRegistro	+=	aFISFill(Num2Chr(Val(R51->A51_NFISC),6,0),6) //08.Numero da Nota Fiscal
		cRegistro	+=	aFISFill(Num2Chr(Val(substr(R51->A51_CFOP,1,3)),3,0),3) //09.CFOP		
		cRegistro	+=	aFISFill(Num2Chr(R51->A51_VALTOT,13),13)	//10.Valor Total da NF
		cRegistro	+=	aFISFill(Num2Chr(R51->A51_VALIPI,13),13)	//11.Valor do IPI
		cRegistro	+=	aFISFill(Num2Chr(R51->A51_ISENTA,13),13)	//12.IPI isento
		cRegistro	+=	aFISFill(Num2Chr(R51->A51_OUTRAS,13),13)	//13.IPI outras
		cRegistro	+=	aFISFill(,20)										//14.Brancos
		cRegistro	+=	aFISFill(R51->A51_SITUAC,1)					//15.Situacao quanto ao cancelamento
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 == 3
			cRegistro	+=	aFISFill(Num2Chr(R51->A51_BASIPI,13),13)					//15.Situacao quanto ao cancelamento		
			cRegistro += Space(45)	

		EndIf
	Else
		cCNPJ		:= IIf(!empty(R51->A51_CNPJ),R51->A51_CNPJ,Replic("0",14))
		cRegistro	:=	"51"
		cRegistro	+=	aFISFill(Num2Chr(Val(cCNPJ),14,0),14)				//02.CGC
		cRegistro	+=	aFISFill(R51->A51_IE,14)						//03.Inscricao Estadual
		cRegistro	+=	aFISFill(DTOS(R51->A51_EMISS),8)			//04.Data de emissao/Recebimento
		cRegistro	+=	aFISFill(R51->A51_UF,2)						//05.UF
		cRegistro	+=	AFISFILL(FisGetSer(R51->A51_SERIE),03) 					//06.Serie	
		cRegistro	+=	aFISFill(Num2Chr(Val(R51->A51_NFISC),6,0),6) //08.Numero da Nota Fiscal
		cRegistro	+=	aFISFill(Num2Chr(Val(substr(R51->A51_CFOP,1,4)),4,0),4) //09.CFOP
		cRegistro	+=	aFISFill(Num2Chr(R51->A51_VALTOT,13),13)	//10.Valor Total da NF
		cRegistro	+=	aFISFill(Num2Chr(R51->A51_VALIPI,13),13)	//11.Valor do IPI
		cRegistro	+=	aFISFill(Num2Chr(R51->A51_ISENTA,13),13)	//12.IPI isento
		cRegistro	+=	aFISFill(Num2Chr(R51->A51_OUTRAS,13),13)	//13.IPI outras
		cRegistro	+=	aFISFill(,20)										//14.Brancos
		cRegistro	+=	aFISFill(R51->A51_SITUAC,1)					//15.Situacao quanto ao cancelamento
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 == 3
			cRegistro	+=	aFISFill(Num2Chr(R51->A51_BASIPI,13),13)					//15.Situacao quanto ao cancelamento		
			cRegistro += Space(45)	
		EndIf
	Endif	
	A940aGrava(cRegistro)
	R51->(dbSkip())		
	IncProc(STR0024) //"Gravando Registro Tipo 51"
End

Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    Ёa940AReg53╨Autor  ЁAndreia dos Santos  ╨ Data Ё  06/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 53                                     ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function a940AReg53()
Local cRegistro	:=	""
Local cCNPJ		:= ""

ProcRegua( R53->(LastRec()))
R53->(dbGoTop())
While R53->( !eof())
    If YEAR(dDtFim)<2003
		cCNPJ		:= IIf(!empty(R53->A53_CNPJ),R53->A53_CNPJ,Replic("0",14))

		cRegistro	:=	"53"
		cRegistro	+=	aFISFill(Num2Chr(Val(cCNPJ),14,0),14)			//02.CGC
		cRegistro	+=	aFISFill(R53->A53_IE,14)				   	//03.Inscricao Estadual
		cRegistro	+=	aFISFill(DTOS(R53->A53_EMISS),08)		//04.Data de Emissao/Recebimento
		cRegistro	+=	aFISFill(R53->A53_UF,02)			   		//05.Unidade de Federacao
		cRegistro	+=	aFISFill(R53->A53_MODELO,02)				//06.Codigo do modelo da NF
		cRegistro	+=	AFISFILL(FisGetSer(R53->A53_SERIE),03)		//07.Serie da NF
		If MV_PAR15 <> 3
			cRegistro	+=	aFISFill(SPACE(02),2)				//08.Subserie
		EndIf
		cRegistro	+=	aFISFill(Num2Chr(Val(R53->A53_NFISC),6,0),6)	//09.Numero da Nota Fiscal
		If MV_PAR15 == 3
			cRegistro	+=	aFISFill(Num2Chr(Val(substr(R53->A53_CFOP,1,4)),4,0),4)//10.CFOP
			cRegistro	+=	aFISFill(R53->A53_EMIT,1)							//11.EMITENTE					
		Else
			cRegistro	+=	aFISFill(Num2Chr(Val(substr(R53->A53_CFOP,1,3)),3,0),3)//10.CFOP	
		EndIf
		cRegistro	+=	aFISFill(Num2Chr(R53->A53_BRICMS,13),13) 				//11.Base do ICMS Retido
		cRegistro	+=	aFISFill(Num2Chr(R53->A53_VALRET,13),13) 				//12.ICMS Retido
		cRegistro	+=	aFISFill(Num2Chr(R53->A53_DESPES,13),13)				//13.Despesas Acessorias
		cRegistro	+=	aFISFill(R53->A53_SITUAC,1)							//14.Situacao quanto ao cancelamento
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 <> 3
			cRegistro	+=	aFISFill(,30)									//15.Brancos
		Else
			cRegistro	+=	aFISFill(,88)									//15.Brancos		
		EndIf
	Else
		cCNPJ		:= IIf(!empty(R53->A53_CNPJ),R53->A53_CNPJ,Replic("0",14))

		cRegistro	:=	"53"
		cRegistro	+=	aFISFill(Num2Chr(Val(cCNPJ),14,0),14)			//02.CGC
		cRegistro	+=	aFISFill(R53->A53_IE,14)				   	//03.Inscricao Estadual
		cRegistro	+=	aFISFill(DTOS(R53->A53_EMISS),08)		//04.Data de Emissao/Recebimento
		cRegistro	+=	aFISFill(R53->A53_UF,02)			   		//05.Unidade de Federacao
		cRegistro	+=	aFISFill(R53->A53_MODELO,02)				//06.Codigo do modelo da NF
		cRegistro	+=	AFISFILL(FisGetSer(R53->A53_SERIE),03)	//07.Serie da NF
		cRegistro	+=	aFISFill(Num2Chr(Val(R53->A53_NFISC),6,0),6)	//09.Numero da Nota Fiscal
		cRegistro	+=	aFISFill(Num2Chr(Val(substr(R53->A53_CFOP,1,4)),4,0),4)//10.CFOP
		cRegistro	+=	aFISFill(R53->A53_EMIT,1)							//11.EMITENTE					
		cRegistro	+=	aFISFill(Num2Chr(R53->A53_BRICMS,13),13) 				//11.Base do ICMS Retido
		cRegistro	+=	aFISFill(Num2Chr(R53->A53_VALRET,13),13) 				//12.ICMS Retido
		cRegistro	+=	aFISFill(Num2Chr(R53->A53_DESPES,13),13)				//13.Despesas Acessorias
		cRegistro	+=	aFISFill(R53->A53_SITUAC,1)							//14.Situacao quanto ao cancelamento
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 <> 3
			cRegistro	+=	aFISFill(,30)									//15.Brancos
		Else
			cRegistro	+=	aFISFill(R53->A53_ANTECI,1)						//15.Codigo Antecipacao Tributaria   
			cRegistro	+=	aFISFill(,87)									//15.Brancos		
		EndIf	
	Endif	
	A940AGrava(cRegistro)
	R53->(dbSkip())		
	IncProc(STR0025) //"Gravando Registro Tipo 53"
End

Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    Ёa940AReg54╨Autor  ЁAndreia dos Santos  ╨ Data Ё  06/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 54                                     ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function a940AReg54()

Local cRegistro
Local cCNPJ	:= ""

ProcRegua( R54->(LastRec()))
R54->(dbGoTop())

While R54->(!eof())

    If YEAR(dDtFim)<2003

		cCNPJ		:= IIf(!empty(R54->A54_CNPJ),R54->A54_CNPJ,Replic("0",14))

		cRegistro	:=	"54"												//01.Tipo
		cRegistro	+=	aFISFill(Num2Chr(Val(cCNPJ),14,0),14)				//02.CGC
		cRegistro	+=	aFISFill(R54->A54_MODELO,2)					
		//03.Codigo do modelo da NF
		cRegistro	+=	AFISFILL(FisGetSer(R54->A54_SERIE),03)				//04.Serie da NF
		If MV_PAR15 == 3
			cRegistro	+=	aFISFill(Num2Chr(Val(R54->A54_NFISC),6,0),6)//06.Numero da NF			
			cRegistro	+=	aFISFill(Num2Chr(Val(substr(R54->A54_CFOP,1,4)),4,0),4)//07.CFOP
			cRegistro	+=	aFISFill(Num2Chr(Val(R54->A54_CST),3,0),3) //08.CST
		Else
			cRegistro	+=	aFISFill(SPACE(02),2)					//05.Sub-serie
			cRegistro	+=	aFISFill(Num2Chr(Val(R54->A54_NFISC),6,0),6)//06.Numero da NF	
			cRegistro	+=	aFISFill(Num2Chr(Val(substr(R54->A54_CFOP,1,3)),3,0),3)//07.CFOP
		Endif
		cRegistro	+=	aFISFill(R54->A54_NUMITE,3)	   				//08.Numero do Item
		cRegistro	+=	aFISFill(Left(R54->A54_PRODUT,14),14)		//09.Codigo do produto ou servico
		If Mv_par15 == 3
			cRegistro	+=	aFISFill(Num2Chr(R54->A54_QUANT,11,3),11)	//10.Quantidade do produto
		Else
			cRegistro	+=	aFISFill(Num2Chr(R54->A54_QUANT,13,3),13)	//10.Quantidade do produto	
		EndIf
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_VALPRO,12),12) 	//11.Valor bruto do produto
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_VALDES,12),12)		//12.Valor do Desconto
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_BSICM,12),12)		//13.Base de calculo do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_BRICMS,12),12)		//14.Base de calculo do ICMS retido
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_VALIPI,12),12)		//15.Valor do IPI
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_ALQICM,4),4)		//16.Aliquota do ICMS
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды	
		IF MV_PAR15 == 3
			cRegistro += Space(03)
			cRegistro += AFISFILL(StrZero(Val(R54->A54CFOPEXT),2),2)
			cRegistro += Space(53)
		EndIf
	Else
		cCNPJ		:= IIf(!empty(R54->A54_CNPJ),R54->A54_CNPJ,Replic("0",14))

		cRegistro	:=	"54"												//01.Tipo
		cRegistro	+=	aFISFill(Num2Chr(Val(cCNPJ),14,0),14)				//02.CGC
		cRegistro	+=	aFISFill(R54->A54_MODELO,2)					
		cRegistro	+=	AFISFILL(FisGetSer(R54->A54_SERIE),03)//04.Serie da NF
		cRegistro	+=	aFISFill(Num2Chr(Val(R54->A54_NFISC),6,0),6)//06.Numero da NF			
		cRegistro	+=	aFISFill(Num2Chr(Val(substr(R54->A54_CFOP,1,4)),4,0),4)//07.CFOP
		cRegistro	+=	aFISFill(Num2Chr(Val(R54->A54_CST),3,0),3) //08.CST
		cRegistro	+=	aFISFill(R54->A54_NUMITE,3)	   				//08.Numero do Item
		cRegistro	+=	aFISFill(Left(R54->A54_PRODUT,14),14)		//09.Codigo do produto ou servico
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_QUANT,11,3),11)	//10.Quantidade do produto

		cRegistro	+=	aFISFill(Num2Chr(IIF(R54->A54_NUMITE$"991/992/993/999",0,R54->A54_VALPRO),12),12) 	//11.Valor bruto do produto
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_VALDES,12),12)		//12.Valor do Desconto
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_BSICM,12),12)		//13.Base de calculo do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_BRICMS,12),12)		//14.Base de calculo do ICMS retido
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_VALIPI,12),12)		//15.Valor do IPI
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_ALQICM,4),4)		//16.Aliquota do ICMS
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды	
		IF MV_PAR15 == 3
			cRegistro += Space(03)
			cRegistro += AFISFILL(StrZero(Val(R54->A54CFOPEXT),2),2)
			cRegistro += Space(53)
		EndIf
	Endif	
	A940AGrava(cRegistro)

	R54->(dbSkip())
	IncProc(STR0026) //"Gravando Registro Tipo 54"
EndDo	

Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    Ёa940AReg55╨Autor  ЁAndreia dos Santos  ╨ Data Ё  06/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 55                                     ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function a940AReg55()
Local cRegistro


ProcRegua( R55->(LastRec()))

R55->(dbGoTop())

While R55->(!eof())


    If YEAR(dDtFim)<2003

		cInsc	:= IIf("ISENT"$R55->A55_IE,"INEXISTENTE",R55->A55_IE)		

		cRegistro	:=	"55"														//01.Tipo
		cRegistro	+=	a940Fill(Num2Chr(Val(R55->A55_CNPJ),14,0),14)	//02.CGC
		cRegistro	+=	a940Fill(cInsc,14)											//03.Inscricao Estadual
		cRegistro	+=	a940Fill(DTOS(R55->A55_DATPAG),8)					//04.Data do pagamento do documento de arrecadacao
		cRegistro	+=	a940Fill(R55->A55_UFSUBS,2)							//05.Sigla da Unidade da Federacao do Contribuinte Subst. Tributario
		cRegistro	+=	a940Fill(R55->A55_UFFAV,2)							//06.Sigla da Unidade da Federacao de Destino ( favorecida)
		cRegistro	+=	a940Fill(Num2Chr(Val(R55->A55_BANCO),3,0),3)   	//07.Codigo do banco onde foi efetuado o recolhimento
		cRegistro	+=	a940Fill(Num2Chr(Val(R55->A55_AGENC),4,0),4) 	//08.Codigo da agencia onde foi efetuado o recolhimento
		cRegistro	+=	a940Fill(Num2Chr(Val(R55->A55_NUMERO),12,0),12)//09.Numero da autenticacao bancaria do documento de arrecadacao
		cRegistro	+=	a940Fill(Num2Chr(R55->A55_VALOR,13),13)		//10.Valor da Arrecadacao
		cRegistro	+=	a940Fill(DTOS(R55->A55_VENCTO),8)					//12.Data do Vencimento do ICMS substituto
		cRegistro	+=	a940Fill(R55->A55_MESANO,6) 							//12.Mes e Ano de referencia
		cRegistro	+=	a940Fill(R55->A55_CONVEN,30)							//13.Numero do convenio ou protocolo/Mercadoria
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 <> 3
			cRegistro	+=	a940Fill(,08) 												//14.Brancos
		Else	
			cRegistro	+=	a940Fill(,66) 												//14.Brancos
		EndIf
	Else	
		cInsc	:= IIf("ISENT"$R55->A55_IE,"INEXISTENTE",R55->A55_IE)		
		cRegistro	:=	"55"														//01.Tipo
		cRegistro	+=	a940Fill(Num2Chr(Val(R55->A55_CNPJ),14,0),14)	//02.CGC
		cRegistro	+=	a940Fill(cInsc,14)											//03.Inscricao Estadual
		cRegistro	+=	a940Fill(DTOS(R55->A55_DATPAG),8)					//04.Data do pagamento do documento de arrecadacao
		cRegistro	+=	a940Fill(R55->A55_UFSUBS,2)							//05.Sigla da Unidade da Federacao do Contribuinte Subst. Tributario
		cRegistro	+=	a940Fill(R55->A55_UFFAV,2)							//06.Sigla da Unidade da Federacao de Destino ( favorecida)
		cRegistro	+=	a940Fill(Num2Chr(Val(R55->A55_BANCO),3,0),3)   	//07.Codigo do banco onde foi efetuado o recolhimento
		cRegistro	+=	a940Fill(Num2Chr(Val(R55->A55_AGENC),4,0),4) 	//08.Codigo da agencia onde foi efetuado o recolhimento
		cRegistro	+=	a940Fill(Num2Chr(Val(R55->A55_NUMERO),20,0),20)//09.Numero da autenticacao bancaria do documento de arrecadacao
		cRegistro	+=	a940Fill(Num2Chr(R55->A55_VALOR,13),13)		//10.Valor da Arrecadacao
		cRegistro	+=	a940Fill(DTOS(R55->A55_VENCTO),8)					//12.Data do Vencimento do ICMS substituto
		cRegistro	+=	a940Fill(R55->A55_MESANO,6) 							//12.Mes e Ano de referencia
		cRegistro	+=	a940Fill(R55->A55_CONVEN,30)							//13.Numero do convenio ou protocolo/Mercadoria
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 == 3
			cRegistro	+=	a940Fill(,58) 												//14.Brancos
		EndIf
	Endif
	A940AGrava(cRegistro)

	R55->(dbSkip())
	IncProc(STR0027) //"Gravando Registro Tipo 55"
End

Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    ЁA940AREG60╨Autor  ЁAndreia dos Santos  ╨ Data Ё  06/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 60                                     ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function A940AREG60()

Local cRegistro	:= ""

ProcRegua( M60->(LastRec()))
M60->(dbGoTop())
While M60->(!eof())

    If YEAR(dDtFim)<2003

		cRegistro	:=	"60"										//01.Tipo
		cRegistro	+=	"M"							  				//02.Mestre
		If MV_PAR15 <> 3
			cRegistro	+=	aFISFill(DTOS(M60->M60_EMISS),8)	//03.Data de emissao
			cRegistro	+=	aFISFill(Num2Chr(Val(M60->M60_PDV),3,0),3) //04.Numero da maquina,ECF
			cRegistro	+=	aFISFill(M60->M60_NUMFAB,15)			//05.Numero de serie de fabricacao do equimento ecf
			cRegistro	+=	aFISFill(M60->M60_MODELO,2)			//06.Modelo do documento Fiscal
			cRegistro	+=	aFISFill(M60->M60_NUMINI,6)			//07.Numero do 1o. documento emitido no dia
			cRegistro	+=	aFISFill(M60->M60_NUMFIM,6)			//08.Numero do ultimo doc. emitido no dia
			cRegistro	+=	aFISFill(Num2Chr(VAL(M60->M60_REDUCZ),6,0),06)	//09.Numero de contador de reducao Z
	  	    cRegistro	+=	aFISFill(Num2Chr(M60->M60_VENDA,16,2),16)	//11.Totalizador Geral no inicio do dia
		    cRegistro	+=	aFISFill(Num2Chr(M60->M60_GERAL,16,2),16)	//12.Totalizador Geral no final do dia
			cRegistro	+=	aFISFill(,45)								//12.Brancos
		Else			
			//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
			//ЁLayOut diferencia para DIC                          Ё
			//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
			cRegistro	+=	aFISFill(DTOS(M60->M60_EMISS),8)	//03.Data de emissao
			cRegistro	+=	aFISFill(M60->M60_NUMFAB,20)			//05.Numero de serie de fabricacao do equimento ecf
			cRegistro	+=	aFISFill(Num2Chr(Val(M60->M60_PDV),3,0),3) //04.Numero da maquina,ECF
			cRegistro	+=	aFISFill(M60->M60_MODELO,2)			//06.Modelo do documento Fiscal
			cRegistro	+=	aFISFill(M60->M60_NUMINI,6)			//07.Numero do 1o. documento emitido no dia
			cRegistro	+=	aFISFill(M60->M60_NUMFIM,6)			//08.Numero do ultimo doc. emitido no dia
			cRegistro	+=	aFISFill(Num2Chr(VAL(M60->M60_REDUCZ),6,0),06)	//09.Numero de contador de reducao Z
			cRegistro	+=	aFISFill(Num2Chr(M60->M60_CRO,3,0),03)	//10.CRO
	  	    cRegistro	+=	aFISFill(Num2Chr(M60->M60_VENDA,16,2),16)	//11.Totalizador Geral no inicio do dia
		    cRegistro	+=	aFISFill(Num2Chr(M60->M60_GERAL,16,2),16)	//12.Totalizador Geral no final do dia
			cRegistro	+=	aFISFill(,95)								//13.Brancos	
		EndIf
	Else
	    cRegistro	:=	"60"										//01.Tipo
	    cRegistro	+=	"M"							  				//02.Mestre
		If MV_PAR15 <> 3
		   cRegistro	+=	aFISFill(DTOS(M60->M60_EMISS),8)	//03.Data de emissao
		   cRegistro	+=	aFISFill(M60->M60_NUMFAB,20)			//05.Numero de serie de fabricacao do equimento ecf
		   cRegistro	+=	aFISFill(Num2Chr(Val(M60->M60_PDV),3,0),3) //04.Numero da maquina,ECF
		   cRegistro	+=	aFISFill(M60->M60_MODELO,2)			//06.Modelo do documento Fiscal
		   cRegistro	+=	aFISFill(M60->M60_NUMINI,6)			//07.Numero do 1o. documento emitido no dia
		   cRegistro	+=	aFISFill(M60->M60_NUMFIM,6)			//08.Numero do ultimo doc. emitido no dia
		   cRegistro	+=	aFISFill(Num2Chr(VAL(M60->M60_REDUCZ),6,0),06)	//09.Numero de contador de reducao Z
		   cRegistro	+=	aFISFill(Num2Chr(M60->M60_CRO,3,0),03)	//10.CRO
	  	   cRegistro	+=	aFISFill(Num2Chr(M60->M60_VENDA,16,2),16)	//11.Totalizador Geral no inicio do dia
		   cRegistro	+=	aFISFill(Num2Chr(M60->M60_GERAL,16,2),16)	//12.Totalizador Geral no final do dia
		   cRegistro	+=	aFISFill(,37)								//12.Brancos
		Else
			//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
			//ЁLayOut diferencia para DIC                          Ё
			//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
			cRegistro	+=	aFISFill(DTOS(M60->M60_EMISS),8)	//03.Data de emissao
			cRegistro	+=	aFISFill(M60->M60_NUMFAB,20)			//05.Numero de serie de fabricacao do equimento ecf
			cRegistro	+=	aFISFill(Num2Chr(Val(M60->M60_PDV),3,0),3) //04.Numero da maquina,ECF
			cRegistro	+=	aFISFill(M60->M60_MODELO,2)			//06.Modelo do documento Fiscal
			cRegistro	+=	aFISFill(M60->M60_NUMINI,6)			//07.Numero do 1o. documento emitido no dia
			cRegistro	+=	aFISFill(M60->M60_NUMFIM,6)			//08.Numero do ultimo doc. emitido no dia
			cRegistro	+=	aFISFill(Num2Chr(VAL(M60->M60_REDUCZ),6,0),06)	//09.Numero de contador de reducao Z
			cRegistro	+=	aFISFill(Num2Chr(M60->M60_CRO,3,0),03)	//10.CRO
	  	    cRegistro	+=	aFISFill(Num2Chr(M60->M60_VENDA,16,2),16)	//11.Totalizador Geral no inicio do dia
		    cRegistro	+=	aFISFill(Num2Chr(M60->M60_GERAL,16,2),16)	//12.Totalizador Geral no final do dia
			cRegistro	+=	aFISFill(,95)								//13.Brancos	
		Endif   
	Endif	

	A940AGrava(cRegistro)
	M60->(dbSkip())
	IncProc(STR0028) //"Gravando Registro Tipo 60-Mestre"
EndDo

ProcRegua( A60->(LastRec()))
A60->(dbGoTop())
While A60->(!eof())

    If YEAR(dDtFim)<2003
		cRegistro	:=	"60"											//01.Tipo
		cRegistro	+=	"A"												//02.Mestre/ANALITICO
		cRegistro	+=	aFISFill(DTOS(A60->A60_EMISS),8)		//03.Data de emissao
		If MV_PAR15==3
			cRegistro	+=	aFISFill(A60->A60_NUMFAB,20)
			cRegistro	+=	aFISFill(A60->A60_SITTRI,04)				//05.Situacao Tributaria/Aliquota	
		Else
			cRegistro	+=	aFISFill(Num2Chr(Val(A60->A60_PDV),3,0),3) //04.Numero da maquina,ECF
			cRegistro	+=	aFISFill(A60->A60_SITTRI,04)				//05.Situacao Tributaria/Aliquota	
		EndIf	
		cRegistro	+=	aFISFill(Num2Chr(A60->A60_VALOR,12),12)	//06.Valor Acumulado
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 <> 3
			cRegistro	+=	aFISFill(,96)									//07.Brancos
		Else
			cRegistro	+=	aFISFill(,137)									//07.Brancos
		EndIf            
	Else 
		cRegistro	:=	"60"											//01.Tipo
		cRegistro	+=	"A"												//02.Mestre/ANALITICO
		cRegistro	+=	aFISFill(DTOS(A60->A60_EMISS),8)		//03.Data de emissao
		If MV_PAR15==3
			cRegistro	+=	aFISFill(A60->A60_NUMFAB,20)
			cRegistro	+=	aFISFill(A60->A60_SITTRI,04)				//05.Situacao Tributaria/Aliquota	
		Else
			cRegistro	+=	aFISFill(Num2Chr(Val(A60->A60_PDV),3,0),3) //04.Numero da maquina,ECF
			cRegistro	+=	aFISFill(A60->A60_SITTRI,04)				//05.Situacao Tributaria/Aliquota	
		EndIf	
		cRegistro	+=	aFISFill(Num2Chr(A60->A60_VALOR,12),12)	//06.Valor Acumulado
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 <> 3
			cRegistro	+=	aFISFill(,96)									//07.Brancos
		Else
			cRegistro	+=	aFISFill(,137)									//07.Brancos
		EndIf            
	Endif	
	A940AGRAVA(cRegistro)

	A60->(dbSkip())
	IncProc(STR0029) //"Gravando Registro Tipo 60-Analitico"
EndDo

ProcRegua( D60->(LastRec()))
D60->(dbGoTop())
While D60->(!eof())

    If YEAR(dDtFim)>2002
		cRegistro	:=	"60"											//01.Tipo
		cRegistro	+=	"D"												//02.Mestre/ANALITICO
		cRegistro	+=	aFISFill(DTOS(D60->D60_EMISS),8)		//03.Data de emissao
		cRegistro	+=	aFISFill(D60->D60_NUMFAB,20)
		cRegistro	+=	aFISFill(D60->D60_CODPRO,14)
		cRegistro	+=	aFISFill(Num2Chr(D60->D60_QUANT,13),13)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(Num2Chr(D60->D60_VALOR,16),16)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(Num2Chr(D60->D60_BSICM,16),16)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(D60->D60_SITTRI,04)				//05.Situacao Tributaria/Aliquota	
		cRegistro	+=	aFISFill(Num2Chr(D60->D60_VLICM,13),13)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(,19)									//07.Brancos
	    A940AGRAVA(cRegistro)
	Endif	

	D60->(dbSkip())
	IncProc(STR0029) //"Gravando Registro Tipo 60-Analitico"
EndDo

ProcRegua( I60->(LastRec()))
I60->(dbGoTop())
While I60->(!eof())

    If YEAR(dDtFim)>2002
		cRegistro	:=	"60"											//01.Tipo
		cRegistro	+=	"I"												//02.Mestre/ANALITICO
		cRegistro	+=	aFISFill(DTOS(I60->I60_EMISS),8)		//03.Data de emissao
		cRegistro	+=	aFISFill(I60->I60_NUMFAB,20)
		cRegistro	+=	aFISFill(I60->I60_MODELO,02)
		cRegistro	+=	aFISFill(I60->I60_COO,06)
		cRegistro	+=	aFISFill(I60->I60_ITEM,03)
		cRegistro	+=	aFISFill(I60->I60_CODPRO,14)		
		cRegistro	+=	aFISFill(Num2Chr(I60->I60_QUANT,13),13)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(Num2Chr(I60->I60_VLUNI,13),13)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(Num2Chr(I60->I60_BSICM,12),12)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(I60->I60_SITTRI,04)				//05.Situacao Tributaria/Aliquota	
		cRegistro	+=	aFISFill(Num2Chr(I60->I60_VLICM,12),12)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(,16)									//07.Brancos
	    A940AGRAVA(cRegistro)
	Endif	

	I60->(dbSkip())
	IncProc(STR0029) //"Gravando Registro Tipo 60-Analitico"
EndDo

ProcRegua( R60->(LastRec()))
R60->(dbGoTop())
While R60->(!eof())

    If YEAR(dDtFim)>2002
		cRegistro	:=	"60"											//01.Tipo
		cRegistro	+=	"R"												//02.Mestre/ANALITICO
		cRegistro	+=	aFISFill(R60->R60_MESANO,6)		//03.Data de emissao
		cRegistro	+=	aFISFill(R60->R60_CODPRO,14)
		cRegistro	+=	aFISFill(Num2Chr(R60->R60_QUANT,13),13)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(Num2Chr(R60->R60_VALOR,16),16)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(Num2Chr(R60->R60_BSICM,16),16)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(R60->R60_SITTRI,04)				//05.Situacao Tributaria/Aliquota	
        If mv_par15<>3
		   cRegistro	+=	aFISFill(,54)									//07.Brancos
		Else
		   cRegistro	+=	aFISFill(,112)									//07.Brancos
		Endif   
	Endif	
	A940AGRAVA(cRegistro)

	R60->(dbSkip())
	IncProc(STR0029) //"Gravando Registro Tipo 60-Analitico"
EndDo
Return	

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    Ёa940AReg61╨Autor  ЁAndreia dos Santos  ╨ Data Ё  06/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 55                                     ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function a940aReg61()

Local cRegistro	:= ""

ProcRegua( R61->(LastRec()))
R61->(dbGoTop())
While R61->(!eof())
    If YEAR(dDtFim)<2003
		cRegistro	:=	"61"													//01.Tipo
		cRegistro	+=	aFISFill(,28) 											//02. brancos
		cRegistro	+=	aFISFill(dtos(R61->A61_EMISS),08)						//04. Data de emissao dos doc. fiscais
		cRegistro	+=	aFISFill(R61->A61_MODELO,02)						//05. Modelo dos doc. Fiscais
		cRegistro	+=	AFISFILL(FisGetSer(R61->A61_SERIE,"61"),03)		//06. Serie dos doc. Fiscais
		cRegistro	+=	aFISFill(R61->A61_SUBSER,02)						//07. Subserie dos documentos Fiscais
		cRegistro	+=	aFISFill(strzero(val(R61->A61_NUMINI),6),06)	//08. Numero do 1o. doc. Fiscal emitido no dia
		cRegistro	+=	aFISFill(strzero(val(R61->A61_NUMFIM),6),06)	//09. Numero do ultimo doc. Fiscal emitido no dia
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_VALTOT,13),13)			//10. Somatorio diario das saidas p/doc. fiscais de mesma serie e subserie
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_BSICM,13),13)		//11. Base de Calculo do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_VALICM,12),12)			//12.Valor do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_ISENTA,13),13)		//13.Isenta ou nao tributada
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_OUTRAS,13),13)			//14.Outras
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_ALQICM,04),04)		//15.Aliquota ICMS
		cRegistro	+=	aFISFill(,01)											//16. Brancos
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 == 3
			cRegistro += aFISFill(strzero(val(R61->A61_CODMUN),5),5)					//17. Codigo do Municipio
			cRegistro += aFisFill(R61->A61_OBS,35)						//18. Observacao
			cRegistro += aFisFill(R61->A61_SITUAC,1)						//19. Situacao da nota fiscal
			cRegistro += aFisFill(Strzero(Val(R61->A61_ANOAID),4),4)						//20. Ano AIDF
			cRegistro += aFisFill(Strzero(Val(R61->A61_NUMAID),5),5)
			cRegistro += aFisFill(,08)											//22. Brancos
		EndIf
	Else
		cRegistro	:=	"61"													//01.Tipo
		cRegistro	+=	aFISFill(,28) 											//02. brancos
		cRegistro	+=	aFISFill(dtos(R61->A61_EMISS),08)						//04. Data de emissao dos doc. fiscais
		cRegistro	+=	aFISFill(R61->A61_MODELO,02)						//05. Modelo dos doc. Fiscais
		cRegistro	+=	AFISFILL(FisGetSer(R61->A61_SERIE,"61"),03)		//06. Serie dos doc. Fiscais
		cRegistro	+=	aFISFill(R61->A61_SUBSER,02)						//07. Subserie dos documentos Fiscais
		cRegistro	+=	aFISFill(strzero(val(R61->A61_NUMINI),6),06)	//08. Numero do 1o. doc. Fiscal emitido no dia
		cRegistro	+=	aFISFill(strzero(val(R61->A61_NUMFIM),6),06)	//09. Numero do ultimo doc. Fiscal emitido no dia
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_VALTOT,13),13)			//10. Somatorio diario das saidas p/doc. fiscais de mesma serie e subserie
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_BSICM,13),13)		//11. Base de Calculo do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_VALICM,12),12)			//12.Valor do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_ISENTA,13),13)		//13.Isenta ou nao tributada
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_OUTRAS,13),13)			//14.Outras
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_ALQICM,04),04)		//15.Aliquota ICMS
		cRegistro	+=	aFISFill(,01)											//16. Brancos
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 == 3
			cRegistro += aFISFill(strzero(val(R61->A61_CODMUN),5),5)					//17. Codigo do Municipio
			cRegistro += aFisFill(R61->A61_OBS,35)						//18. Observacao
			cRegistro += aFisFill(R61->A61_SITUAC,1)						//19. Situacao da nota fiscal
			cRegistro += aFisFill(Strzero(Val(R61->A61_ANOAID),4),4)						//20. Ano AIDF
			cRegistro += aFisFill(Strzero(Val(R61->A61_NUMAID),5),5)
			cRegistro += aFisFill(,08)											//22. Brancos
		EndIf

	Endif	
	A940AGrava(cRegistro)
	R61->(dbSkip())
	IncProc(STR0030) //"Gravando Registro Tipo 61"
EndDo
If MV_PAR15 == 3
	ProcRegua( (cArq61R)->(LastRec()))
	(cArq61R)->(dbGoTop())
	While (cArq61R)->(!eof())
		cRegistro	:=	"61"
		cRegistro	+=	"R"
		cRegistro	+=	aFISFill((cArq61R)->R61_EMISS,06)
		cRegistro	+=	aFISFill((cArq61R)->R61_PRODSV,14)	
		cRegistro	+=	aFISFill(Num2Chr((cArq61R)->R61_QUANT,13,3),13)	
		cRegistro	+=	aFISFill(Num2Chr((cArq61R)->R61_VALOR,16),16)	
		cRegistro	+=	aFISFill(Num2Chr((cArq61R)->R61_BICMS,16),16)	
		cRegistro	+=	aFISFill(Num2Chr((cArq61R)->R61_ALIQ,4),4)		
		cRegistro   +=  aFisFill(,112)
		A940AGrava(cRegistro)
		(cArq61R)->(dbSkip())
		IncProc(STR0072) //"Gravando Registro Tipo 61-Resumo"
	EndDo
EndIf	
Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    Ёa940AReg70╨Autor  ЁAndreia dos Santos  ╨ Data Ё  06/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 70                                     ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function a940AReg70()
Local cRegistro	:= ""

ProcRegua( R70->(LastRec()))
R70->(dbGoTop())
while R70->(!eof())

    If YEAR(dDtFim)<2003
		cRegistro	:=	"70"											//01.Tipo
		cRegistro	+=	aFISFill(Num2Chr(Val(R70->A70_CNPJ),14,0),14)//02.CGC
		cRegistro	+=	aFISFill(R70->A70_IE,14)							//03.Inscricao Estadual
		cRegistro	+=	aFISFill(DTOS(R70->A70_EMISS),8)					//04.Data de emissao
		cRegistro	+=	aFISFill(R70->A70_UF,2)							//05.Unidade da Federacao
		cRegistro	+=	aFISFill(R70->A70_MODELO,2) 							//06.Modelo
		cRegistro	+=	AFISFILL(FisGetSer(R70->A70_SERIE,"70"),01)			//07.Serie
		cRegistro	+=	aFISFill(R70->A70_SUBSER,2)									//08.Sub-serie
		cRegistro	+=	aFISFill(Num2Chr(Val(R70->A70_NFISC),6,0),6)  //09.Numero do documento
		If MV_PAR15 == 3
			cRegistro	+=	aFISFill(Num2Chr(Val(substr(R70->A70_CFOP,1,4)),4,0),4)//10.CFOP	
		Else
			cRegistro	+=	aFISFill(Num2Chr(Val(substr(R70->A70_CFOP,1,3)),3,0),3)//10.CFOP
		EndIf
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_VALTOT,14),14)		//11.Valor total do documento
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_BSICM,14),14)		//12.Base de calculo
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_VALICM,14),14)			//13.Valor do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_ISENTA,14),14)		//14.Isenta ou nao tributada
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_OUTRAS,14),14)		//15.Outras
		cRegistro	+=	aFISFill(R70->A70_CIFFOB,1) // Sempre CIF					  16.CIF ou FOB
		cRegistro	+=	aFISFill(R70->A70_SITUAC,1)	//17.Situacao quanto ao cancelamento
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 == 3
			cRegistro += aFISFill(Strzero(Val(R70->A70_CODMUN),5),5)
			cRegistro += aFISFill(Strzero(Val(R70->A70_ANOAID),4),4)	//19.Ano AIDF
			cRegistro += aFisFill(Strzero(Val(R70->A70_NUMAID),5),5)
			cRegistro += AFISFILL(StrZero(Val(R70->A70CFOPEXT),2),2)
			cRegistro += aFISFill(DTOS(R70->A70_EMISS),8) //22.Data de emissao
			cRegistro += Space(34)							//23.Observacao
		EndIf
	Else
		cRegistro	:=	"70"											//01.Tipo
		cRegistro	+=	aFISFill(Num2Chr(Val(R70->A70_CNPJ),14,0),14)//02.CGC
		cRegistro	+=	aFISFill(R70->A70_IE,14)							//03.Inscricao Estadual
		cRegistro	+=	aFISFill(DTOS(R70->A70_EMISS),8)					//04.Data de emissao
		cRegistro	+=	aFISFill(R70->A70_UF,2)							//05.Unidade da Federacao
		cRegistro	+=	aFISFill(R70->A70_MODELO,2) 							//06.Modelo
		cRegistro	+=	AFISFILL(FisGetSer(R70->A70_SERIE,"70"),01) 					//07.Serie
		cRegistro	+=	aFISFill(R70->A70_SUBSER,2)									//08.Sub-serie
		cRegistro	+=	aFISFill(Num2Chr(Val(R70->A70_NFISC),6,0),6)  //09.Numero do documento
		cRegistro	+=	aFISFill(Num2Chr(Val(substr(R70->A70_CFOP,1,4)),4,0),4)//10.CFOP	
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_VALTOT,13),13)		//11.Valor total do documento
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_BSICM,14),14)		//12.Base de calculo
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_VALICM,14),14)			//13.Valor do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_ISENTA,14),14)		//14.Isenta ou nao tributada
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_OUTRAS,14),14)		//15.Outras
		cRegistro	+=	aFISFill(R70->A70_CIFFOB,1) // Sempre CIF					  16.CIF ou FOB
		cRegistro	+=	aFISFill(R70->A70_SITUAC,1)	//17.Situacao quanto ao cancelamento
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 == 3
			cRegistro += aFISFill(Strzero(Val(R70->A70_CODMUN),5),5)
			cRegistro += aFISFill(Strzero(Val(R70->A70_ANOAID),4),4)	//19.Ano AIDF
			cRegistro += aFisFill(Strzero(Val(R70->A70_NUMAID),5),5)
			cRegistro += AFISFILL(StrZero(Val(R70->A70CFOPEXT),2),2)
			cRegistro += aFISFill(DTOS(R70->A70_EMISS),8) //22.Data de emissao
			cRegistro += Space(34)							//23.Observacao
		EndIf
	Endif	
	A940AGrava(cRegistro)

	R70->(dbSkip())
	IncProc(STR0031) //"Gravando Registro Tipo 70"
End
Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    ЁA940AREG71╨Autor  ЁAndreia dos Santos  ╨ Data Ё  06/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 71                                     ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function a940AReg71()

Local cRegistro	:= ""

ProcRegua( R71->(LastRec()))
R71->(dbGoTop())

While R71->(!eof())

    If YEAR(dDtFim)<2003
		cRegistro	:=	"71"									   					//01.TIPO
		cRegistro	+=	a940Fill(Num2Chr(Val(R71->A71_CGCTOM),14,0),14)//02.CGC
		cRegistro	+=	a940Fill(R71->A71_IETOM,14) 						//03.Inscricao Estadual
		cRegistro	+=	a940Fill(DTOS(R71->A71_DTCONH),8)					//04.Data de emissao do conhecimento
		cRegistro	+=	a940Fill(R71->A71_UFTOM,2)							//05.UF do tomador do servico
		cRegistro	+=	a940Fill(R71->A71_MODCON,2)							//06.Modelo
		cRegistro	+=	a940Fill(R71->A71_SERCON,1)							//07.Serie
		cRegistro	+=	a940Fill(R71->A71_SUBCON,2)							//08.Subserie
		cRegistro	+=	a940Fill(Num2Chr(Val(R71->A71_NUMCON),6,0),6) 	//09.Numero do conhecimento
		cRegistro	+=	a940Fill(R71->A71_UFREM,2) 							//10.UF do remetente/Destinatario
		cRegistro	+=	a940Fill(Num2Chr(Val(R71->A71_CGCREM),14,0),14)//11.CGC do Remetente/Destinatario
		cRegistro	+=	a940Fill(R71->A71_IEREM,14) 						//12.Inscr.Estadual do Remetente/Destinatario
		cRegistro	+=	a940Fill(DTOS(R71->A71_DTNOTA),8)					//13.Data de emissao
		cRegistro	+=	a940Fill(R71->A71_MODNOT,2)	                    	//14.Modelo da NF
		If MV_PAR15 == 3
			cRegistro	+=	a940Fill(R71->A71_SERNOT,3)							//15.Serie da NF	
		ELSE
			cRegistro	+=	a940Fill(R71->A71_SERNOT,2)							//15.Serie da NF
			cRegistro	+=	a940Fill(R71->A71_SUBNOT,2)							//16.Subserie
		EndIf
		cRegistro	+=	a940Fill(Num2Chr(Val(R71->A71_NUMNOT),6,0),6)	//17.Numero da NF
		cRegistro	+=	a940Fill(Num2Chr(R71->A71_VALNOT,14),14) 		//18.Valor total da NF
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 <> 3
			cRegistro += a940Fill(,11)                                				//19.Brancos
		Else
			cRegistro += a940Fill(,70)                                				//19.Brancos
		EndIf
	Else
		cRegistro	:=	"71"									   					//01.TIPO
		cRegistro	+=	a940Fill(Num2Chr(Val(R71->A71_CGCTOM),14,0),14)//02.CGC
		cRegistro	+=	a940Fill(R71->A71_IETOM,14) 						//03.Inscricao Estadual
		cRegistro	+=	a940Fill(DTOS(R71->A71_DTCONH),8)					//04.Data de emissao do conhecimento
		cRegistro	+=	a940Fill(R71->A71_UFTOM,2)							//05.UF do tomador do servico
		cRegistro	+=	a940Fill(R71->A71_MODCON,2)							//06.Modelo
		cRegistro	+=	a940Fill(R71->A71_SERCON,1)							//07.Serie
		cRegistro	+=	a940Fill(R71->A71_SUBCON,2)							//08.Subserie
		cRegistro	+=	a940Fill(Num2Chr(Val(R71->A71_NUMCON),6,0),6) 	//09.Numero do conhecimento
		cRegistro	+=	a940Fill(R71->A71_UFREM,2) 							//10.UF do remetente/Destinatario
		cRegistro	+=	a940Fill(Num2Chr(Val(R71->A71_CGCREM),14,0),14)//11.CGC do Remetente/Destinatario
		cRegistro	+=	a940Fill(R71->A71_IEREM,14) 						//12.Inscr.Estadual do Remetente/Destinatario
		cRegistro	+=	a940Fill(DTOS(R71->A71_DTNOTA),8)					//13.Data de emissao
		cRegistro	+=	a940Fill(R71->A71_MODNOT,2)	                    	//14.Modelo da NF
		cRegistro	+=	a940Fill(R71->A71_SERNOT,3)							//15.Serie da NF	
		cRegistro	+=	a940Fill(Num2Chr(Val(R71->A71_NUMNOT),6,0),6)	//17.Numero da NF
		cRegistro	+=	a940Fill(Num2Chr(R71->A71_VALNOT,14),14) 		//18.Valor total da NF
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 <> 3
			cRegistro += a940Fill(,12)                                				//19.Brancos
		Else
			cRegistro += a940Fill(,70)                                				//19.Brancos
		EndIf

	Endif	
	A940AGrava(cRegistro)

	R71->(dbSkip())
	IncProc(STR0032) //"Gravando Registro Tipo 71"
End	

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    ЁA940AREG74╨Autor  ЁEduardo J Zanardo   ╨ Data Ё  09/08/02   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 74                                     ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function a940AReg74()

Local cRegistro	:= ""

DbSelectArea(cArq074)
ProcRegua( R74->(LastRec()))
R74->(dbGoTop())

while R74->(!eof())

    If YEAR(dDtFim)<2003
		cRegistro	:=	"74"											//01.Tipo
		cRegistro	+= 	aFISFill(R74->A74_DTINVE,8)
		cRegistro	+= 	aFISFill(R74->A74_PROD,14)
		cRegistro	+=	aFISFill(Num2Chr(R74->A74_QUANT,13,3),13)
		cRegistro	+=	aFISFill(Num2Chr(R74->A74_VALOR,13),13)
		cRegistro	+=	aFISFill(R74->A74_POSSE,1)
		cRegistro	+=	aFISFill(R74->A74_CNPJP,14)		
		cRegistro	+=	aFISFill(R74->A74_INSCP,14) 		
		cRegistro	+=	aFISFill(R74->A74_UF,2) 			
		cRegistro 	+=  aFISFill(,103)					
	Else
		cRegistro	:=	"74"											//01.Tipo
		cRegistro	+= 	aFISFill(DTOS(SuperGetMv("MV_ULMES")),8)
		cRegistro	+= 	aFISFill(R74->CODIGO,14)
		cRegistro	+=	aFISFill(Num2Chr(R74->QUANT,13,3),13)
		cRegistro	+=	aFISFill(Num2Chr(R74->CUSTO,13),13)
		cRegistro	+=	AFISFill(IIF(R74->SITUACA=="2","3",IIF(R74->SITUACA=="3","2",R74->SITUACA)),01)
		cRegistro	+=	AFISFill(IIF(R74->SITUACA=="1",REPLI("0",14),ARETDIG(R74->CNPJ,.T.,"  ")),14)
		cRegistro	+=	AFISFill(IIF(R74->SITUACA=="1",SPACE(14),ARETDIG(R74->INSCR,.T.,"  ")),14)
		cRegistro	+=	aFISFill(R74->UF,2) 			
	    cRegistro 	+=  If(mv_par15==3,aFISFill(,103),aFISFill(,45))
	Endif	
	A940AGrava(cRegistro)
	R74->(dbSkip())
	IncProc(STR0076) //"Gravando Registro Tipo 74"
EndDo

Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    ЁA940AREG75╨Autor  ЁAndreia dos Santos  ╨ Data Ё  06/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 75                                     ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function a940AReg75()

Local cRegistro	:= ""

ProcRegua( R75->(LastRec()))
R75->(dbGoTop())
while R75->(!eof())

    If YEAR(dDtFim)<2003
		cRegistro	:=	"75"												//01.Tipo
		cRegistro	+= 	aFISFill(dtos(R75->A75_DTAINI),8)			//02.Data Inicial de Validade
		cRegistro	+= 	aFISFill(dtos(R75->A75_DTAFIM),8)			//03.Data Final de Validade
		cRegistro	+=	aFISFill(Left(R75->A75_PROD,14),14)		//04.Codigo do Produto ou Servico
		cRegistro	+=	aFISFill(Left(R75->A75_CODNCM,08),08)		//05.Codigo NCM
		cRegistro	+=	aFISFill(R75->A75_DESCR,53)					//06.Descricao do Produto
		cRegistro	+=	aFISFill(R75->A75_UM,06)						//07.Unidade de Medida
		cRegistro	+=	aFISFill(R75->A75_SITTRI,3) 					//08.Situacao Tributaria
		cRegistro	+=	aFISFill(Num2Chr(R75->A75_ALQIPI,4),4)	//09. Aliquota do IPI
		cRegistro	+=	aFISFill(Num2Chr(R75->A75_ALQICM,4),4)	//10.Aliquota do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R75->A75_REDBSE,4),4)	//11.% de Reducao do ICMS nas Operacoes Internas
		cRegistro	+=	aFISFill(Num2Chr(R75->A75_BRICMS,12),12)	//12.Base de calculo do ICMS retido
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 == 3
			cRegistro += aFISFill(R75->A75_EAN,14)				//13.Codigo EAN
			cRegistro += aFISFill(R75->A75_CODFIS,07)			//14.Codigo Fisiografico
			cRegistro += aFISFill(,37)									//15.Brancos
		EndIf
	Else 
		cRegistro	:=	"75"										//01.Tipo
		cRegistro	+= 	aFISFill(dtos(R75->A75_DTAINI),8)			//02.Data Inicial de Validade
		cRegistro	+= 	aFISFill(dtos(R75->A75_DTAFIM),8)			//03.Data Final de Validade
		cRegistro	+=	aFISFill(Left(R75->A75_PROD,14),14)		//04.Codigo do Produto ou Servico
		cRegistro	+=	aFISFill(Left(R75->A75_CODNCM,08),08)		//05.Codigo NCM
		cRegistro	+=	aFISFill(R75->A75_DESCR,53)					//06.Descricao do Produto
		cRegistro	+=	aFISFill(R75->A75_UM,06)						//07.Unidade de Medida
        If mv_par15<>3 .And. mv_par15<>2
		   cRegistro	+=	aFISFill(R75->A75_SITTRI,3) 					//08.Situacao Tributaria
		Endif   
        If mv_par15<>3 .And. mv_par15<>2
	  	   cRegistro	+=	aFISFill(Num2Chr(R75->A75_ALQIPI,4),4)	//09. Aliquota do IPI
	  	Else
	  	   cRegistro	+=	aFISFill(Num2Chr(R75->A75_ALQIPI,5),5)	//09. Aliquota do IPI
	  	Endif   
	    cRegistro	+=	aFISFill(Num2Chr(R75->A75_ALQICM,4),4)	//10.Aliquota do ICMS
        If mv_par15<>3 .And. mv_par15<>2
			cRegistro	+=	aFISFill(Num2Chr(R75->A75_REDBSE,4),4)	//11.% de Reducao do ICMS nas Operacoes Internas
		Else
			cRegistro	+=	aFISFill(Num2Chr(R75->A75_REDBSE,5),5)	//11.% de Reducao do ICMS nas Operacoes Internas		
		Endif   
        If mv_par15<>3 .And. mv_par15<>2
			cRegistro	+=	aFISFill(Num2Chr(R75->A75_BRICMS,12),12)	//12.Base de calculo do ICMS retido	
		Else
			cRegistro	+=	aFISFill(Num2Chr(R75->A75_BRICMS,13),13)	//12.Base de calculo do ICMS retido	
		Endif	
		//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//ЁLayOut diferencia para DIC                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
		If MV_PAR15 == 3
			cRegistro += aFISFill(R75->A75_EAN,14)				//13.Codigo EAN
			cRegistro += aFISFill(R75->A75_CODFIS,07)			//14.Codigo Fisiografico
			cRegistro += aFISFill(,37)									//15.Brancos
		EndIf
	Endif	
	A940AGrava(cRegistro)

	R75->(dbSkip())
	IncProc(STR0033) //"Gravando Registro Tipo 75"
End

Return



/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    Ёa940ARg88C╨Autor  ЁAndreia dos Santos  ╨ Data Ё  06/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 88C                                     ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function a940ARg88C()

Local cRegistro
Local cCNPJ	:= ""

DbSelectArea(cArq088C)
dbSetOrder(1)

ProcRegua( (cArq088C)->(LastRec()))
(cArq088C)->(dbGoTop())

While (cArq088C)->(!eof())

	cCNPJ		:= IIf(!empty((cArq088C)->A88CCNPJ),(cArq088C)->A88CCNPJ,Replic("0",14))

	cRegistro	:=	"88C"												//01.Tipo
	cRegistro	+=	aFISFill(Num2Chr(Val(cCNPJ),14,0),14)				//02.CGC
	cRegistro	+=	aFISFill((cArq088C)->A88CMODELO,2)					//03.Codigo do modelo da NF
	cRegistro	+=	aFISFill((cArq088C)->A88CSERIE,3)					//04.Serie da NF
	cRegistro	+=	aFISFill(Num2Chr(Val((cArq088C)->A88CNFISC),6,0),6)//06.Numero da NF
    If YEAR(dDtFim)>2002
	   cRegistro	+=	aFISFill(Num2Chr(Val(substr((cArq088C)->A88CCFOP,1,4)),4,0),3)//07.CFOP
	Else
	   cRegistro	+=	aFISFill(Num2Chr(Val(substr((cArq088C)->A88CCFOP,1,3)),3,0),3)//07.CFOP
	Endif
	cRegistro	+=	aFISFill((cArq088C)->A88CNUMITE,3)	   				//08.Numero do Item
	cRegistro	+=	aFISFill(Left((cArq088C)->A88CPRODUT,14),14)		//09.Codigo do produto ou servico
	cRegistro	+=	aFISFill(Num2Chr((cArq088C)->A88CQUANT,13,3),13)	//10.Quantidade do produto
	cRegistro	+=	aFISFill(Num2Chr((cArq088C)->A88CBASEST,12),12) 	//11.Base de Calculo da ST na origem
	cRegistro	+=	aFISFill(Num2Chr((cArq088C)->A88CVALBSR,12),12)	//12.Valor do ICMS ST a ser repassado a UF destino
	cRegistro	+=	aFISFill(Num2Chr((cArq088C)->A88CVALBSC,12),12)	//13.Valor do ICMS ST a complementar a UF de destino
	cRegistro	+=	SPACE(28)

	A940AGrava(cRegistro)

	(cArq088C)->(dbSkip())
	IncProc("Gravando Registro Tipo 88C")

EndDo	

Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    ЁA940ARG88D╨Autor  ЁAndreia dos Santos  ╨ Data Ё  05/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 88D                                    ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
STATIC FUNCTION A940ARG88D()

Local cRegistro	:=	""
ProcRegua( (cArq088D)->(LastRec()))
(cArq088D)->(dbSetOrder(1))
(cArq088D)->(dbGoTop())

While (cArq088D)->(!EOF())

	cRegistro	:="88D"	
	cRegistro	+=	AFISFILL(Num2Chr(Val((cArq088D)->A88DCNPJ),14,0),14)	//02. CGC
	cRegistro	+=	AFISFILL((cArq088D)->A88DIE,14)							//03. Inscricao Estadual
	cRegistro	+=	AFISFILL((cArq088D)->A88DUF,02)    						//05. Unidade da federacao do Remetente/Destinatario
	cRegistro	+=	AFISFILL((cArq088D)->A88DMODELO,02)		  		 		//06.Codigo do Modelo da Nota fiscal
	cRegistro	+=	AFISFILL((cArq088D)->A88DSERIE,03)						//07. Serie da Nota Fiscal
	cRegistro	+=	AFISFILL(Num2Chr(Val((cArq088D)->A88DNFISC),6,0),6) 	//09.Numero da Nota Fiscal
    If YEAR(dDtFim)>2002
	   cRegistro	+=	aFISFill(Num2Chr(Val(substr((cArq088D)->A88DCFOP,1,4)),4,0),4)//07.CFOP
	Else
	   cRegistro	+=	aFISFill(Num2Chr(Val(substr((cArq088D)->A88DCFOP,1,3)),3,0),3)//07.CFOP
	Endif
	cRegistro	+=	AFISFILL(DTOS((cArq088D)->A88DEMISS),08)				//04. Data de emissao/Recebimento
	cRegistro	+=	AFISFILL(DTOS((cArq088D)->A88DENTSAI),08)				//04. Data de emissao/Recebimento
	cRegistro	+=	SPACE(62)

	A940aGrava(cRegistro)
	(cArq088D)->(dbSkip())	
	IncProc("Gravando Registro Tipo 88D")
End

Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    ЁA940ARG88E╨Autor  ЁAndreia dos Santos  ╨ Data Ё  05/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 88E                                    ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
STATIC FUNCTION A940ARG88E()

Local cRegistro	:=	""
ProcRegua( (cArq088E)->(LastRec()))
(cArq088E)->(dbSetOrder(1))
(cArq088E)->(dbGoTop())

While (cArq088E)->(!EOF())
	cRegistro	:="88E"	
	cRegistro	+=	AFISFILL(Num2Chr(Val((cArq088E)->A88ECNPJ),14,0),14)	//02. CGC
	cRegistro	+=	AFISFILL((cArq088E)->A88EIE,14)							//03. Inscricao Estadual
	cRegistro	+=	AFISFILL((cArq088E)->A88ECOD,14)						//04. Codigo Produto Informante
	cRegistro	+=	AFISFILL((cArq088E)->A88ECODSEF,14)						//03. Codigo Tabela SEF MG
	cRegistro	+=	SPACE(67)
	A940aGrava(cRegistro)
	(cArq088E)->(dbSkip())	
	IncProc("Gravando Registro Tipo 88E")
End

Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    ЁA940ARG88M╨Autor  ЁAndreia dos Santos  ╨ Data Ё  05/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 88M                                    ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
STATIC FUNCTION A940ARG88M()

Local cRegistro	:=	""
ProcRegua( (cArq088M)->(LastRec()))
(cArq088M)->(dbSetOrder(1))
(cArq088M)->(dbGoTop())

While (cArq088M)->(!EOF())
	cRegistro	:="88M"	
	cRegistro	+=	AFISFILL(Num2Chr(Val((cArq088M)->A88MCNPJ),14,0),14)	//02. CGC
	cRegistro	+=	AFISFILL((cArq088M)->A88MMENS,34)						//03. Mensagem
	cRegistro	+=	SPACE(75)
	A940aGrava(cRegistro)
	(cArq088M)->(dbSkip())
	IncProc("Gravando Registro Tipo 88M")
End

Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    ЁA940ARG88Q╨Autor  ЁEdstron E. Correia  ╨ Data Ё  30/05/03   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 88Q                                    ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
STATIC FUNCTION A940ARG88Q()

Local cRegistro	:=	""
ProcRegua( (cArq088Q)->(LastRec()))
(cArq088Q)->(dbSetOrder(1))
(cArq088Q)->(dbGoTop())

While (cArq088Q)->(!EOF())
	cRegistro	:="88Q"
	cRegistro	+=AFISFILL(dtos((cArq088Q)->A88QDATA),8)
	cRegistro	+=AFISFILL((cArq088Q)->A88QPROD,14)
	cRegistro	+=AFISFILL(Num2Chr((cArq088Q)->A88QQUANT,13,3),13)
	cRegistro	+=AFISFILL(Num2Chr((cArq088Q)->A88QTOT,13,3),13)
	cRegistro	+=AFISFILL((cArq088Q)->A88QPOSSE,01)
	cRegistro	+=SPACE(74)
	A940aGrava(cRegistro)
	(cArq088Q)->(dbSkip())
	IncProc("Gravando Registro Tipo 88Q")
End

Return

/*эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммямммммммммммкмммммммямммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    ЁA940ARG8850╨Autor  ЁEduardo Ju         ╨ Data Ё  23/07/03   ╨╠╠
╠╠лммммммммммьмммммммммммймммммммомммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava Registro do Tipo 8850 (Tipo 88 Detalhe 50)           ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ*/
Static Function A940ARG8850()

Local cRegistro	:=	""
ProcRegua( (cArq08850)->(LastRec()))
(cArq08850)->(dbSetOrder(1))
(cArq08850)->(dbGoTop())

While (cArq08850)->(!Eof())
	If mv_par15 == 3 //DIC
		cRegistro	:= "8850"                                                   	//01.Tipo 02.Detalhe
		cRegistro	+=	aFisFill(Num2Chr(Val((cArq08850)->A8850CNPJ),14,0),14)		//03.CGC
		cRegistro	+=  aFisFill(Dtos((cArq08850)->A8850EMISS),8)              	//04.Data de Emissao
		cRegistro	+=	aFisFill((cArq08850)->A8850UF,2)    						//05.Unidade Federativa do Remetente/Destinatario
		cRegistro	+=	aFisFill((cArq08850)->A8850MODEL,2)					    	//06.Codigo do modelo da NF
		cRegistro	+=	aFisFill((cArq08850)->A8850SERIE,3)					    	//07.Serie da NF
		cRegistro	+=	aFisFill(Num2Chr(Val((cArq08850)->A8850NFISC),6,0),6)  	//09.Numero da NF
		cRegistro	+=	aFisFill((cArq08850)->A8850SUFRA,14)                    	//10.Inscricao Suframa	   
		cRegistro   +=	aFisFill((cArq08850)->A8850OBS,35)	                    	//16.Observacao
	    cRegistro   +=	aFisFill((cArq08850)->A8850CONTA,15)                    	//17.Codigo Contabil
	  	cRegistro	+=	Space(81)                                               	//18.Brancos	
		A940AGrava(cRegistro)

		(cArq08850)->(dbSkip())
		IncProc("Gravando Registro Tipo 88/50")
   EndIf
EndDo	
Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    ЁA940AReg88╨Autor  ЁAndreia dos Santos  ╨ Data Ё  06/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Grava registro tipo 88                                     ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940A                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function A940aReg88()

Local lGrava088	:= existBlock("M940GR88")
Local aIC       := {}
Local aST       := {}
Local cContas   := ""
Local nValor    := 0
Local nValor2   := 0
Local nValor3   := 0
Local nEstDebST := 0
Local dInicial	:= CtoD("  /  /  ")
Local dFinal  	:= CtoD("  /  /  ")
Local nX		:= 0                     

Private cRegistro 	:= ""
Private NMES := MONTH(MV_PAR02)
Private NANO := YEAR(MV_PAR02)

If lGrava088
	ProcRegua( (cArq088)->(LastRec()))
	(cArq088)->(dbGotop())
	While (cArq088)->(!eof())

		cRegistro	:=	execBlock("M940GR88")

		a940AGrava( cRegistro )
		(cArq088)->(dbSkip())
		IncProc(STR0034) //"Gravando Registro Tipo 88"
	EndDo
EndIf
//здддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁLayOut diferencia para DIC                          Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддды
If MV_PAR15 == 3  .And. File("DIC.CFP")

	//зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддh©
	//ЁTodos os campos dos registros 8801 e 8802 devem se referir ao mes anterior ao da declaracao.Ё
	//юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддhы

	// Calcula primeiro e ultimo dia do mes anterior ao da declaracao
	dbSelectArea("SM0")
	If Month(MV_PAR01) == 1
		dInicial := CtoD("01/12/" + StrZero(Year(MV_PAR01)-1,4))
		dFinal 	 := CtoD("31/12/" + StrZero(Year(MV_PAR01)-1,4))
	Else
		dInicial := CtoD("01/" + StrZero(Month(MV_PAR01)-1,2) + "/" + StrZero(Year(MV_PAR01),4))
		For nX := 31 to 1 Step -1
	        dFinal := CtoD(StrZero(nX,2) + "/" + StrZero(Month(MV_PAR01)-1,2) + "/" + StrZero(Year(MV_PAR01),4))
			If Month(dFinal) == (Month(MV_PAR01) - 1)
			   Exit
		    Endif
		Next
	Endif
	
	//Registro 8801
	cRegistro  :=	"88"								//01.Tipo
	cRegistro  += 	"01"								//02.Detalhe

	cContas := VerTpDet("901",.F.,"DIC.CFP")
	nValor 	:= SomaContas(cContas,Val(SubStr(Periodo(MV_PAR01-1,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor,13),13)	//03. Saldo da conta caixa no final do mes

	cContas := VerTpDet("902",.F.,"DIC.CFP")
	nValor 	:= SomaContas (cContas,Val(SubStr(Periodo(MV_PAR01-1,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor,13),13)	//04. Saldo da conta bancos no final do mes

	cContas := VerTpDet("903",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(MV_PAR01-1,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor,13),13)	//05. Saldo da conta clientes no final do mes

	cContas := VerTpDet("904",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(MV_PAR01-1,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor,13),13)	//06. Saldo a receber de outras contas no final do mes

	cContas := VerTpDet("905",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(MV_PAR01-1,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor,13),13)	//07. Saldo da conta fornecedor no final do mes

	cContas := VerTpDet("906",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(MV_PAR01-1,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor,13),13)	//08. Saldo a pagar de outras contas no final do mes

	cContas := VerTpDet("907",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(MV_PAR01-1,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor,13),13)	//09. Valor dos emprestimos contraidos a pessoa fisica ate o final do mes

	cContas := VerTpDet("908",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(MV_PAR01-1,1),5,2)),1)
	cRegistro   += aFISFill(Num2Chr(nValor,13),13)	//10. Valor dos emprestimos contraidos a pessoa juridica ate o final do mes

	cRegistro   += Space(76)
	A940AGrava(cRegistro)

	//Registro 8802                                            
	cRegistro  :=	"88"								//01.Tipo
	cRegistro  += 	"02"								//02.Detalhe
	cContas := VerTpDet("909",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(dInicial-1,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor,13),13)	//03. Valor do saldo inicial das contas caixa e bancos no mes
	nValor2:= SomaContas (cContas,Val(SubStr(Periodo(dFinal,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor2-nValor,13),13)	//04. Valor dos recebimentos ocorridos no mes

	cContas := VerTpDet("910",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(dInicial-1,1),5,2)),1)
	nValor2:= SomaContas (cContas,Val(SubStr(Periodo(dFinal,1),5,2)),1)
	nValor3 := nValor2-nValor
	cRegistro  += aFISFill(Num2Chr(Max(nValor2-nValor,0),13),13)	//05. Valor dos emprestimos contraidos a pessoa fisica no mes

	cContas := VerTpDet("911",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(dInicial-1,1),5,2)),1)
	nValor2:= SomaContas (cContas,Val(SubStr(Periodo(dFinal,1),5,2)),1)
	nValor3 += nValor2-nValor
	cRegistro  += aFISFill(Num2Chr(Max(nValor2-nValor,0),13),13)	//06. Valor dos emprestimos contraidos a pessoa juridica no mes
	If nValor3 < 0
		nValor3 := Abs(nValor3)
	Else
		nValor3 := 0
	EndIf
	cRegistro  += aFISFill(Num2Chr(Max(nValor3,0),13),13)	//07. Valor dos pagamentos de emprestimos efetuados no mes

	cContas := VerTpDet("912",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(dInicial-1,1),5,2)),1)
	nValor2:= SomaContas (cContas,Val(SubStr(Periodo(dFinal,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(Max(nValor2-nValor,0),13),13)	//08. Valor de outros pagamentos efetuados no mes
	cRegistro  += Space(102)
	A940AGrava(cRegistro)
	nReg88 := 2
EndIf
If MV_PAR15 == 3
	//Registro 8803	
  	aIC :=  FisApur("IC",val(Substr(DTOS(dDtFim),1,4)),val(Substr(DTOS(dDtFim),5,2)),2,0,"*",.F.,{},1,.F.,"")
	aST :=  FisApur("ST",val(Substr(DTOS(dDtFim),1,4)),val(Substr(DTOS(dDtFim),5,2)),2,0,"*",.F.,{},1,.F.,"")
	aEval(aST, {|x| nEstDebST += Iif(Substr(Alltrim(x[4]),1,6)=="008.00" .and. Substr(Alltrim(x[1]),1,3)=="008",x[3],0)})
    If !Empty(aIC)
		cRegistro := "88"
		cRegistro += "03"
		cRegistro += aFisfill(Num2Chr(0,13,2),13) 			//03.PSDI
		cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="003"}),3],13,2),13) 	//04.Estorno de Credito
		cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="002"}),3],13,2),13)	//05.Outros Debitos
		cRegistro += aFisfill(Num2Chr(0,13,2),13) 			//06.Credito Presumido
		cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="009"}),3],13,2),13)	//07.Saldo Credor do PerМodo Anterior
		cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="006"}),3],13,2),13)	//08.Outros Creditos
		cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="007"}),3],13,2),13)	//09.Estorno de Debitos
		cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="012"}),3],13,2),13)	//10.Deducoes
		cRegistro += aFisfill(Num2Chr(0,13,2),13) 			//11.Credito utilizado do imobilizado
		cRegistro += aFisfill(Num2Chr(0,4,0),4) 			//12.PSDI
		cRegistro += aFisfill(Num2Chr(0,2,0),2) 			//13.PSDI	
		cRegistro += aFisfill(Num2Chr(0,13,2),13) 			//14.Transferencia
		cRegistro += aFisfill(,44) //12.Brancos
		a940AGrava( cRegistro )
		nReg88 += 1   	   		
    Endif
	//Registro AD4	
	(cArqAD4)->(dbGoTop())
	while (cArqAD4)->(!eof())
		cRegistro	:=	"88"
		cRegistro	+= 	"04"
		cRegistro	+= 	aFISFill((cArqAD4)->AD4TIPO,1)
		cRegistro	+=	aFISFill(Num2Chr(Val((cArqAD4)->AD4INSC),10,0),10)
		cRegistro	+=	aFISFill((cArqAD4)->AD4MODELO,2)
		cRegistro	+=	AFISFILL(FisGetSer((cArqAD4)->AD4SERIE),03)
		cRegistro	+=	aFISFill(,2)
		cRegistro	+=  aFISFill(Num2Chr(Val((cArqAD4)->AD4NUMERO),6,0),6)
		cRegistro	+=	aFISFill(DTOS((cArqAD4)->AD4EMISS),08)
		cRegistro	+=	aFISFill(Num2Chr((cArqAD4)->AD4VALOR,13,2),13)
		cRegistro	+=  aFISFill(,135)
		a940AGrava( cRegistro )	
		(cArqAD4)->(dbSkip())
		IncProc(STR0080) //"Gravando Registro Tipo AD44"
		nReg88 += 1   	   				
	EndDo

	//Registro 8805
    If !Empty(aIC)
		cRegistro := "88"
		cRegistro += "05"
		cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="013"}),3],13,2),13) //03.Valor ICMS Normal
		cRegistro += aFisfill(Num2Chr(nVal88St,13,2),13) //04.Valor ICMS Substituto
		cRegistro += aFisfill(Num2Chr(0,13,2),13) //05.Valor ICMS Transporte
		cRegistro += aFisfill(Num2Chr(0,13,2),13) //06.ICMS de Antecipacao
		cRegistro += aFisfill(Num2Chr(0,13,2),13) //07.ICMS s/ Antecipacao
		cRegistro += aFisfill(Num2Chr(0,13,2),13) //08.ICMS MVA
		cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="020"}),3],13,2),13) //09.Diferencial de aliquota ( uso e consumo )
		cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="019"}),3],13,2),13) //10.Diferencial de aliquota	( imobilizado )
		cRegistro += aFisfill(Num2Chr(0,13,2),13) //11.PSDI
		cRegistro += aFisfill(Num2Chr(nEstDebST,13,2),13) //12.Estorno de Debito do ICMS ST Interno
		cRegistro += aFisfill(Num2Chr(0,13,2),13) //13.Fundo Estadual
		cRegistro += aFisfill(,37) //12.Brancos
		a940AGrava( cRegistro )
		nReg88 += 1   	   				
    Endif
	//Registro 8808
    If mv_par21 == 1 .and. MV_PAR15 == 3  .and. Month(dDtFim) == 1
	   cRegistro := "88"
	   cRegistro += "08"
       cRegistro += aFisfill(Num2Chr(nValMPI,13,2),13) //03.Valor de Estoque Materia Prima Inicial Tributada
	   cRegistro += aFisfill(Num2Chr(nValMPF,13,2),13) //04.Valor de Estoque Materia Prima Final Tributada
	   cRegistro += aFisfill(Num2Chr(nValPAI,13,2),13) //05.Valor de Estoque Produto Acabado Inicial Tributada
	   cRegistro += aFisfill(Num2Chr(nValPAF,13,2),13) //06.Valor de Estoque Produto Acabado Final Tributada
	   cRegistro += aFisfill(Num2Chr(nValISI,13,2),13) //07.Valor Isento Inicial
	   cRegistro += aFisfill(Num2Chr(nValISF,13,2),13) //08.Valor Isento Final
	   cRegistro += aFisfill(Num2Chr(nValANI,13,2),13) //09.Valor ST com encerramento de fase inicial
	   cRegistro += aFisfill(Num2Chr(nValANF,13,2),13) //10.Valor ST com encerramento de fase final
	   cRegistro += aFisfill(Num2Chr(0.00,13,2),13) //11.Valor dos produtos em Processo Inicial
	   cRegistro += aFisfill(Num2Chr(0.00,13,2),13) //12.Valor dos produtos em Processo Final
	   cRegistro += aFisfill(,50) //12.Brancos
   	   a940AGrava(cRegistro)
   	   IncProc(STR0082) //"Gravando Registro Tipo 88 detalhe 08 "
   	   nReg88 += 1   	   
    Endif	
	//Registro D10	
	(cArqD10)->(dbGoTop())
	while (cArqD10)->(!eof())
		cRegistro	:=	"88"
		cRegistro	+= 	"10"
		cRegistro	+= 	aFISFill((cArqD10)->D10CNPJ,14)
		cRegistro	+=	aFISFill((cArqD10)->D10MODDES,2)
		cRegistro	+=	aFISFill((cArqD10)->D10SERDES,3)
		cRegistro	+=	aFISFill(,2)
		cRegistro	+=	aFISFill((cArqD10)->D10NUMDES,6)
		cRegistro	+=  aFISFill((cArqD10)->D10CFOP,4)
		cRegistro	+=	aFISFill((cArqD10)->D10IT_DES,3)
		cRegistro	+=	aFISFill((cArqD10)->D10INSCIN,14)    		
		cRegistro	+=	aFISFill((cArqD10)->D10UFINC,2)
		cRegistro	+=	aFISFill((cArqD10)->D10MODINC,2)    		
		cRegistro	+=	aFISFill((cArqD10)->D10SERINC,3)
		cRegistro	+=	aFISFill((cArqD10)->D10SBSRIN,2)
		cRegistro	+=	aFISFill((cArqD10)->D10NUMINC,6)
		cRegistro	+=	aFISFill((cArqD10)->D10EMIINC,8)
		cRegistro	+=	aFISFill((cArqD10)->D10QUANT,5)
		cRegistro	+=	aFISFill(Num2Chr((cArqD10)->D10VALOR,13,2),13)
		cRegistro	+=  aFISFill(,91)
		a940AGrava( cRegistro )	
		(cArqD10)->(dbSkip())
		IncProc(STR0081) //  	  #define STR0081 "Gravando Registro Tipo 88 Detalhe 10"
		nReg88 += 1   	   				
	EndDo
EndIf
Return


/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    Ёa940AREG90╨Autor  ЁAndreia dos Santos  ╨ Data Ё  06/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё                                                            ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё AP5                                                        ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function a940AREG90()

Local 	cRegistro   :=	""
Private lGravou		:=	.F.

nReg50	:=	R50->(LastRec())
nReg51	:=	R51->(LastRec())
nReg53	:=	R53->(LastRec())
nReg54	:=	R54->(LastRec())
nReg55	:=	R55->(LastRec())
nReg61	:=	R61->(LastRec())
nReg60	:=	A60->(LastRec())
nReg60	+=	M60->(LastRec())
nReg70	:=	R70->(LastRec())
nReg71	:=	R71->(LastRec())
nReg75	:=	R75->(LastRec())
If mv_par20==1
	nReg88	:=	(cArq088C)->(LastRec())
	nReg88	+=	(cArq088D)->(LastRec())
	nReg88	+=	(cArq088E)->(LastRec())
	nReg88	+=	(cArq088M)->(LastRec())
	nReg88	+=	(cArq088Q)->(LastRec())
Endif
nReg90	:=	1            	
If Mv_par15 == 3
	nReg60	+=	R60->(LastRec())
	nReg61	+=	(cArq61R)->(LastRec())
	nReg74	:=	R74->(LastRec())
	nReg88	+=	(cArqD10)->(LastRec())
	nReg88	+=	(cArqAD4)->(LastRec())  
	nReg88   += (cArq08850)->(LastRec())
Endif	
if lcArq088
	if File(cArq088)
		nReg88	+=	(cArq088)->(LastRec())
	Endif
Endif
cRegistro	:=	"90"												//01.Tipo
cRegistro	+=	aFISFill(Num2Chr(Val(SM0->M0_CGC),14,0),14)   //02.CGC
cRegistro	+=	aFISFill(ARETDIG(SM0->M0_INSC,.t.,SM0->M0_ESTENT),14) //03.Inscr. Estadual

If nReg50>0
	// 58
	cRegistro	+=	"50"
	cRegistro	+=	aFISFill(StrZero(nReg50,8),8)	// Total de Registros "50"
Endif

If nReg51>0
	// 68
	cRegistro	+=	"51"
	cRegistro	+=	aFISFill(StrZero(nReg51,8),8)	// Total de Registros "51"
Endif

If nReg53>0
	// 78
	cRegistro	+=	"53"
	cRegistro	+=	aFISFill(StrZero(nReg53,8),8)	// Total de Registros "53"
Endif

If nReg54>0
	//	88
	cRegistro	+=	"54"
	cRegistro	+=	aFISFill(StrZero(nReg54,8),8)	// Total de Registros "54"
Endif

If nReg55>0
	// 98
	cRegistro	+=	"55"
	cRegistro	+=	aFISFill(StrZero(nReg55,8),8)	// Total de Registros "55"
Endif

If nReg60>0
	//	108
	cRegistro	+=	"60"
	cRegistro	+=	aFISFill(StrZero(nReg60,8),8)	// Total de Registros "60"
Endif

If nReg61>0
	cRegistro	+=	"61"
	cRegistro	+=	aFISFill(StrZero(nReg61,8),8)	// Total de Registros "61"
Endif

If nReg70>0
	//	118
	cRegistro	+=	"70"
	cRegistro	+=	aFISFill(StrZero(nReg70,8),8)	// Total de Registros "70"
Endif

// Imprime Reg. Tipo 90
If Len(cRegistro)>=110
	A940AIncReg90(@cRegistro,@nReg90,(nReg71+nReg74+nReg75+nReg88))
Endif

If nReg71>0
	cRegistro	+=	"71"
	cRegistro	+=	aFISFill(StrZero(nReg71,8),8)	// Total de Registros "71"
Endif

// Imprime Reg. Tipo 90
If Len(cRegistro)>=110.And.!lGravou
	A940AIncReg90(@cRegistro,@nReg90,(nReg74+nReg75+nReg88))
Endif

If nReg74>0
	cRegistro	+=	"74"
	cRegistro	+=	aFISFill(StrZero(nReg74,8),8)	// Total de Registros "74"
Endif
// Imprime Reg. Tipo 90
If (Len(cRegistro)>=110.And.!lGravou).Or.!lGravou
	A940AIncReg90(@cRegistro,@nReg90,nReg75+nReg88)
Endif
If nReg75>0
	cRegistro	+=	"75"
	cRegistro	+=	aFISFill(StrZero(nReg75,8),8)	// Total de Registros "75"
Endif
// Imprime Reg. Tipo 90
If (Len(cRegistro)>=110.And.!lGravou).Or.!lGravou
	A940AIncReg90(@cRegistro,@nReg90,nReg88)
Endif

If nReg88>0
	cRegistro	+=	"88"
	cRegistro	+=	aFISFill(StrZero(nReg88,8),8)	// Total de Registros "88"
Endif
// Imprime Reg. Tipo 90
If (Len(cRegistro)>=110.And.!lGravou).Or.!lGravou
	A940AIncReg90(@cRegistro,@nReg90,0)
Endif

Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠имммммммямммммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao ЁA940AIncReg90╨Autor  ЁAndreia dos Santos  ╨ Data Ё  06/04/01   ╨╠╠
╠╠лмммммммьмммммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.  Ё Grava registros tipo 90                                       ╨╠╠
╠╠╨       Ё                                                               ╨╠╠
╠╠лмммммммьммммммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso    Ё MATA940A                                                      ╨╠╠
╠╠хмммммммоммммммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function A940AIncReg90(cRegistro,nReg90,nResto)

If nResto<=0.And.(125-Len(cRegistro))>8
	// Nao possui mais registros a imprimir
	lGravou	:=	.T.
	cRegistro	+=	"99"
	If MV_PAR15 <> 3
		If mv_par20==1
			cRegistro	+=	AFISFill(StrZero(2+nReg90+nReg50+nReg51+nReg53+nReg54+nReg55+nReg60+nReg61+nReg70+nReg71+nReg75+nReg88,8),8)
		Else
			cRegistro	+=	AFISFill(StrZero(2+nReg90+nReg50+nReg51+nReg53+nReg54+nReg55+nReg60+nReg61+nReg70+nReg71+nReg75,8),8)
		Endif	
		cRegistro	+=	aFISFill(,(125-Len(cRegistro)))	// Brancos ate registro final	
		cRegistro	+=	Alltrim(Str(nReg90)) 				// Nro registro tipo 90	
	Else
		cRegistro	+=	AFISFill(StrZero(1+nReg90+nReg50+nReg51+nReg53+nReg54+nReg55+nReg60+nReg61+nReg70+nReg71+nReg74+nReg75+nReg88,8),8)
		cRegistro	+=	aFISFill(,(125-Len(cRegistro)))	// Brancos ate registro final	
		cRegistro	+=	Alltrim(Str(nReg90)) 				// Nro registro tipo 90		
		cRegistro += Space(58)
	EndIf
	A940AGrava(cRegistro)				 				// Grava reg. tipo 90
Endif

If (125-Len(cRegistro))<=16	// Verifica se imprime mais um registro
	If !lGravou
		nReg90++				// Incrementa reg. tipo 90
		cRegistro	+=	space(125-Len(cRegistro))
		cRegistro	+=	Alltrim(Str(nReg90))				// Nro registro tipo 90
		If MV_PAR15 == 3
			cRegistro += Space(58)
		EndIf
		A940AGrava(cRegistro)								// Grava reg. tipo 90
		If nResto<=0.And.(125-Len(cRegistro))<9
			// Nao possui mais registros a imprimir
			lGravou:=.T.
			cRegistro	:=	"90"	// Reinicializa segundo registro 90
			cRegistro	+=	aFISFill(Num2Chr(Val(SM0->M0_CGC),14,0),14)
			cRegistro	+=	aFISFill(ARETDIG(SM0->M0_INSC,.T.,SM0->M0_ESTENT),14)
			cRegistro	+=	"99"
			cRegistro	+=	AFISFill(StrZero(2+nReg90+nReg50+nReg51+nReg53+nReg54+nReg55+nReg60+nReg61+nReg70+nReg71+(If(mv_par15==3,nReg74,0))+nReg75,8),8)
			cRegistro	+=	aFISFill(,(125-Len(cRegistro)))	// Brancos ate registro final
			cRegistro	+=	Alltrim(Str(nReg90))  				// Nro registro tipo 90
			If MV_PAR15 == 3
				cRegistro += Space(58)
			EndIf
			A940AGRAVA(cRegistro)								// Grava reg. tipo 90
		Else
			cRegistro	:=	"90"	// Reinicializa segundo registro 90
			cRegistro	+=	aFISFill(Num2Chr(Val(SM0->M0_CGC),14,0),14)
			cRegistro	+=	aFISFill(ARETDIG(SM0->M0_INSC,.T.,SM0->M0_ESTENT),14)
		Endif
	Endif
Endif

Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao    Ёa940AGrava╨Autor  ЁAndreia dos Santos  ╨ Data Ё  09/04/01   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     ЁGrava Registro no arquivo texto e acrescenta marca de final ╨╠╠
╠╠╨          Ёde registro                                                 ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё MATA940a                                                   ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function a940AGrava(cConteudo)

cConteudo += Chr(13)+Chr(10)

//verificar numero do disco
nRegN0++
If (nRegN0 == nNumReg)
	nDisco++
	A940AAvlDrv(@nHandle,Len(cConteudo),nDisco)
	nRegN0 := 0
EndIf

If !lEnd
	FWrite(nHandle,cConteudo,Len(cConteudo))
Endif

Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠имммммммммямммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao   ЁA940aAVLDRV╨Autor  ЁAndreia dos Santos  ╨ Data Ё  17/04/01   ╨╠╠
╠╠лмммммммммьмммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.    Ё                                                             ╨╠╠
╠╠╨         Ё                                                             ╨╠╠
╠╠лмммммммммьммммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso      Ё AP5                                                         ╨╠╠
╠╠хмммммммммоммммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function A940aAvlDrv(nHandle,nBytes,nAtual)

Local 	nDisco	:=	0
Local 	nHdlCtl	:=	0
Local 	oDlg
Local 	cPath	:=	""
Local 	cFile
Local	nHdlChk	:=	0
Local	cArqChk	:=	"MATA940.CHK"
Local 	cTitulo	:=	STR0035 //"Numero Discos"
Local 	cMens1	:=	STR0036 + StrZero(nAtual,2)  //"Insira o disco numero : "
Local 	aCA		:=	{STR0001,STR0002} //###"Confirma",###"Abandona"
Local  	nOpcA	:=	2
Local	nOpcB	:=	2
Local 	aSays	:=	{}
Local aButtons	:=	{}
Local cCadastro	:=	""

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Fecha Arquivo Aberto Anteriormente                           Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
If nHandle >= 0
	FClose(nHandle)
Endif
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Mostra o Disco Atual                                         Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды

AADD(aSays,OemToAnsi( cMens1 ) )
AADD(aButtons, { 1,.T.,{|o| nOpca:= 1,o:oWnd:End()}} )
FormBatch( cTitulo, aSays, aButtons )

If !(nOpcA==1)
	lEnd:=.T.
	Break
Endif

While (nOpcA==1) .And. (nOpcB==2)
	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Define disco a ser gravado                                   Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	__cDest := Nil
	If !Empty(cDisco)
		nDisco	:=	Asc(cDisco)-Asc("A")+1
		cPath	:=	cDisco+":\"
	Else
		cPath:=""
	Endif

	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Verifica se drive ┌ avaliavel                                Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	IF Subs(cDisco,1,1)$"AB"
		cArqChk	:=	cPath+cArqChk
		nHdlChk	:=	MsFCreate(cArqChk)
		If nHdlChk < 0
			nOpcB	:=	Aviso(STR0037,STR0038,{STR0002,STR0001}) //###"Abandona",###"Continua" //"Drive"###"Drive n└o est═ dispon║vel."
			If nOpcB==2
				Loop
			Else
				lEnd := .T. ; Break
			Endif
		Else
			FClose(nHdlChk) ; Ferase(cArqChk)
		EndIf
		//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//Ё Verifica espaco no disco                                     Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
		If DiskSpace(nDisco)<nBytes
			cMsg := STR0039 //"N└o h═ espa┤o no disco para grava┤└o;"
			cMsg += STR0040 //" Troque disquete para continuar..."
			nHdlChk := -1
			nOpcB:=Aviso("Drive",cMsg,{STR0002,STR0001}) //###"Abandonar",###"Continuar"
			If nOpcB==2
				Loop
			Else
				lEnd := .T. ; Break
			Endif
		Endif
		cFile	:=cPath+cArqTxt+".T"+Strzero(nAtual,2)
	Else
		cFile   :=CriaTrab(,.f.)
		__cTrbName := cFile
		__cDest := cPath+cArqTxt+".T"+Strzero(nAtual,2)
	Endif
	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Cria arquivo                                                 Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	nHandle	:=MsFCreate(cFile)
	If nHandle < 0
		nOpcB	:=	Aviso("Drive","Drive n└o est═ pronto.",{"Abandona","Continua"})
		If nOpcB==2
			Loop
		Else
			lEnd := .T. ; Break
		Endif
	EndIf
	Exit
EndDo

Return
/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбддддддддддддбдддддддбдддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁFun┤┘o    Ёa940aRelat  Ё Autor Ё Andreia dos Santos  Ё Data Ё 26/04/01 Ё╠╠
╠╠цддддддддддеддддддддддддадддддддадддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o ЁImprime relatorio de conferencia                            Ё╠╠
╠╠юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
STATIC FUNCTION a940ARelat()
Local cTela:=""

Titulo	:=	STR0041 //"Listagem de acompanhamento"
cDesc1	:=	STR0042 //"Listagem de acompanhamento do arquivo pr┌-formatado."
cDesc2	:=	""
cDesc3	:=	""
Tamanho	:=	"P"
Limite	:=	80
nTipo	:=	18
cabec1	:=	''
cabec2	:=	''
cabec3	:=	''
cbCont	:=	0
cbtxt	:=	Space(10)
m_pag	:=	1
cPerg   :=	"MTA94A"
cString :=	"SF3"
lEnd	:=	.f.
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Verifica as perguntas selecionadas                           Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
pergunte(cperg,.F.)
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Envia controle para a funcao SETPRINT                        Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
nLastKey:=0

wnrel	:=	SetPrint(cString,wnrel,cPerg,Titulo,cDesc1,cDesc2,cDesc3,.F.,"",.F.)
If nLastKey==27
	Return
Endif
SetDefault(aReturn,cString)
If nLastKey==27
	Return
Endif

RptStatus({|lEnd| U_A940AImpr(@lEnd,wnRel,cString,Tamanho)},titulo)

Return
/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбдддддддддддддбддддддбдддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁFun┤┘o    Ёa940AImpr    ЁAutor Ё Andreia dos Santos  Ё Data Ё 26/04/01 Ё╠╠
╠╠цддддддддддедддддддддддддаддддддадддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o ЁChamada para impressao da listagem                          Ё╠╠
╠╠юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
User FUNCTION a940AImpr(lEnd,wnRel,cString,Tamanho)

Local nLin
Local nTotReg

cabec(titulo,cabec1,cabec2,nomeprog,tamanho,nTipo)
nLin	:=	Prow()+1
@ nLin,00 PSAY Replic("*",80)
nLin	+=2
@ ++nLin,15 PSAY STR0043+Transform(SM0->M0_CGC,"@R 99.999.999/9999-99") //"C.G.C.(MF)........: "
@ ++nLin,15 PSAY STR0044+SM0->M0_INSC //"Inscricao Estadual: "
@ ++nLin,15 PSAY STR0045+SM0->M0_NOMECOM //"Razao Social......: "
@ ++nLin,15 PSAY STR0046+SM0->M0_ENDENT //"Endereco..........: "
@ ++nLin,15 PSAY "                    "+SM0->M0_CIDENT+" - "+SM0->M0_ESTENT+" - CEP: "+Transform(SM0->M0_CEPENT,"@R 99999-999")
nLin	+=2
@++nLin,15 PSAY STR0047+cEquip //"Equipamento.......: "
@++nLin,15 PSAY STR0048+IIf(nMeioMag<=4,"Disquete","Fita") //"Meio Magnetico....: "
@++nLin,15 PSAY STR0049+cFatBloc //"Fator de Bloco....: "
nLin	+=2
@ ++nLin,15 PSAY STR0050+DTOC(dDtIni)+" a "+DTOC(dDtFim) //"Periodo abrangido.: "
nLin++
@ ++nLin,15 PSAY STR0051+Str(1,8)	   +STR0052 //"Tipo 10...........: "###" Registro"
@ ++nLin,15 PSAY STR0053+Str(1,8)	   +STR0052 //"Tipo 11...........: "###" Registro"

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Imprime somente itens existentes no arq. magnetico           Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
If nReg50>0
	@ ++nLin,15 PSAY STR0054+Str(nReg50,8)	+STR0055 //"Tipo 50...........: "###" Registro(s)"
Endif
If nReg51>0
	@ ++nLin,15 PSAY STR0056+Str(nReg51,8)	+STR0055 //"Tipo 51...........: "###" Registro(s)"
Endif
If nReg53>0
	@ ++nLin,15 PSAY STR0057+Str(nReg53,8)	+STR0055 //"Tipo 53...........: "###" Registro(s)"
Endif
If nReg54>0
	@ ++nLin,15 PSAY STR0058+Str(nReg54,8)	+STR0055 //"Tipo 54...........: "###" Registro(s)"
Endif
If nReg55>0
	@ ++nLin,15 PSAY STR0059+Str(nReg55,8)	+STR0055 //"Tipo 55...........: "###" Registro(s)"
Endif
If nReg60>0
	@ ++nLin,15 PSAY STR0060+Str(nReg60,8) +STR0055 //"Tipo 60...........: "###" Registro(s)"
Endif
If nReg61>0
	@ ++nLin,15 PSAY STR0061+Str(nReg61,8)	+STR0055 //"Tipo 61...........: "###" Registro(s)"
Endif
If nReg70>0
	@ ++nLin,15 PSAY STR0062+Str(nReg70,8)	+STR0055 //"Tipo 70...........: "###" Registro(s)"
Endif
If nReg71>0
	@ ++nLin,15 PSAY STR0063+Str(nReg71,8)	+STR0055 //"Tipo 71...........: "###" Registro(s)"
Endif
If Mv_par15 == 3
	If nReg74>0
		@ ++nLin,15 PSAY STR0077+Str(nReg74,8)	+STR0055 //"Tipo 74...........: "###" Registro(s)"
	Endif
EndIf	
If nReg75>0
	@ ++nLin,15 PSAY STR0064+Str(nReg75,8)	+STR0055 //"Tipo 75...........: "###" Registro(s)"
Endif
If nReg88>0
	@ ++nLin,15 PSAY STR0065+Str(nReg88,8)	+STR0055 //"Tipo 88...........: "###" Registro(s)"
Endif
If mv_par20==1
	If nReg88C>0
		@ ++nLin,15 PSAY "Tipo 88C..........: "+Str(nReg88C,8)	+" Registro(s)"
	Endif
	If nReg88D>0
		@ ++nLin,15 PSAY "Tipo 88D..........: "+Str(nReg88D,8)	+" Registro(s)"
	Endif
	If nReg88E>0
		@ ++nLin,15 PSAY "Tipo 88E..........: "+Str(nReg88E,8)	+" Registro(s)"
	Endif
	If nReg88M>0
		@ ++nLin,15 PSAY "Tipo 88M..........: "+Str(nReg88M,8)	+" Registro(s)"
	Endif
	If nReg88Q>0
		@ ++nLin,15 PSAY "Tipo 88Q..........: "+Str(nReg88Q,8)	+" Registro(s)"
	Endif
Endif
@ ++nLin,15 PSAY STR0066+Str(nReg90,8)	   +STR0067 //"Tipo 90...........: "###" Registros"
nLin++
If mv_par20==1
	nTotReg	:=	2+nReg90+nReg50+nReg51+nReg53+nReg54+nReg55+nReg60+nReg61+nReg70+nReg71+nReg75+nReg88+nReg88C+nReg88D+nReg88E+nReg88M+nReg88Q
Else
	nTotReg	:=	2+nReg90+nReg50+nReg51+nReg53+nReg54+nReg55+nReg60+nReg61+nReg70+nReg71+nReg75+nReg88
Endif
@ ++nLin,15 PSAY STR0068+Str(nTotReg)+STR0067 //"Total de registros: "###" Registros"
nLin++

If nTotReg>0
	roda(cbcont,cbtxt,tamanho)
Endif

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Spool de Impressao                                           Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Set Printer to
If aReturn[5] == 1
	dbcommitAll()
	ourspool(wnrel)
Endif

MS_FLUSH()
Return

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠имммммммммямммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Funcao   ЁA940DelArq ╨Autor  Ё Nereu Humberto Jr. ╨ Data Ё  02/01/03   ╨╠╠
╠╠лмммммммммьмммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.    Ё Apaga arquivos temporarios criados para gerar o arquivo     ╨╠╠
╠╠╨         Ё Magnetico                                                   ╨╠╠
╠╠лмммммммммьммммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso      Ё MATA940                                                     ╨╠╠
╠╠хмммммммммоммммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
User Function a940ADelArq(aDelArqs)
Local aAreaDel := GetArea()
Local nI := 0

For nI:= 1 To Len(aDelArqs)
	If File(aDelArqs[ni,1]+".DBF")
		dbSelectArea(aDelArqs[ni,2])
		dbCloseArea()
		Ferase(aDelArqs[ni,1]+".DBF")
		Ferase(aDelArqs[ni,1]+OrdBagExt())
	Endif	
Next

RestArea(aAreaDel)

Return
/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбдддддддддддбдддддддбддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁFun┤└o	 Ё SomaContasЁ Autor ЁGustavo G. Rueda      Ё Data Ё 16.08.04 Ё╠╠
╠╠цддддддддддедддддддддддадддддддаддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤└o Ё Soma os saldos de um grupo aleatorio de contas. Esta funcaoЁ╠╠
╠╠Ё          Ё  foi duplicada com o objetivo de liberar para o usuario a  Ё╠╠
╠╠Ё          Ё  indicacao no .CFP das contas Sinteticas.                  Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁSintaxe	 Ё SomaContas( ExpC1 , ExpN1 , ExpN2 ) 						  Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁParametrosЁ Contas , Mes , Moeda 									  Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё Uso		 Ё Para uso na planilha. Obs:sem macro e so' com vars locais !Ё╠╠
╠╠Ё Atencao  Ё Esta funcao faz chamadas a funcao SomaSaldo()			  Ё╠╠
╠╠юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
/*/
Static Function SomaContas ( cContas , nMes , nMoeda )
	Local nLop	  := 0	 // Variavel para uso no laco que varre cContas e arrays
	Local aDeAte  := {}	 // Armazenara' os grupos de contas "De/Ate'"
	Local aContas := {}	 // Armazenara' as contas indiviuais
	Local cTempor := ""   // Variavel auxiliar, transitoria e temporaria
	Local nVolta  := 0	 // Variavel auxiliar de retorno da funcao
	//зддддддддддддддддддддддддддддддддддддддддд©
	//Ё Verifica passagem correta de parametros Ё
	//юддддддддддддддддддддддддддддддддддддддддды
	If ValType( cContas )	# "C"
		// Avaliar se devemos criar um help para esta consistencia
		Return( 0 )
	Endif
	//
	If ValType( nMes ) # "N"
		nMes := Month( dDataBase )
	Endif
	//
	If ValType( nMoeda ) # "N"
		nMoeda := 1
	Endif
	//зддддддддддддддддддддддддддддддддддддддддд©
	//Ё Analisa a String que contem as contas   Ё
	//юддддддддддддддддддддддддддддддддддддддддды
	cContas := AllTrim( cContas )
	cTempor := ""
	For nLop := 1 to Len( cContas )
		 cChar := Subst( cContas, nLop , 1)
		 //зддддддддддддддддддддддддддддддддддддддддддддд©
		 //Ё Verifica a presenca de caracteres invalidos Ё
		 //юддддддддддддддддддддддддддддддддддддддддддддды
		 If !cChar $ "0123456789,:"
			 // Avaliar se devemos criar um help para esta consistencia
			 Loop
		 Endif
		 //здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		 //Ё Se encontrar o separador simples, faz a carga dos arrays	 Ё
		 //юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
		 If CChar == ","
			 If ":" $ cTempor
				 Aadd( aDeAte , cTempor)
			 Else
				 If !Empty( cTempor )
					 Aadd( aContas , cTempor )
				 Endif
			 Endif
			 cTempor := ""
		 Else
			 cTempor += cChar
		 Endif
	Next nLop
	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Verifica o fim, pois nao precisa haver "," no final !      Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	If !Empty( cTempor )
		If ":" $ cTempor
			 Aadd( aDeAte , cTempor)
		Else
			 Aadd( aContas , cTempor )
		Endif
	Endif
	//зддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Verifica se houve identificacao de contas Ё
	//юддддддддддддддддддддддддддддддддддддддддддды
	If Len( aDeAte ) == 0 .and. Len( aContas ) == 0
		Return( 0 )
	Endif
	//здддддддддддддддддддддддддддддддддд©
	//Ё Laco das contas "De / Ate"       Ё
	//юдддддддддддддддддддддддддддддддддды
	For nLop := 1 to Len( aDeAte )
		// Conta inicial
		cTempor := Subst( aDeAte[nLop], 1, At(":",aDeAte[nLop]) -1 )
		// Conta Final
		cChar   := Subst( aDeAte[nLop], At(":",aDeAte[nLop]) + 1 , Len(aDeAte[nLop] ) )
		//
		nVolta += Somasaldo	( cTempor , cChar , nMes , nMoeda )	
	Next nLop	
	//здддддддддддддддддддддддддддд©
	//Ё Laco das contas isoladas   Ё
	//юдддддддддддддддддддддддддддды
	For nLop := 1 to Len( aContas )
		 nVolta += SomaSaldo ( aContas[nLop] , aContas[nLop] , nMes , nMoeda )
	Next Lop
Return nVolta
/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁFun┤└o	 Ё SomaSaldoЁ Autor ЁGustavo G. Rueda	    Ё Data Ё 03.02.93 Ё╠╠
╠╠цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤└o Ё Soma os saldos de um intervalo de conta. Esta funcao       Ё╠╠
╠╠Ё          Ё  foi duplicada com o objetivo de liberar para o usuario a  Ё╠╠
╠╠Ё          Ё  indicacao no .CFP das contas Sinteticas.                  Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁSintaxe	 Ё SomaSaldo( ExpC1 , ExpC2 , ExpN1 , ExpN2 )				  Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁParametrosЁ Conta de , Conta Ate , Mes , Moeda						  Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё Uso		 Ё Generico 												  Ё╠╠
╠╠Ё Atencao  Ё Esta funcao tembem e' chamada pela funcao SomaContas acima Ё╠╠
╠╠Ё			 Ё . Caso ocorram alteracoes nesta funcao, verificar passagem Ё╠╠
╠╠Ё			 Ё e tratamento das alteracoes na funcao SomaContas.		  Ё╠╠
╠╠юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
/*/
Static Function SomaSaldo ( cContaDe , cContaAte , nMes , nMoeda )
	Local nSaldo := 0
	Local dData  
	Private cMes	
	// здддддддддддддддддддддддддддддддддддддддддддддддд©
	// Ё Verifica qual e'o periodo de acordo com m┬s    Ё
	// юдддддддддддддддддддддддддддддддддддддддддддддддды
	If nMes <= 12
		dData := Ctod("01/"+StrZero(nMes,2)+"/"+StrZero(Year(dDataBase),4),"ddmmyy")
		If ! DataMoeda(nMoeda, @cMes, dData)
			Return 0
		End
		nMes := Int(Val(cMes))		// atualiza cMes de acordo com periodo
	EndIf
	//
	cContaDe :=Trim ( cContaDe  ) + Space ( 20 - Len ( Trim ( cContaDe ) ) )
	cContaAte:=Trim ( cContaAte ) + Space ( 20 - Len ( Trim ( cContaAte) ) )
	//	
	nMoeda := IIF( nMoeda = NIL, 1 , nMoeda )
	//
	IF nMoeda = 1
		dbSelectArea ( "SI1" )
		dbSeek ( cFilial + cContaDe , .T. )
	Else
		dbSelectArea ( "SI7" )
		dbSeek ( cFilial + cContaDe + Str ( nMoeda , 1 ) , .T. )
	End
	//
	Do While !Eof()
		IF nMoeda == 1
			IF cFilial != I1_FILIAL .or. I1_CODIGO > cContaAte
				Exit
			End
		ElseIf cFilial != I7_FILIAL .or.I7_CODIGO > cContaAte
			Exit
		End
		//
		IF nMoeda != 1
			SI1 -> ( dbSeek ( cFilial + SI7->I7_CODIGO ) )
		End
		//
		IF nMoeda > 1
			If SI7->I7_MOEDA != Str ( nMoeda , 1 )
				dbSkip()
				Loop
			End
		End
		//
		nSaldo += CalcSaldo ( nMes , nMoeda )
		//
		dbSkip ( )	
	End	
Return nSaldo

/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁFuncao    ЁAjustaSX1 Ё Autor ЁMary C. Hergert        Ё Data Ё13/09/2004Ё╠╠
╠╠цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o ЁAcerta o arquivo de perguntas                               Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁRetorno   ЁNenhum                                                      Ё╠╠
╠╠юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
/*/

STATIC FUNCTION AjustaSx1()

Local aArea	    := GetArea() 
Local aHelpPor	:= {}
Local aHelpEng	:= {}
Local aHelpSpa	:= {}

Aadd( aHelpPor, "Informe a natureza das operacoes        " )
Aadd( aHelpPor, "apresentadas no arquivo magnetico.		 " )
Aadd( aHelpPor, "										 " )

Aadd( aHelpEng, "                                        " )
Aadd( aHelpEng, "                                        " )
Aadd( aHelpEng, "                                        " )

Aadd( aHelpSpa, "                                        " )
Aadd( aHelpSpa, "                                        " )
Aadd( aHelpSpa, "                                        " )

PutSx1("MTA94A","23","Natureza Operacoes ?","Natureza Operacoes ?","Natureza Operacoes ?","mv_chn","N",1,0,3,"C","","","","","mv_par23","Inter. ST","Inter. ST","Inter. ST","","Interestadual","Interestadual","Interestadual","Totalidade","Totalidade","Totalidade","","","","","","",aHelpPor,aHelpEng,aHelpSpa)

RestArea(aArea)

Return
/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Programa  ЁImporSWN  ╨Autor  ЁMicrosiga           ╨ Data Ё  06/01/05   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     ЁTratamento para os itens de importacao da tabela SWN        ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё AP                                                         ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static Function IMporSWN (cAliasSd1, cCNPJ, cSitTrib, dDTIni, dDTFim, nAliqICM, nBRetido, nRedBase, aArrayF3, cAliasSF3, nItem)
	//
	Local aProdepe	:=	{}
	Local nAliqIte	:=	0
	Local nPosAliq	:=	0
	Local aAreaSb1	:=	{}
	//
	dbSelectArea('SWN')
	dbSetOrder(1)	
	SWN->(DbSeek (cSeek:=xFilial ('SWN')+(cAliasSD1)->D1_DOC+(cAliasSD1)->D1_SERIE+AllTrim ((cAliasSD1)->D1_TEC), .F.))
	While !SWN->(Eof ()) .And.;
		xFilial ("SWN")+(cAliasSD1)->D1_DOC+(cAliasSD1)->D1_SERIE+(cAliasSD1)->D1_TEC==SWN->WN_FILIAL+SWN->WN_DOC+SWN->WN_SERIE+SWN->WN_TEC+SWN->WN_EX_NCM+SWN->WN_EX_NBM
		
		RecLock("R54",.T.)
		R54->A54_CNPJ	:=	cCNPJ
		R54->A54_MODELO	:=	AModNot(aArrayF3[1][7])
		R54->A54_SERIE 	:=	(cAliasSD1)->D1_SERIE
		R54->A54_NFISC 	:=	(cAliasSD1)->D1_DOC
		R54->A54_CFOP	:=	(cAliasSD1)->D1_CF
	    R54->A54CFOPEXT :=	If(SF4->(Fieldpos("F4_CFEXT"))>0,SF4->F4_CFEXT,space(02))
		R54->A54_CST   	:=	cSitTrib
		R54->A54_NUMITE	:=	StrZero(nItem,3)
		R54->A54_PRODUT	:=	SWN->WN_PRODUTO
		R54->A54_QUANT 	:=	SWN->WN_QUANT
		R54->A54_VALPRO	:=	SWN->WN_VALOR
		R54->A54_VALDES	:=	0
		R54->A54_BSICM 	:= 	SWN->WN_BASEICM
		R54->A54_BRICMS	:=	0
		R54->A54_VALIPI	:=	0
		R54->A54_ALQICM	:=	aArrayF3[1][8]
		MsUnlock()		
		
		aAreaSb1	:=	SB1->(GetArea ())
		SB1->(DbSeek (xFilial ("SB1")+SWN->WN_PRODUTO))

		If !R75->(dbSeek (DTOS(dDTIni)+DTOS(dDTFim)+AllTrim (SB1->B1_COD)))
    		RecLock("R75",.T.)
			R75->A75_DTAINI	:=	dDTIni
			R75->A75_DTAFIM	:=	dDTFim
			R75->A75_PROD	:=SB1->B1_COD
			R75->A75_CODNCM	:=SB1->B1_POSIPI
			R75->A75_DESCR	:=	SB1->B1_DESC
			R75->A75_UM    	:=	SB1->B1_UM
		    R75->A75_ALQIPI	:=	SB1->B1_IPI
			R75->A75_ALQICM	:=	nAliqICM
			R75->A75_BRICMS	:=	nBRetido  	//Base do Retido
			R75->A75_SITTRI	:=	cSitTrib
			R75->A75_REDBSE	:= nRedBase		//Reducao da Base do ICMS
			If MV_PAR15 == 3
				R75->A75_EAN      := SB1->B1_CODBAR
				R75->A75_CODFIS   := &(GetNewPar("MV_DIC_T06","'0850000'"))
			Endif	
			MsUnlock()
	    Endif
	    //
	    RestArea (aAreaSb1)
		//
		nItem++
		SWN->(DbSkip ())
	EndDo
	nItem--
Return

/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Programa  ЁRetPar    ╨Autor  ЁSergio S. Fuzinaka  ╨ Data Ё  18/08/05   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     ЁRetorna o parametro tratado para o Top                      ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
/*/
Static Function RetPar(cMvPar)

Local cRet	:= ""
Local nI	:= 0

If Len(cMvPar) > 0
	For nI := 1 To Len(cMvPar)
		If Substr(cMvPar,nI,1) == "/"
			cRet += "','"
		ElseIf !Empty(Substr(cMvPar,nI,1))
			cRet += Substr(cMvPar,nI,1)
		Endif
	Next
Endif

Return(cRet)
